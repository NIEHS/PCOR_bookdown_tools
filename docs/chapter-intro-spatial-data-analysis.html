<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Spatial Data Analysis | The CHORDS Toolkit for Health and Geospatial Exposures Research</title>
  <meta name="description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Spatial Data Analysis | The CHORDS Toolkit for Health and Geospatial Exposures Research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  <meta name="github-repo" content="NIEHS/PCOR_bookdown_tools" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Spatial Data Analysis | The CHORDS Toolkit for Health and Geospatial Exposures Research" />
  
  <meta name="twitter:description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  

<meta name="author" content="" />


<meta name="date" content="2024-04-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="foundations.html"/>
<link rel="next" href="wildfire-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><img src="images/chords-icon-nobackground.png" width="200"></a></li>
<li><a href="./">CHORDS Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>Introduction</strong></a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-chords"><i class="fa fa-check"></i>About CHORDS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-toolkit"><i class="fa fa-check"></i>About This Toolkit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="foundations.html"><a href="foundations.html"><i class="fa fa-check"></i><strong>Foundations</strong></a></li>
<li class="chapter" data-level="1" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html"><i class="fa fa-check"></i><b>1</b> Spatial Data Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#introduction-1"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#point-data-with-sf"><i class="fa fa-check"></i><b>1.2</b> Point Data with <code>sf</code></a></li>
<li class="chapter" data-level="1.3" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#polygon-data"><i class="fa fa-check"></i><b>1.3</b> Polygon Data</a></li>
<li class="chapter" data-level="1.4" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#raster-data-with-terra"><i class="fa fa-check"></i><b>1.4</b> Raster Data with <code>terra</code></a></li>
<li class="chapter" data-level="1.5" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#additional-resources"><i class="fa fa-check"></i><b>1.5</b> Additional Resources</a></li>
<li class="chapter" data-level="1.6" data-path="chapter-intro-spatial-data-analysis.html"><a href="chapter-intro-spatial-data-analysis.html#references"><i class="fa fa-check"></i><b>1.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wildfire-data.html"><a href="wildfire-data.html"><i class="fa fa-check"></i><strong>Wildfire Data</strong></a></li>
<li class="chapter" data-level="2" data-path="wildfire-chapter.html"><a href="wildfire-chapter.html"><i class="fa fa-check"></i><b>2</b> Wildfire Chapter</a></li>
<li class="chapter" data-level="" data-path="other-environmental-data.html"><a href="other-environmental-data.html"><i class="fa fa-check"></i><strong>Other Environmental Data</strong></a></li>
<li class="chapter" data-level="3" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html"><i class="fa fa-check"></i><b>3</b> NASA EarthData Download</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#nasa-earthdata-account"><i class="fa fa-check"></i><b>3.2</b> NASA EarthData Account</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#references-1"><i class="fa fa-check"></i><b>3.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="health-data-integration.html"><a href="health-data-integration.html"><i class="fa fa-check"></i><strong>Health Data Integration</strong></a></li>
<li class="chapter" data-level="4" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html"><i class="fa fa-check"></i><b>4</b> Linkage to Census Units</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#tutorial"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#concluding-remarks"><i class="fa fa-check"></i><b>4.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-chords-geo-exposures.html"><a href="chapter-chords-geo-exposures.html"><i class="fa fa-check"></i><b>5</b> Linkage to Exposures</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-chords-geo-exposures.html"><a href="chapter-chords-geo-exposures.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-chords-geo-exposures.html"><a href="chapter-chords-geo-exposures.html#chapter-geo-exposure-caces"><i class="fa fa-check"></i><b>5.2</b> CACES Air Pollution</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-chords-geo-exposures.html"><a href="chapter-chords-geo-exposures.html#chapter-geo-exposure-faa"><i class="fa fa-check"></i><b>5.3</b> Airport Proximity</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-chords-geo-exposures.html"><a href="chapter-chords-geo-exposures.html#chapter-geo-exposure-roads"><i class="fa fa-check"></i><b>5.4</b> Major Road Proximity</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><strong>Case Studies</strong></a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><strong>Appendix</strong></a></li>
<li class="chapter" data-level="" data-path="chapter-user-profiles.html"><a href="chapter-user-profiles.html"><i class="fa fa-check"></i><strong>A</strong> User Profiles</a></li>
<li class="chapter" data-level="" data-path="chords-glossary.html"><a href="chords-glossary.html"><i class="fa fa-check"></i><strong>B</strong> CHORDS Glossary</a></li>
<li class="chapter" data-level="" data-path="all-references-appendix.html"><a href="all-references-appendix.html"><i class="fa fa-check"></i><strong>C</strong> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" 
target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The CHORDS Toolkit for Health and Geospatial Exposures Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-intro-spatial-data-analysis" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Spatial Data Analysis<a href="chapter-intro-spatial-data-analysis.html#chapter-intro-spatial-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="chapter-user-profiles.html#profilecmp"><img src="images/user_profiles/profilecmp.svg" alt="Profile-CMP" /></a>
<a href="chapter-user-profiles.html#profilesbs"><img src="images/user_profiles/profilesbs.svg" alt="Profile-SBS" /></a>
<a href="chapter-user-profiles.html#profilestu"><img src="images/user_profiles/profilestu.svg" alt="Profile-STU" /></a></p>
<div id="access-import-and-primary-analyses-with-environmental-data-in-r" class="section level3 unnumbered hasAnchor">
<h3>Access, Import, and Primary Analyses with Environmental Data in R<a href="chapter-intro-spatial-data-analysis.html#access-import-and-primary-analyses-with-environmental-data-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Date Modified:</strong> February 1, 2024</p>
<p><strong>Authors:</strong> Mitchell Manware <a href="https://orcid.org/0009-0003-6440-6106"><img src="images/orcid.png" width="10" alt="author-mm" /></a>, Kyle P Messier <a href="https://orcid.org/0000-0001-9508-9623"><img src="images/orcid.png" width="10" alt="author-kpm" /></a></p>
<p><strong>Key Terms:</strong> <a href="chords-glossary.html#def-geospatial-data">Geospatial Data</a></p>
<p><strong>Programming Language:</strong> R</p>
</div>
<div id="introduction-1" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction<a href="chapter-intro-spatial-data-analysis.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="motivation" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Motivation<a href="chapter-intro-spatial-data-analysis.html#motivation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Environmental health research relies on various types of data to accurately measure, model, and predict exposures. Environmental data are often spatial (related to the surface of the Earth), temporal (related to specific time/period of time), or spatio-temporal (related to the surface of the Earth for a specific time/period of time). These data are at the core of environmental health research, but the steps between identifying a spatial data set or variable and using it to help answer a research question can be challenging.</p>
<p>This vignette is designed to introduce the necessary steps for conducting analyses with spatial data in R. It will introduce R packages that are equipped to handle spatial data, and will demonstrate how to access, import, and analyze three different types of spatial data. The vignette will focus primarily on spatial data, but some aspects of temporal and spatio-temporal data will also be discussed.</p>
</div>
<div id="objectives" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Objectives<a href="chapter-intro-spatial-data-analysis.html#objectives" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Users will learn about the following topics related to spatial data in R:</p>
<ul>
<li>Point, polygon, and raster data types</li>
<li>Downloading data from a URL</li>
<li>Importing data</li>
<li>Checking data type, structure, and class</li>
<li>Reclassifying data</li>
<li>Computing summary and zonal statistics</li>
<li>Plotting individual and multiple data sets</li>
</ul>
</div>
<div id="data-types" class="section level3 hasAnchor" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Data Types<a href="chapter-intro-spatial-data-analysis.html#data-types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This vignette will cover how to access, import, and analyze point, polygon, and raster spatial data types. The details of what constitutes each unique spatial data type, however, will not be covered.</p>
<p>For detailed descriptions of each type of spatial data, please see <a href="https://r-spatial.github.io/sf/articles/sf1.html">Simple Features for R</a> for point and polygon data types, and <a href="https://datacarpentry.org/organization-geospatial/01-intro-raster-data">Introduction to Raster Data</a> for raster data.</p>
</div>
<div id="data-sources" class="section level3 hasAnchor" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Data Sources<a href="chapter-intro-spatial-data-analysis.html#data-sources" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The exploratory analyses performed in this vignette utilize free and publicly available environmental data. The code chunks are designed to access each specific file used for the exploratory analyses, but a description of each data source and data set is available below.</p>
<table>
<caption>Exploratory analyses data sources</caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Data</th>
<th>Data Type</th>
<th>Producer</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PM<sub>2.5</sub> Daily Observations</td>
<td>Point</td>
<td>Environmental Protection Agency (EPA)</td>
<td><a href="https://aqs.epa.gov/aqsweb/airdata/download_files.html" class="uri">https://aqs.epa.gov/aqsweb/airdata/download_files.html</a></td>
</tr>
<tr class="even">
<td>Wildfire Smoke Plumes</td>
<td>Polygon</td>
<td>National Oceanic and Atmospheric Administration (NOAA)</td>
<td><a href="https://www.ospo.noaa.gov/Products/land/hms.html" class="uri">https://www.ospo.noaa.gov/Products/land/hms.html</a></td>
</tr>
<tr class="odd">
<td>United States Cartographic Boundary</td>
<td>Polygon</td>
<td>United States Census Bureau</td>
<td><a href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" class="uri">https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html</a></td>
</tr>
<tr class="even">
<td>Land Surface Temperature</td>
<td>Raster</td>
<td>National Oceanic and Atmospheric Administration (NOAA)</td>
<td><a href="https://psl.noaa.gov/data/gridded/data.narr.html" class="uri">https://psl.noaa.gov/data/gridded/data.narr.html</a></td>
</tr>
</tbody>
</table>
</div>
<div id="packages" class="section level3 hasAnchor" number="1.1.5">
<h3><span class="header-section-number">1.1.5</span> Packages<a href="chapter-intro-spatial-data-analysis.html#packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Various R packages can be used to create, import, analyze, and export spatial data. If you have not used these packages previously, they may not be installed on your machine. The following chunk of code installs and imports the packages required to conduct the exploratory analyses in this vignette.</p>
<div class="note">
<p>Installing and importing new packages may required R to restart.</p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chapter-intro-spatial-data-analysis.html#cb1-1" tabindex="-1"></a>vignette_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="chapter-intro-spatial-data-analysis.html#cb1-2" tabindex="-1"></a>  <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;ggpubr&quot;</span>, <span class="st">&quot;sf&quot;</span>,</span>
<span id="cb1-3"><a href="chapter-intro-spatial-data-analysis.html#cb1-3" tabindex="-1"></a>  <span class="st">&quot;terra&quot;</span>, <span class="st">&quot;tidyterra&quot;</span>, <span class="st">&quot;utils&quot;</span></span>
<span id="cb1-4"><a href="chapter-intro-spatial-data-analysis.html#cb1-4" tabindex="-1"></a>)</span>
<span id="cb1-5"><a href="chapter-intro-spatial-data-analysis.html#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="chapter-intro-spatial-data-analysis.html#cb1-6" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">seq_along</span>(vignette_packages)) {</span>
<span id="cb1-7"><a href="chapter-intro-spatial-data-analysis.html#cb1-7" tabindex="-1"></a>  <span class="cf">if</span> (vignette_packages[v] <span class="sc">%in%</span> <span class="fu">installed.packages</span>() <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb1-8"><a href="chapter-intro-spatial-data-analysis.html#cb1-8" tabindex="-1"></a>    <span class="fu">install.packages</span>(vignette_packages[v])</span>
<span id="cb1-9"><a href="chapter-intro-spatial-data-analysis.html#cb1-9" tabindex="-1"></a>  }</span>
<span id="cb1-10"><a href="chapter-intro-spatial-data-analysis.html#cb1-10" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="chapter-intro-spatial-data-analysis.html#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="chapter-intro-spatial-data-analysis.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-13"><a href="chapter-intro-spatial-data-analysis.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-14"><a href="chapter-intro-spatial-data-analysis.html#cb1-14" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-15"><a href="chapter-intro-spatial-data-analysis.html#cb1-15" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-16"><a href="chapter-intro-spatial-data-analysis.html#cb1-16" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-17"><a href="chapter-intro-spatial-data-analysis.html#cb1-17" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb1-18"><a href="chapter-intro-spatial-data-analysis.html#cb1-18" tabindex="-1"></a><span class="fu">library</span>(utils)</span></code></pre></div>
<div id="ggplot2-and-ggpubr" class="section level4 unnumbered hasAnchor">
<h4><code>ggplot2</code> and <code>ggpubr</code><a href="chapter-intro-spatial-data-analysis.html#ggplot2-and-ggpubr" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>ggplot2</code> and <code>ggpubr</code> packages will be used throughout the vignette for creating publication quality plots. Please see <a href="https://ggplot2-book.org/introduction">ggplot2: Elegant Graphics for Data Analysis (3e)</a> and <a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr: ‘ggplot2’ Based Publication Ready Plots</a> for in depth descriptions of the syntax and functionality utilized by these packages.</p>
<div class="important">
<p>The exploratory analyses performed in this vignette are designed for educational purposes only. The results of the following analyses are not peer-reviewed findings, nor are they based on any hypotheses.</p>
</div>
</div>
</div>
</div>
<div id="point-data-with-sf" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Point Data with <code>sf</code><a href="chapter-intro-spatial-data-analysis.html#point-data-with-sf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Air pollution monitoring data from the United States Environmental Protection Agency (EPA) will be used to demonstrate using point data with the <code>sf</code> package.</p>
<div id="access-download-and-unzip" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Access, download, and unzip<a href="chapter-intro-spatial-data-analysis.html#access-download-and-unzip" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To download data with the <code>utils::download.file()</code> function, define two variables. One variable to store the website URL where the data exists and a second to store the file path for where the file should be saved.</p>
<div class="note">
<p>Multiple chunks of code in this vignette will contain <code>/   YOUR FILE PATH   /</code>. To run the code on your machine, substitute <code>/   YOUR FILE PATH   /</code> with the file path where you would like to store the vignette data.</p>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="chapter-intro-spatial-data-analysis.html#cb2-1" tabindex="-1"></a>url_epa <span class="ot">&lt;-</span> <span class="st">&quot;https://aqs.epa.gov/aqsweb/airdata/daily_88101_2021.zip&quot;</span></span>
<span id="cb2-2"><a href="chapter-intro-spatial-data-analysis.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="chapter-intro-spatial-data-analysis.html#cb2-3" tabindex="-1"></a>destination_epa <span class="ot">&lt;-</span> <span class="st">&quot;/   YOUR FILE PATH   /epa_data.zip&quot;</span></span>
<span id="cb2-4"><a href="chapter-intro-spatial-data-analysis.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="chapter-intro-spatial-data-analysis.html#cb2-5" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb2-6"><a href="chapter-intro-spatial-data-analysis.html#cb2-6" tabindex="-1"></a>  url_epa,</span>
<span id="cb2-7"><a href="chapter-intro-spatial-data-analysis.html#cb2-7" tabindex="-1"></a>  destination_epa</span>
<span id="cb2-8"><a href="chapter-intro-spatial-data-analysis.html#cb2-8" tabindex="-1"></a>)</span></code></pre></div>
<p>The file downloaded from the EPA website is a zip file. Zip files need to be unzipped (decompressed) in order to access the data within. Unzip the EPA air pollution file with <code>utils::unzip()</code>.</p>
<div class="warning">
<p>Unzipping a <code>.zip</code> file will decompress the contents within. Spatial data sets can be very large (ie. &gt; 1GB ), so check the size of the data before unzipping on your machine.</p>
</div>
<p>The numeric value size of the file is listed under <code>Length</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapter-intro-spatial-data-analysis.html#cb3-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /epa_data.zip&quot;</span>,</span>
<span id="cb3-2"><a href="chapter-intro-spatial-data-analysis.html#cb3-2" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">TRUE</span></span>
<span id="cb3-3"><a href="chapter-intro-spatial-data-analysis.html#cb3-3" tabindex="-1"></a>)</span></code></pre></div>
<p>After inspecting the file size, unzip <code>epa_data.zip</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chapter-intro-spatial-data-analysis.html#cb4-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /epa_data.zip&quot;</span>)</span></code></pre></div>
<p>Inspecting the file with <code>utils::unzip(list = TRUE)</code> returned the size of the file, but also the name of the data file of interest. The desired data file can also be identified with <code>list.files()</code>.</p>
<div class="note">
<p>Other file names may be returned if <code>/   YOUR FILE PATH   /</code> is a directory with other contents (ie. Desktop or Documents).</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter-intro-spatial-data-analysis.html#cb5-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;/   YOUR FILE PATH   /&quot;</span>)</span></code></pre></div>
</div>
<div id="import" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Import<a href="chapter-intro-spatial-data-analysis.html#import" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the contents of the zip file have been saved on your machine and the data file of interest has been identified, import the data with <code>sf::st_read()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chapter-intro-spatial-data-analysis.html#cb6-1" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;/   YOUR FILE PATH   /daily_88101_2021.csv&quot;</span>)</span></code></pre></div>
<p>The previous chunk of code returned a <code>Warning:</code> message. This warning informs the user that the imported data does not have native spatial features, so the data was imported as a <code>data.frame</code>.</p>
</div>
<div id="inspect-structure" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Inspect structure<a href="chapter-intro-spatial-data-analysis.html#inspect-structure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inspect the structure of <code>pm</code> to see its class, column names, column classes, and the first two (specified by <code>vec.len = 2</code>) data points from each column.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter-intro-spatial-data-analysis.html#cb7-1" tabindex="-1"></a><span class="fu">str</span>(pm,</span>
<span id="cb7-2"><a href="chapter-intro-spatial-data-analysis.html#cb7-2" tabindex="-1"></a>  <span class="at">vec.len =</span> <span class="dv">2</span></span>
<span id="cb7-3"><a href="chapter-intro-spatial-data-analysis.html#cb7-3" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="subset" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Subset<a href="chapter-intro-spatial-data-analysis.html#subset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Checking the data’s structure shows that <code>pm</code> is a very large data set. Each of the variables convey important information related to air pollution monitoring, but not all will be utilized in these exploratory analyses.</p>
<p>The data set can be reduced to include only the variables of interest with the <code>subset()</code> function. The <code>select =</code> argument indicates which variables to be retained in the new data set.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chapter-intro-spatial-data-analysis.html#cb8-1" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">subset</span>(pm, <span class="at">select =</span> <span class="fu">c</span>(</span>
<span id="cb8-2"><a href="chapter-intro-spatial-data-analysis.html#cb8-2" tabindex="-1"></a>  State.Code,</span>
<span id="cb8-3"><a href="chapter-intro-spatial-data-analysis.html#cb8-3" tabindex="-1"></a>  County.Code,</span>
<span id="cb8-4"><a href="chapter-intro-spatial-data-analysis.html#cb8-4" tabindex="-1"></a>  Site.Num,</span>
<span id="cb8-5"><a href="chapter-intro-spatial-data-analysis.html#cb8-5" tabindex="-1"></a>  Latitude,</span>
<span id="cb8-6"><a href="chapter-intro-spatial-data-analysis.html#cb8-6" tabindex="-1"></a>  Longitude,</span>
<span id="cb8-7"><a href="chapter-intro-spatial-data-analysis.html#cb8-7" tabindex="-1"></a>  State.Name,</span>
<span id="cb8-8"><a href="chapter-intro-spatial-data-analysis.html#cb8-8" tabindex="-1"></a>  Date.Local,</span>
<span id="cb8-9"><a href="chapter-intro-spatial-data-analysis.html#cb8-9" tabindex="-1"></a>  Arithmetic.Mean</span>
<span id="cb8-10"><a href="chapter-intro-spatial-data-analysis.html#cb8-10" tabindex="-1"></a>))</span></code></pre></div>
<p>Re-running <code>str(pm)</code> after subsetting the data set shows that all all observations (n = 590208) of the variables of interest (n = 8) have been retained.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter-intro-spatial-data-analysis.html#cb9-1" tabindex="-1"></a><span class="fu">str</span>(pm,</span>
<span id="cb9-2"><a href="chapter-intro-spatial-data-analysis.html#cb9-2" tabindex="-1"></a>  <span class="at">vec.len =</span> <span class="dv">2</span></span>
<span id="cb9-3"><a href="chapter-intro-spatial-data-analysis.html#cb9-3" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="reclassify" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Reclassify<a href="chapter-intro-spatial-data-analysis.html#reclassify" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>str()</code> function showed the class of each variable within the data set. All of the retained variables are of class character, indicated by <code>: chr</code> and the quotations around each observation (<code>"01" "01" ...</code>).</p>
<p>The class of a variable depends on the information conveyed by the data stored within that variable. For example, character is an appropriate class for the <code>pm$State.Name</code> variable because each observation is a character string labeling in which state the monitor was located. Alternatively, character is not appropriate for the <code>pm$Arithmetic.Mean</code> or <code>pm$Date.Local</code> variables because each observation is a numeric decimal or time-referenced date, respectively.</p>
<p>The <code>as.</code> functions can be used for reclassifying data. Reclassify <code>pm$Arithmetic.Mean</code> as a number, and <code>pm$Date.Local</code> as a date.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chapter-intro-spatial-data-analysis.html#cb10-1" tabindex="-1"></a>pm<span class="sc">$</span>Arithmetic.Mean <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(pm<span class="sc">$</span>Arithmetic.Mean)</span>
<span id="cb10-2"><a href="chapter-intro-spatial-data-analysis.html#cb10-2" tabindex="-1"></a>pm<span class="sc">$</span>Date.Local <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(pm<span class="sc">$</span>Date.Local)</span></code></pre></div>
<p>After running the <code>as.</code> functions, ensure that the two variables have been reclassified to the desired classes.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapter-intro-spatial-data-analysis.html#cb11-1" tabindex="-1"></a><span class="fu">class</span>(pm<span class="sc">$</span>Arithmetic.Mean)</span>
<span id="cb11-2"><a href="chapter-intro-spatial-data-analysis.html#cb11-2" tabindex="-1"></a><span class="fu">class</span>(pm<span class="sc">$</span>Date.Local)</span></code></pre></div>
</div>
<div id="convert-to-sf-object" class="section level3 hasAnchor" number="1.2.6">
<h3><span class="header-section-number">1.2.6</span> Convert to <code>sf</code> object<a href="chapter-intro-spatial-data-analysis.html#convert-to-sf-object" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With the variables of interest selected and reclassified, <code>pm</code> can be converted to spatially defined <code>sf</code> object. The <code>sf::st_as_sf()</code> function creates a <code>$geometry</code> field based on the latitude and longitude coordinates contained within <code>pm</code>. The <code>coords = c()</code> argument specifies the column names which contain the coordinate values.</p>
<div class="note">
<p>The columns containing coordinate values will not always be “Latitude” and “Longitude”. Use <code>str()</code> to see column names and identify which contain the coordinate values.</p>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chapter-intro-spatial-data-analysis.html#cb12-1" tabindex="-1"></a>pm_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(pm,</span>
<span id="cb12-2"><a href="chapter-intro-spatial-data-analysis.html#cb12-2" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>)</span>
<span id="cb12-3"><a href="chapter-intro-spatial-data-analysis.html#cb12-3" tabindex="-1"></a>)</span></code></pre></div>
<p>Inspect the classes of <code>pm_sf</code> and <code>pm_sf$geometry</code> to see their differences, and how each are different than <code>class(pm)</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chapter-intro-spatial-data-analysis.html#cb13-1" tabindex="-1"></a><span class="fu">class</span>(pm_sf)</span>
<span id="cb13-2"><a href="chapter-intro-spatial-data-analysis.html#cb13-2" tabindex="-1"></a><span class="fu">class</span>(pm_sf<span class="sc">$</span>geometry)</span></code></pre></div>
<p><code>class(pm_sf)</code> returned both <code>"sf"</code> and <code>"data.frame"</code>, indicating that it contains both spatial and non-spatial data.</p>
</div>
<div id="coordinate-reference-system-and-projection" class="section level3 hasAnchor" number="1.2.7">
<h3><span class="header-section-number">1.2.7</span> Coordinate reference system and projection<a href="chapter-intro-spatial-data-analysis.html#coordinate-reference-system-and-projection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The coordinate reference system of an <code>sf</code> object can be checked with <code>sf::st_crs()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chapter-intro-spatial-data-analysis.html#cb14-1" tabindex="-1"></a><span class="fu">st_crs</span>(pm_sf)</span></code></pre></div>
<p>The previous chunk of code shows that <code>pm_sf</code> does not have a native coordinate reference system. The same function, <code>sf::st_crs()</code>, can be used to assign a coordinate reference system to an <code>sf</code> object. For this example, the World Geodesic System 1984 (WGS 84) will be used (EPSG code: 4326).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chapter-intro-spatial-data-analysis.html#cb15-1" tabindex="-1"></a><span class="fu">st_crs</span>(pm_sf) <span class="ot">&lt;-</span> <span class="dv">4326</span></span>
<span id="cb15-2"><a href="chapter-intro-spatial-data-analysis.html#cb15-2" tabindex="-1"></a><span class="fu">st_crs</span>(pm_sf)</span></code></pre></div>
<p>An <code>sf</code> object with a coordinate reference system can be transformed (projected) into a different coordinate reference system with <code>sf::st_transform()</code>. The area of interest for these exploratory analyses is the coterminous United States, so the Albers Equal Area projected coordinate system will be used (EPSG code: 5070). For a detailed description of coordinate reference systems, and how to select the best system for your analyses, see <a href="#chapter-coordinate-reference-systems">Coordinate Reference Systems</a>.</p>
<div class="note">
<p>An <code>sf</code> object without an assigned coordinate reference system cannot be transformed. <code>sf::st_crs()</code> must be used to assign a coordinate reference system to an <code>sf</code> object that does not have one.</p>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="chapter-intro-spatial-data-analysis.html#cb16-1" tabindex="-1"></a>pm_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(</span>
<span id="cb16-2"><a href="chapter-intro-spatial-data-analysis.html#cb16-2" tabindex="-1"></a>  pm_sf,</span>
<span id="cb16-3"><a href="chapter-intro-spatial-data-analysis.html#cb16-3" tabindex="-1"></a>  <span class="dv">5070</span></span>
<span id="cb16-4"><a href="chapter-intro-spatial-data-analysis.html#cb16-4" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="plot" class="section level3 hasAnchor" number="1.2.8">
<h3><span class="header-section-number">1.2.8</span> Plot<a href="chapter-intro-spatial-data-analysis.html#plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Plotting spatial data is important for visualizing and analyzing patterns in the data. Initialize a plot for the locations of each air pollution monitoring station with <code>ggplot2::ggplot()</code>. Identifying the data set to be plotted within the <code>geom_sf()</code> argument informs the function that the data is an <code>sf</code> object.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapter-intro-spatial-data-analysis.html#cb17-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="chapter-intro-spatial-data-analysis.html#cb17-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pm_sf) <span class="sc">+</span></span>
<span id="cb17-3"><a href="chapter-intro-spatial-data-analysis.html#cb17-3" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Pollution Monitor Locations&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="chapter-intro-spatial-data-analysis.html#cb17-4" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="chapter-intro-spatial-data-analysis.html#cb17-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="chapter-intro-spatial-data-analysis.html#cb17-6" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/epa_monitors.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>The plot shows the distribution of monitoring locations, and roughly depicts the outline of the United States due to the large number of monitors. The plot does not, however, convey any information about the concentration of PM<sub>2.5</sub> measured by each monitor. Inspect the summary statistics of the PM<sub>2.5</sub> measurements before creating any plots to visualize the data.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="chapter-intro-spatial-data-analysis.html#cb18-1" tabindex="-1"></a><span class="fu">summary</span>(pm_sf<span class="sc">$</span>Arithmetic.Mean)</span>
<span id="cb18-2"><a href="chapter-intro-spatial-data-analysis.html#cb18-2" tabindex="-1"></a><span class="fu">sd</span>(pm_sf<span class="sc">$</span>Arithmetic.Mean)</span></code></pre></div>
<p>After inspecting the summary statistics, create a histogram of the PM<sub>2.5</sub> concentration measurements to visualize the distribution of the data.</p>
<div class="note">
<p>The histogram is not a spatially defined plot, so the data set to be plotted is identified within <code>ggplot()</code>.</p>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapter-intro-spatial-data-analysis.html#cb19-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb19-2"><a href="chapter-intro-spatial-data-analysis.html#cb19-2" tabindex="-1"></a>  <span class="at">data =</span> pm_sf,</span>
<span id="cb19-3"><a href="chapter-intro-spatial-data-analysis.html#cb19-3" tabindex="-1"></a>  <span class="fu">aes</span>(Arithmetic.Mean)</span>
<span id="cb19-4"><a href="chapter-intro-spatial-data-analysis.html#cb19-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="chapter-intro-spatial-data-analysis.html#cb19-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb19-6"><a href="chapter-intro-spatial-data-analysis.html#cb19-6" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb19-7"><a href="chapter-intro-spatial-data-analysis.html#cb19-7" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">5</span></span>
<span id="cb19-8"><a href="chapter-intro-spatial-data-analysis.html#cb19-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="chapter-intro-spatial-data-analysis.html#cb19-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb19-10"><a href="chapter-intro-spatial-data-analysis.html#cb19-10" tabindex="-1"></a>    <span class="fu">expression</span>(<span class="st">&quot;PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentration Measurements&quot;</span>)</span>
<span id="cb19-11"><a href="chapter-intro-spatial-data-analysis.html#cb19-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-12"><a href="chapter-intro-spatial-data-analysis.html#cb19-12" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentration (µg/m&quot;</span><span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb19-13"><a href="chapter-intro-spatial-data-analysis.html#cb19-13" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of Measurements&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="chapter-intro-spatial-data-analysis.html#cb19-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb19-15"><a href="chapter-intro-spatial-data-analysis.html#cb19-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb19-16"><a href="chapter-intro-spatial-data-analysis.html#cb19-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/pm_concentrations_histogram.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="calculate-annual-mean" class="section level3 hasAnchor" number="1.2.9">
<h3><span class="header-section-number">1.2.9</span> Calculate annual mean<a href="chapter-intro-spatial-data-analysis.html#calculate-annual-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common summary statistic of interest to researchers is the mean over a certain period of time. For this example, we will calculate the mean PM<sub>2.5</sub> concentration for each monitoring location for the year 2021. To do this, a unique identification code must be created for each monitoring location.</p>
<p>The <code>pm_sf$Monitor.ID</code> variable can be created by concatenating each monitor’s state code, county code, and site number together into a single character string.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chapter-intro-spatial-data-analysis.html#cb20-1" tabindex="-1"></a>pm_sf<span class="sc">$</span>Monitor.ID <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb20-2"><a href="chapter-intro-spatial-data-analysis.html#cb20-2" tabindex="-1"></a>  pm_sf<span class="sc">$</span>State.Code,</span>
<span id="cb20-3"><a href="chapter-intro-spatial-data-analysis.html#cb20-3" tabindex="-1"></a>  pm_sf<span class="sc">$</span>County.Code,</span>
<span id="cb20-4"><a href="chapter-intro-spatial-data-analysis.html#cb20-4" tabindex="-1"></a>  pm_sf<span class="sc">$</span>Site.Num</span>
<span id="cb20-5"><a href="chapter-intro-spatial-data-analysis.html#cb20-5" tabindex="-1"></a>)</span></code></pre></div>
<p>Each unique monitor identification code should be matched with a unique monitor location geometry. To ensure that each monitor location has a unique identification code, check that there are an equal number of unique geometries and identification codes.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapter-intro-spatial-data-analysis.html#cb21-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(pm_sf<span class="sc">$</span>Monitor.ID)) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(pm_sf<span class="sc">$</span>geometry))</span></code></pre></div>
<p>Now that each monitor location as a unique identification code, we can calculate the mean PM<sub>2.5</sub> concentration measured at each monitoring location. Functions and syntax from the <code>dplyr</code> package will be used to do this. For more on the <code>dplyr</code> package, please see <a href="https://dplyr.tidyverse.org/articles/dplyr.html">Introduction to dplyr</a>.</p>
<p>The <code>group_by(Monitor.ID, )</code> argument specifies that an annual mean should be calculated for each unique <code>Monitor.ID</code>. Including <code>State.Name</code> in this argument retains the column in the new <code>pm_mean</code> data set, but does not influence the calculation of the annual mean.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chapter-intro-spatial-data-analysis.html#cb22-1" tabindex="-1"></a>pm_mean <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="chapter-intro-spatial-data-analysis.html#cb22-2" tabindex="-1"></a>  pm_sf <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="chapter-intro-spatial-data-analysis.html#cb22-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Monitor.ID, State.Name) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="chapter-intro-spatial-data-analysis.html#cb22-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Annual.Mean =</span> <span class="fu">mean</span>(Arithmetic.Mean))</span></code></pre></div>
<p>Inspect the summary statistics of <code>pm_mean</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="chapter-intro-spatial-data-analysis.html#cb23-1" tabindex="-1"></a><span class="fu">summary</span>(pm_mean<span class="sc">$</span>Annual.Mean)</span>
<span id="cb23-2"><a href="chapter-intro-spatial-data-analysis.html#cb23-2" tabindex="-1"></a><span class="fu">sd</span>(pm_mean<span class="sc">$</span>Annual.Mean)</span></code></pre></div>
<p>Create a plot which shows the distribution of monitoring locations, and color each point according to the monitor’s annual mean concentration of PM<sub>2.5</sub>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="chapter-intro-spatial-data-analysis.html#cb24-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-2"><a href="chapter-intro-spatial-data-analysis.html#cb24-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb24-3"><a href="chapter-intro-spatial-data-analysis.html#cb24-3" tabindex="-1"></a>    <span class="at">data =</span> pm_mean,</span>
<span id="cb24-4"><a href="chapter-intro-spatial-data-analysis.html#cb24-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> Annual.Mean)</span>
<span id="cb24-5"><a href="chapter-intro-spatial-data-analysis.html#cb24-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-6"><a href="chapter-intro-spatial-data-analysis.html#cb24-6" tabindex="-1"></a>  <span class="fu">scale_color_viridis_b</span>(</span>
<span id="cb24-7"><a href="chapter-intro-spatial-data-analysis.html#cb24-7" tabindex="-1"></a>    <span class="fu">expression</span>(<span class="st">&quot;PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentration (µg/m&quot;</span><span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb24-8"><a href="chapter-intro-spatial-data-analysis.html#cb24-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-9"><a href="chapter-intro-spatial-data-analysis.html#cb24-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb24-10"><a href="chapter-intro-spatial-data-analysis.html#cb24-10" tabindex="-1"></a>    <span class="fu">expression</span>(<span class="st">&quot;Annual Mean PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentration&quot;</span>)</span>
<span id="cb24-11"><a href="chapter-intro-spatial-data-analysis.html#cb24-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-12"><a href="chapter-intro-spatial-data-analysis.html#cb24-12" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-13"><a href="chapter-intro-spatial-data-analysis.html#cb24-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb24-14"><a href="chapter-intro-spatial-data-analysis.html#cb24-14" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/epa_monitors_concentrations.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>Now the plot depicts both spatial and non-spatial data.</p>
</div>
<div id="compare-highest-annual-means" class="section level3 hasAnchor" number="1.2.10">
<h3><span class="header-section-number">1.2.10</span> Compare highest annual means<a href="chapter-intro-spatial-data-analysis.html#compare-highest-annual-means" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A close visual inspection of the previous plot shows a few monitoring locations in the southwestern region of the United States with very high (&gt; 20 µm/m<sup>3</sup>) annual mean concentrations of PM<sub>2.5</sub>. To investigate the differences between the monitors with the highest and lowest annual mean concentrations, create a subset of <code>pm_sf</code> with only the three highest and lowest monitors.</p>
<p>To do this, first identify the monitors with the highest and lowest annual mean concentrations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="chapter-intro-spatial-data-analysis.html#cb25-1" tabindex="-1"></a>min_monitors <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href="chapter-intro-spatial-data-analysis.html#cb25-2" tabindex="-1"></a>  pm_mean <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="chapter-intro-spatial-data-analysis.html#cb25-3" tabindex="-1"></a>  <span class="fu">arrange</span>(Annual.Mean) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="chapter-intro-spatial-data-analysis.html#cb25-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb25-5"><a href="chapter-intro-spatial-data-analysis.html#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="chapter-intro-spatial-data-analysis.html#cb25-6" tabindex="-1"></a>max_monitors <span class="ot">&lt;-</span></span>
<span id="cb25-7"><a href="chapter-intro-spatial-data-analysis.html#cb25-7" tabindex="-1"></a>  pm_mean <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="chapter-intro-spatial-data-analysis.html#cb25-8" tabindex="-1"></a>  <span class="fu">arrange</span>(Annual.Mean) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="chapter-intro-spatial-data-analysis.html#cb25-9" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Next, create a variable storing only the unique identification codes of these six monitors.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="chapter-intro-spatial-data-analysis.html#cb26-1" tabindex="-1"></a>min_max_monitors_id <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb26-2"><a href="chapter-intro-spatial-data-analysis.html#cb26-2" tabindex="-1"></a>  min_monitors<span class="sc">$</span>Monitor.ID,</span>
<span id="cb26-3"><a href="chapter-intro-spatial-data-analysis.html#cb26-3" tabindex="-1"></a>  max_monitors<span class="sc">$</span>Monitor.ID</span>
<span id="cb26-4"><a href="chapter-intro-spatial-data-analysis.html#cb26-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Finally, subset the <code>pm_sf</code> data set according to the monitor identification codes stored in <code>min_max_monitors_id</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chapter-intro-spatial-data-analysis.html#cb27-1" tabindex="-1"></a>pm_min_max <span class="ot">&lt;-</span> <span class="fu">subset</span>(pm_sf,</span>
<span id="cb27-2"><a href="chapter-intro-spatial-data-analysis.html#cb27-2" tabindex="-1"></a>  <span class="at">subset =</span> Monitor.ID <span class="sc">==</span> min_max_monitors_id</span>
<span id="cb27-3"><a href="chapter-intro-spatial-data-analysis.html#cb27-3" tabindex="-1"></a>)</span></code></pre></div>
<p>The resulting <code>pm_min_max</code> data set contains data for only six monitoring locations. Check the unique monitor identification codes that constitute the new data set.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chapter-intro-spatial-data-analysis.html#cb28-1" tabindex="-1"></a><span class="fu">unique</span>(pm_min_max<span class="sc">$</span>Monitor.ID)</span></code></pre></div>
<p>The temporal trend of PM<sub>2.5</sub> concentrations measured at each of these locations in 2021 can be depicted with <code>ggplot::geom_line()</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chapter-intro-spatial-data-analysis.html#cb29-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-2"><a href="chapter-intro-spatial-data-analysis.html#cb29-2" tabindex="-1"></a>  <span class="at">data =</span> pm_min_max,</span>
<span id="cb29-3"><a href="chapter-intro-spatial-data-analysis.html#cb29-3" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb29-4"><a href="chapter-intro-spatial-data-analysis.html#cb29-4" tabindex="-1"></a>    <span class="at">x =</span> Date.Local,</span>
<span id="cb29-5"><a href="chapter-intro-spatial-data-analysis.html#cb29-5" tabindex="-1"></a>    <span class="at">y =</span> Arithmetic.Mean,</span>
<span id="cb29-6"><a href="chapter-intro-spatial-data-analysis.html#cb29-6" tabindex="-1"></a>    <span class="at">group =</span> Monitor.ID,</span>
<span id="cb29-7"><a href="chapter-intro-spatial-data-analysis.html#cb29-7" tabindex="-1"></a>    <span class="at">color =</span> Monitor.ID</span>
<span id="cb29-8"><a href="chapter-intro-spatial-data-analysis.html#cb29-8" tabindex="-1"></a>  )</span>
<span id="cb29-9"><a href="chapter-intro-spatial-data-analysis.html#cb29-9" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="chapter-intro-spatial-data-analysis.html#cb29-10" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb29-11"><a href="chapter-intro-spatial-data-analysis.html#cb29-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Minimum and Maximum Monitors&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-12"><a href="chapter-intro-spatial-data-analysis.html#cb29-12" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-13"><a href="chapter-intro-spatial-data-analysis.html#cb29-13" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentrations (µg/m&quot;</span><span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="chapter-intro-spatial-data-analysis.html#cb29-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-15"><a href="chapter-intro-spatial-data-analysis.html#cb29-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="images/intro_to_spatial/min_max_monitors.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>Alternatively, the <code>ggplot2::geom_boxplot()</code> function compares the median, interquartile range, and outliers of the monitors’ measurements.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="chapter-intro-spatial-data-analysis.html#cb30-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb30-2"><a href="chapter-intro-spatial-data-analysis.html#cb30-2" tabindex="-1"></a>  <span class="at">data =</span> pm_min_max,</span>
<span id="cb30-3"><a href="chapter-intro-spatial-data-analysis.html#cb30-3" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb30-4"><a href="chapter-intro-spatial-data-analysis.html#cb30-4" tabindex="-1"></a>    <span class="at">x =</span> Monitor.ID,</span>
<span id="cb30-5"><a href="chapter-intro-spatial-data-analysis.html#cb30-5" tabindex="-1"></a>    <span class="at">y =</span> Arithmetic.Mean,</span>
<span id="cb30-6"><a href="chapter-intro-spatial-data-analysis.html#cb30-6" tabindex="-1"></a>    <span class="at">fill =</span> Monitor.ID</span>
<span id="cb30-7"><a href="chapter-intro-spatial-data-analysis.html#cb30-7" tabindex="-1"></a>  )</span>
<span id="cb30-8"><a href="chapter-intro-spatial-data-analysis.html#cb30-8" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="chapter-intro-spatial-data-analysis.html#cb30-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb30-10"><a href="chapter-intro-spatial-data-analysis.html#cb30-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Monitor ID&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="chapter-intro-spatial-data-analysis.html#cb30-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;PM&quot;</span>[<span class="fl">2.5</span>] <span class="sc">*</span> <span class="st">&quot; Concentrations (µg/m&quot;</span><span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="chapter-intro-spatial-data-analysis.html#cb30-12" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="images/intro_to_spatial/monitors_boxplot.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
</div>
<div id="polygon-data" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Polygon Data<a href="chapter-intro-spatial-data-analysis.html#polygon-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Wildfire smoke plume coverage data from the United States National Oceanic and Atmospheric Administration (NOAA) will be used to demonstrate using polygon data. This section will cover polygon data with both the <code>sf</code> and <code>terra</code> packages separately, but the steps for accessing, downloading, and unzipping the data is the same for both packages.</p>
<div id="access-download-and-unzip-1" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Access, download, and unzip<a href="chapter-intro-spatial-data-analysis.html#access-download-and-unzip-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The website URL where the NOAA wildfire smoke plume data exists is date-specific, meaning there is a unique URL for each daily data set. For the purpose of these exploratory analyses, wildfire smoke plume data from September 1, 2023 will be used.</p>
<p>Define three variables for <code>day</code>, <code>month</code>, and <code>year</code> according to the date of interest.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chapter-intro-spatial-data-analysis.html#cb31-1" tabindex="-1"></a>day <span class="ot">&lt;-</span> <span class="st">&quot;01&quot;</span></span>
<span id="cb31-2"><a href="chapter-intro-spatial-data-analysis.html#cb31-2" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="st">&quot;09&quot;</span></span>
<span id="cb31-3"><a href="chapter-intro-spatial-data-analysis.html#cb31-3" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="st">&quot;2023&quot;</span></span></code></pre></div>
<p>The <code>utils::download.file()</code> function downloads the file according to the defined URL and destination file.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chapter-intro-spatial-data-analysis.html#cb32-1" tabindex="-1"></a>url_noaa <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb32-2"><a href="chapter-intro-spatial-data-analysis.html#cb32-2" tabindex="-1"></a>  <span class="st">&quot;https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons&quot;</span>,</span>
<span id="cb32-3"><a href="chapter-intro-spatial-data-analysis.html#cb32-3" tabindex="-1"></a>  <span class="st">&quot;/Shapefile/&quot;</span>,</span>
<span id="cb32-4"><a href="chapter-intro-spatial-data-analysis.html#cb32-4" tabindex="-1"></a>  year,</span>
<span id="cb32-5"><a href="chapter-intro-spatial-data-analysis.html#cb32-5" tabindex="-1"></a>  <span class="st">&quot;/&quot;</span>,</span>
<span id="cb32-6"><a href="chapter-intro-spatial-data-analysis.html#cb32-6" tabindex="-1"></a>  month,</span>
<span id="cb32-7"><a href="chapter-intro-spatial-data-analysis.html#cb32-7" tabindex="-1"></a>  <span class="st">&quot;/hms_smoke&quot;</span>,</span>
<span id="cb32-8"><a href="chapter-intro-spatial-data-analysis.html#cb32-8" tabindex="-1"></a>  year,</span>
<span id="cb32-9"><a href="chapter-intro-spatial-data-analysis.html#cb32-9" tabindex="-1"></a>  month,</span>
<span id="cb32-10"><a href="chapter-intro-spatial-data-analysis.html#cb32-10" tabindex="-1"></a>  day,</span>
<span id="cb32-11"><a href="chapter-intro-spatial-data-analysis.html#cb32-11" tabindex="-1"></a>  <span class="st">&quot;.zip&quot;</span></span>
<span id="cb32-12"><a href="chapter-intro-spatial-data-analysis.html#cb32-12" tabindex="-1"></a>)</span>
<span id="cb32-13"><a href="chapter-intro-spatial-data-analysis.html#cb32-13" tabindex="-1"></a></span>
<span id="cb32-14"><a href="chapter-intro-spatial-data-analysis.html#cb32-14" tabindex="-1"></a>destination_noaa <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb32-15"><a href="chapter-intro-spatial-data-analysis.html#cb32-15" tabindex="-1"></a>  <span class="st">&quot;/   YOUR FILE PATH   /noaa_smoke&quot;</span>,</span>
<span id="cb32-16"><a href="chapter-intro-spatial-data-analysis.html#cb32-16" tabindex="-1"></a>  year,</span>
<span id="cb32-17"><a href="chapter-intro-spatial-data-analysis.html#cb32-17" tabindex="-1"></a>  month,</span>
<span id="cb32-18"><a href="chapter-intro-spatial-data-analysis.html#cb32-18" tabindex="-1"></a>  day,</span>
<span id="cb32-19"><a href="chapter-intro-spatial-data-analysis.html#cb32-19" tabindex="-1"></a>  <span class="st">&quot;.zip&quot;</span></span>
<span id="cb32-20"><a href="chapter-intro-spatial-data-analysis.html#cb32-20" tabindex="-1"></a>)</span>
<span id="cb32-21"><a href="chapter-intro-spatial-data-analysis.html#cb32-21" tabindex="-1"></a></span>
<span id="cb32-22"><a href="chapter-intro-spatial-data-analysis.html#cb32-22" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb32-23"><a href="chapter-intro-spatial-data-analysis.html#cb32-23" tabindex="-1"></a>  url_noaa,</span>
<span id="cb32-24"><a href="chapter-intro-spatial-data-analysis.html#cb32-24" tabindex="-1"></a>  destination_noaa</span>
<span id="cb32-25"><a href="chapter-intro-spatial-data-analysis.html#cb32-25" tabindex="-1"></a>)</span></code></pre></div>
<p>The file downloaded from the NOAA website is a <code>.zip</code> file. Zip files need to be unzipped (decompressed) in order to access the data within. Unzip the NOAA wildfire smoke plume coverage file with <code>utils::unzip()</code>.</p>
<div class="warning">
<p>Unzipping a <code>.zip</code> file will decompress the contents within. Spatial data sets can be very large (ie. &gt; 1GB), so check the size of the data before unzipping on your machine.</p>
</div>
<p>The numeric value size of each file is listed under <code>Length</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chapter-intro-spatial-data-analysis.html#cb33-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /noaa_smoke20230901.zip&quot;</span>,</span>
<span id="cb33-2"><a href="chapter-intro-spatial-data-analysis.html#cb33-2" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">TRUE</span></span>
<span id="cb33-3"><a href="chapter-intro-spatial-data-analysis.html#cb33-3" tabindex="-1"></a>)</span></code></pre></div>
<p>After inspecting the file sizes, unzip <code>noaa_smoke20230901.zip</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chapter-intro-spatial-data-analysis.html#cb34-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /noaa_smoke20230901.zip&quot;</span>)</span></code></pre></div>
<p>Inspecting the file with <code>utils::unzip(list = TRUE)</code> returned the size of the file, but also the name of the data file of interest. The desired data file can also be identified with <code>list.files()</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chapter-intro-spatial-data-analysis.html#cb35-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;/   YOUR FILE PATH   /&quot;</span>)</span></code></pre></div>
<p>Listing the contents of the unzipped file reveals four individual files. The data to be imported is stored in the <code>hms_smoke20230901.shp</code>, but the other files contain important information for the <code>.shp</code> file.</p>
<div class="warning">
<p>Deleting any of the supporting files (ie. <code>*.dbf</code>, <code>*.prj</code>, or <code>*.shx</code>) will disrupt the data import.</p>
</div>
</div>
<div id="polygon-data-with-sf" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Polygon Data with <code>sf</code><a href="chapter-intro-spatial-data-analysis.html#polygon-data-with-sf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section will focus on exploratory analyses with polygon data using the <code>sf</code> package.</p>
<div id="import-1" class="section level4 unnumbered hasAnchor">
<h4>Import<a href="chapter-intro-spatial-data-analysis.html#import-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that the contents of the zip file have been saved on your machine and the data file of interest has been identified, import the data with <code>sf::st_read()</code>.</p>
<div class="note">
<p>Although the supporting files are required to import a shapefile, only the file ending in <code>.shp</code> needs to be imported</p>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="chapter-intro-spatial-data-analysis.html#cb36-1" tabindex="-1"></a>smoke_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;/   YOUR FILE PATH   /hms_smoke20230901.shp&quot;</span>)</span></code></pre></div>
<p>Importing <code>hms_smoke20230901.shp</code> does not return a <code>Warning:</code> message because the data set has native spatial features, and is therefore imported as an <code>sf</code> object.</p>
</div>
<div id="inspect-structure-1" class="section level4 unnumbered hasAnchor">
<h4>Inspect structure<a href="chapter-intro-spatial-data-analysis.html#inspect-structure-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Inspect the structure of <code>smoke_sf</code> to see its class, column names, column classes, and the first two (specified by <code>vec.len = 2</code>) data points.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="chapter-intro-spatial-data-analysis.html#cb37-1" tabindex="-1"></a><span class="fu">str</span>(smoke_sf,</span>
<span id="cb37-2"><a href="chapter-intro-spatial-data-analysis.html#cb37-2" tabindex="-1"></a>  <span class="at">vec.len =</span> <span class="dv">2</span></span>
<span id="cb37-3"><a href="chapter-intro-spatial-data-analysis.html#cb37-3" tabindex="-1"></a>)</span></code></pre></div>
<p>As mentioned previously, the <code>smoke_sf</code> data set has native spatial features. These are reflected by the data set having classes of <code>sf</code> and <code>data.frame</code>, and the <code>$geometry</code> feature.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="chapter-intro-spatial-data-analysis.html#cb38-1" tabindex="-1"></a><span class="fu">class</span>(smoke_sf)</span></code></pre></div>
</div>
<div id="reclassify-1" class="section level4 unnumbered hasAnchor">
<h4>Reclassify<a href="chapter-intro-spatial-data-analysis.html#reclassify-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The main parameter of interest in this data set is <code>$Density</code>, which discretely categorizes each wildfire smoke plume as “Light”, “Medium”, or “Heavy”. Checking its class shows that <code>$Density</code> is class character.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="chapter-intro-spatial-data-analysis.html#cb39-1" tabindex="-1"></a><span class="fu">class</span>(smoke_sf<span class="sc">$</span>Density)</span></code></pre></div>
<p>Nominal data, data without fixed order or rank system, can be stored as class character (ie. State names). However, it is best to store ordinal data as class factor for conducting analyses in R.</p>
<p>Converting data from class character to class factor can be done with <code>factor()</code>. The <code>levels = c()</code> argument in the function specifies both the level names and the ranked order of the levels.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="chapter-intro-spatial-data-analysis.html#cb40-1" tabindex="-1"></a>smoke_sf<span class="sc">$</span>Density <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke_sf<span class="sc">$</span>Density,</span>
<span id="cb40-2"><a href="chapter-intro-spatial-data-analysis.html#cb40-2" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Light&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Heavy&quot;</span>)</span>
<span id="cb40-3"><a href="chapter-intro-spatial-data-analysis.html#cb40-3" tabindex="-1"></a>)</span></code></pre></div>
<p>Check the class of <code>$Density</code> again to ensure proper reclassification.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="chapter-intro-spatial-data-analysis.html#cb41-1" tabindex="-1"></a><span class="fu">class</span>(smoke_sf<span class="sc">$</span>Density)</span></code></pre></div>
</div>
<div id="coordinate-reference-system-and-projection-1" class="section level4 unnumbered hasAnchor">
<h4>Coordinate reference system and projection<a href="chapter-intro-spatial-data-analysis.html#coordinate-reference-system-and-projection-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Check the coordinate reference system of an <code>sf</code> object with <code>sf::st_crs()</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="chapter-intro-spatial-data-analysis.html#cb42-1" tabindex="-1"></a><span class="fu">st_crs</span>(smoke_sf)</span></code></pre></div>
<p><code>smoke_sf</code> has a native coordinate reference system which was imported during the <code>sf::st_read()</code> step. The area of interest for these exploratory analyses is the coterminous United States, so we can transform <code>smoke_sf</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="chapter-intro-spatial-data-analysis.html#cb43-1" tabindex="-1"></a>smoke_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(</span>
<span id="cb43-2"><a href="chapter-intro-spatial-data-analysis.html#cb43-2" tabindex="-1"></a>  smoke_sf,</span>
<span id="cb43-3"><a href="chapter-intro-spatial-data-analysis.html#cb43-3" tabindex="-1"></a>  <span class="dv">5070</span></span>
<span id="cb43-4"><a href="chapter-intro-spatial-data-analysis.html#cb43-4" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="plot-single" class="section level4 unnumbered hasAnchor">
<h4>Plot (single)<a href="chapter-intro-spatial-data-analysis.html#plot-single" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the data prepared, plot the wildfire smoke plume polygons with <code>ggplot2::ggplot()</code>.</p>
<p>Now that the parameters of interest and coordinate reference system have been prepared, create a plot with <code>ggplot2::ggplot()</code>. Identifying the data set to be plotted within the <code>geom_sf()</code> arguement informs the function that the data is an <code>sf</code> object.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="chapter-intro-spatial-data-analysis.html#cb44-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-2"><a href="chapter-intro-spatial-data-analysis.html#cb44-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb44-3"><a href="chapter-intro-spatial-data-analysis.html#cb44-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_sf,</span>
<span id="cb44-4"><a href="chapter-intro-spatial-data-analysis.html#cb44-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb44-5"><a href="chapter-intro-spatial-data-analysis.html#cb44-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-6"><a href="chapter-intro-spatial-data-analysis.html#cb44-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb44-7"><a href="chapter-intro-spatial-data-analysis.html#cb44-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb44-8"><a href="chapter-intro-spatial-data-analysis.html#cb44-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-9"><a href="chapter-intro-spatial-data-analysis.html#cb44-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="chapter-intro-spatial-data-analysis.html#cb44-10" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-11"><a href="chapter-intro-spatial-data-analysis.html#cb44-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb44-12"><a href="chapter-intro-spatial-data-analysis.html#cb44-12" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_sf_original.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>The wildfire smoke plume polygons are clearly visible and colored according to their individual smoke density classification. This plot, however, is difficult to interpret for two reasons. First, there are multiple polygons for each smoke density classification. Multiple borders and overlapping polygons with the same smoke density type can be confusing. To make the polygons more clear, individual polygons for each smoke density classification can be combined.</p>
<div class="warning">
<p>For the purposes of these exploratory analyses, the satellite travelling direction and time of collection will be ignored.</p>
</div>
</div>
<div id="union" class="section level4 unnumbered hasAnchor">
<h4>Union<a href="chapter-intro-spatial-data-analysis.html#union" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Individual polygons can be unioned (combined) into one multi-part polygon with <code>sf::st_union</code>. The <code>group_by(Density)</code> argument specifies that the polygons should be combined based on the value stored in <code>$Density</code>. Adding the <code>Date = paste0(...</code> argument within the <code>dplyr::summarise()</code> function creates a parameter to store the date based on the year, month, and day of the data (defined in 2.0 Access, download, and unzip).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="chapter-intro-spatial-data-analysis.html#cb45-1" tabindex="-1"></a>smoke_sf_density <span class="ot">&lt;-</span></span>
<span id="cb45-2"><a href="chapter-intro-spatial-data-analysis.html#cb45-2" tabindex="-1"></a>  smoke_sf <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="chapter-intro-spatial-data-analysis.html#cb45-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Density) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="chapter-intro-spatial-data-analysis.html#cb45-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-5"><a href="chapter-intro-spatial-data-analysis.html#cb45-5" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">st_union</span>(geometry),</span>
<span id="cb45-6"><a href="chapter-intro-spatial-data-analysis.html#cb45-6" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">paste0</span>(</span>
<span id="cb45-7"><a href="chapter-intro-spatial-data-analysis.html#cb45-7" tabindex="-1"></a>      year,</span>
<span id="cb45-8"><a href="chapter-intro-spatial-data-analysis.html#cb45-8" tabindex="-1"></a>      month,</span>
<span id="cb45-9"><a href="chapter-intro-spatial-data-analysis.html#cb45-9" tabindex="-1"></a>      day</span>
<span id="cb45-10"><a href="chapter-intro-spatial-data-analysis.html#cb45-10" tabindex="-1"></a>    )</span>
<span id="cb45-11"><a href="chapter-intro-spatial-data-analysis.html#cb45-11" tabindex="-1"></a>  )</span></code></pre></div>
<p>The resulting data set contains three multi-polygons, a column for the smoke plume classification, and a column for the date.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="chapter-intro-spatial-data-analysis.html#cb46-1" tabindex="-1"></a>smoke_sf_density</span></code></pre></div>
<p>Creating a new plot with <code>smoke_sf_density</code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="chapter-intro-spatial-data-analysis.html#cb47-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-2"><a href="chapter-intro-spatial-data-analysis.html#cb47-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb47-3"><a href="chapter-intro-spatial-data-analysis.html#cb47-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_sf_density,</span>
<span id="cb47-4"><a href="chapter-intro-spatial-data-analysis.html#cb47-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb47-5"><a href="chapter-intro-spatial-data-analysis.html#cb47-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-6"><a href="chapter-intro-spatial-data-analysis.html#cb47-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb47-7"><a href="chapter-intro-spatial-data-analysis.html#cb47-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb47-8"><a href="chapter-intro-spatial-data-analysis.html#cb47-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-9"><a href="chapter-intro-spatial-data-analysis.html#cb47-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (unioned)&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="chapter-intro-spatial-data-analysis.html#cb47-10" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-11"><a href="chapter-intro-spatial-data-analysis.html#cb47-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb47-12"><a href="chapter-intro-spatial-data-analysis.html#cb47-12" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_sf_unioned.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>The plot is still difficult to interpret because it lacks geospatial context. The grid lines provide latitude and longitude references, but physical or geopolitical boundaries can help show where the wildfire smoke plumes are relative to the study area of interest. To provide geospatial context to the wildfire smoke plume polygons, we can add the United States’ state boundary polygons to the plot.</p>
</div>
<div id="plot-multiple" class="section level4 unnumbered hasAnchor">
<h4>Plot (multiple)<a href="chapter-intro-spatial-data-analysis.html#plot-multiple" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The steps taken to access, download, unzip, and import the United States’ state boundary data are the same as those taken for the wildfire smoke plume coverage data. Refer to sections 2.0 Access, download, and unzip, and 2.1.1 Import for detailed descriptions.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="chapter-intro-spatial-data-analysis.html#cb48-1" tabindex="-1"></a>url_states <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="chapter-intro-spatial-data-analysis.html#cb48-2" tabindex="-1"></a>  <span class="st">&quot;https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_state_500k.zip&quot;</span></span>
<span id="cb48-3"><a href="chapter-intro-spatial-data-analysis.html#cb48-3" tabindex="-1"></a></span>
<span id="cb48-4"><a href="chapter-intro-spatial-data-analysis.html#cb48-4" tabindex="-1"></a>destination_states <span class="ot">&lt;-</span> <span class="st">&quot;/   YOUR FILE PATH   /states.zip&quot;</span></span>
<span id="cb48-5"><a href="chapter-intro-spatial-data-analysis.html#cb48-5" tabindex="-1"></a></span>
<span id="cb48-6"><a href="chapter-intro-spatial-data-analysis.html#cb48-6" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb48-7"><a href="chapter-intro-spatial-data-analysis.html#cb48-7" tabindex="-1"></a>  url_states,</span>
<span id="cb48-8"><a href="chapter-intro-spatial-data-analysis.html#cb48-8" tabindex="-1"></a>  destination_states</span>
<span id="cb48-9"><a href="chapter-intro-spatial-data-analysis.html#cb48-9" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chapter-intro-spatial-data-analysis.html#cb49-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /states.zip&quot;</span>,</span>
<span id="cb49-2"><a href="chapter-intro-spatial-data-analysis.html#cb49-2" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">TRUE</span></span>
<span id="cb49-3"><a href="chapter-intro-spatial-data-analysis.html#cb49-3" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="chapter-intro-spatial-data-analysis.html#cb50-1" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/   YOUR FILE PATH   /states.zip&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="chapter-intro-spatial-data-analysis.html#cb51-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;/   YOUR FILE PATH   /&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="chapter-intro-spatial-data-analysis.html#cb52-1" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;/   YOUR FILE PATH   /cb_2018_us_state.shp&quot;</span>)</span></code></pre></div>
<p>Inspect the structure of <code>states_sf</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="chapter-intro-spatial-data-analysis.html#cb53-1" tabindex="-1"></a><span class="fu">str</span>(states_sf,</span>
<span id="cb53-2"><a href="chapter-intro-spatial-data-analysis.html#cb53-2" tabindex="-1"></a>  <span class="at">vec.len =</span> <span class="dv">2</span></span>
<span id="cb53-3"><a href="chapter-intro-spatial-data-analysis.html#cb53-3" tabindex="-1"></a>)</span></code></pre></div>
<p>For the purpose of these exploratory analyses, only the coterminous (CONUS) United States will be used. Subset <code>states_sf</code> to remove Alaska, Hawaii, and the United States’ territories.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="chapter-intro-spatial-data-analysis.html#cb54-1" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb54-2"><a href="chapter-intro-spatial-data-analysis.html#cb54-2" tabindex="-1"></a>  <span class="st">&quot;Alaska&quot;</span>,</span>
<span id="cb54-3"><a href="chapter-intro-spatial-data-analysis.html#cb54-3" tabindex="-1"></a>  <span class="st">&quot;Hawaii&quot;</span>,</span>
<span id="cb54-4"><a href="chapter-intro-spatial-data-analysis.html#cb54-4" tabindex="-1"></a>  <span class="st">&quot;Puerto Rico&quot;</span>,</span>
<span id="cb54-5"><a href="chapter-intro-spatial-data-analysis.html#cb54-5" tabindex="-1"></a>  <span class="st">&quot;United States Virgin Islands&quot;</span>,</span>
<span id="cb54-6"><a href="chapter-intro-spatial-data-analysis.html#cb54-6" tabindex="-1"></a>  <span class="st">&quot;Commonwealth of the Northern Mariana Islands&quot;</span>,</span>
<span id="cb54-7"><a href="chapter-intro-spatial-data-analysis.html#cb54-7" tabindex="-1"></a>  <span class="st">&quot;Guam&quot;</span>,</span>
<span id="cb54-8"><a href="chapter-intro-spatial-data-analysis.html#cb54-8" tabindex="-1"></a>  <span class="st">&quot;American Samoa&quot;</span></span>
<span id="cb54-9"><a href="chapter-intro-spatial-data-analysis.html#cb54-9" tabindex="-1"></a>)</span>
<span id="cb54-10"><a href="chapter-intro-spatial-data-analysis.html#cb54-10" tabindex="-1"></a></span>
<span id="cb54-11"><a href="chapter-intro-spatial-data-analysis.html#cb54-11" tabindex="-1"></a>conus_sf <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb54-12"><a href="chapter-intro-spatial-data-analysis.html#cb54-12" tabindex="-1"></a>  states_sf,</span>
<span id="cb54-13"><a href="chapter-intro-spatial-data-analysis.html#cb54-13" tabindex="-1"></a>  <span class="sc">!</span>NAME <span class="sc">%in%</span> remove</span>
<span id="cb54-14"><a href="chapter-intro-spatial-data-analysis.html#cb54-14" tabindex="-1"></a>)</span></code></pre></div>
<p>Check the coordinate reference system.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapter-intro-spatial-data-analysis.html#cb55-1" tabindex="-1"></a><span class="fu">st_crs</span>(conus_sf)</span></code></pre></div>
<div class="important">
<p>When analyzing multiple spatial data sets together, all data sets must have the same coordinate reference system or projected coordinate system.</p>
</div>
<p>Transform <code>conus_sf</code> to match the projected coordinate system of the <code>smoke_sf_density</code> data set.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="chapter-intro-spatial-data-analysis.html#cb56-1" tabindex="-1"></a>conus_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(</span>
<span id="cb56-2"><a href="chapter-intro-spatial-data-analysis.html#cb56-2" tabindex="-1"></a>  conus_sf,</span>
<span id="cb56-3"><a href="chapter-intro-spatial-data-analysis.html#cb56-3" tabindex="-1"></a>  <span class="fu">st_crs</span>(smoke_sf_density)</span>
<span id="cb56-4"><a href="chapter-intro-spatial-data-analysis.html#cb56-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the coterminous United States’s state boundaries.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="chapter-intro-spatial-data-analysis.html#cb57-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-2"><a href="chapter-intro-spatial-data-analysis.html#cb57-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> conus_sf) <span class="sc">+</span></span>
<span id="cb57-3"><a href="chapter-intro-spatial-data-analysis.html#cb57-3" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Coterminous United States&#39; State Boundaries&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-4"><a href="chapter-intro-spatial-data-analysis.html#cb57-4" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="chapter-intro-spatial-data-analysis.html#cb57-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb57-6"><a href="chapter-intro-spatial-data-analysis.html#cb57-6" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/conus_sf_original.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>With the wildfire smoke plume and coterminous United States polygons imported and prepared, ensure that they have the same coordinate reference system.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="chapter-intro-spatial-data-analysis.html#cb58-1" tabindex="-1"></a><span class="fu">st_crs</span>(smoke_sf_density) <span class="sc">==</span> <span class="fu">st_crs</span>(conus_sf)</span></code></pre></div>
<p>Create a plot which shows the distribution of wildfire smoke plumes over the coterminous United States’ state boundaries.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="chapter-intro-spatial-data-analysis.html#cb59-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-2"><a href="chapter-intro-spatial-data-analysis.html#cb59-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb59-3"><a href="chapter-intro-spatial-data-analysis.html#cb59-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_sf_density,</span>
<span id="cb59-4"><a href="chapter-intro-spatial-data-analysis.html#cb59-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb59-5"><a href="chapter-intro-spatial-data-analysis.html#cb59-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-6"><a href="chapter-intro-spatial-data-analysis.html#cb59-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb59-7"><a href="chapter-intro-spatial-data-analysis.html#cb59-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb59-8"><a href="chapter-intro-spatial-data-analysis.html#cb59-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-9"><a href="chapter-intro-spatial-data-analysis.html#cb59-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb59-10"><a href="chapter-intro-spatial-data-analysis.html#cb59-10" tabindex="-1"></a>    <span class="at">data =</span> conus_sf,</span>
<span id="cb59-11"><a href="chapter-intro-spatial-data-analysis.html#cb59-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb59-12"><a href="chapter-intro-spatial-data-analysis.html#cb59-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-13"><a href="chapter-intro-spatial-data-analysis.html#cb59-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (with states)&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-14"><a href="chapter-intro-spatial-data-analysis.html#cb59-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-15"><a href="chapter-intro-spatial-data-analysis.html#cb59-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb59-16"><a href="chapter-intro-spatial-data-analysis.html#cb59-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_sf_states.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>This plot provides important geospatial context for understanding where the wildfire smoke plumes are in relation to the study area of interest.</p>
</div>
<div id="crop" class="section level4 unnumbered hasAnchor">
<h4>Crop<a href="chapter-intro-spatial-data-analysis.html#crop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>sf::st_crop()</code> function can be used to reduce the extent of a set of polygons to a specific rectangle, typically the bounding box of another spatial data set. In this example we can crop the <code>smoke_sf_density</code> polygons to the bounding box surrounding the coterminous United States.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="chapter-intro-spatial-data-analysis.html#cb60-1" tabindex="-1"></a>smoke_sf_crop <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(</span>
<span id="cb60-2"><a href="chapter-intro-spatial-data-analysis.html#cb60-2" tabindex="-1"></a>  smoke_sf_density,</span>
<span id="cb60-3"><a href="chapter-intro-spatial-data-analysis.html#cb60-3" tabindex="-1"></a>  conus_sf</span>
<span id="cb60-4"><a href="chapter-intro-spatial-data-analysis.html#cb60-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the cropped wildfire smoke plume polygons and the coterminous United States’ state boundaries.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="chapter-intro-spatial-data-analysis.html#cb61-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-2"><a href="chapter-intro-spatial-data-analysis.html#cb61-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb61-3"><a href="chapter-intro-spatial-data-analysis.html#cb61-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_sf_crop,</span>
<span id="cb61-4"><a href="chapter-intro-spatial-data-analysis.html#cb61-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb61-5"><a href="chapter-intro-spatial-data-analysis.html#cb61-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-6"><a href="chapter-intro-spatial-data-analysis.html#cb61-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb61-7"><a href="chapter-intro-spatial-data-analysis.html#cb61-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb61-8"><a href="chapter-intro-spatial-data-analysis.html#cb61-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-9"><a href="chapter-intro-spatial-data-analysis.html#cb61-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb61-10"><a href="chapter-intro-spatial-data-analysis.html#cb61-10" tabindex="-1"></a>    <span class="at">data =</span> conus_sf,</span>
<span id="cb61-11"><a href="chapter-intro-spatial-data-analysis.html#cb61-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb61-12"><a href="chapter-intro-spatial-data-analysis.html#cb61-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-13"><a href="chapter-intro-spatial-data-analysis.html#cb61-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (cropped)&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-14"><a href="chapter-intro-spatial-data-analysis.html#cb61-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-15"><a href="chapter-intro-spatial-data-analysis.html#cb61-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb61-16"><a href="chapter-intro-spatial-data-analysis.html#cb61-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_sf_cropped.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
</div>
<div id="polygon-data-with-terra" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Polygon Data with <code>terra</code><a href="chapter-intro-spatial-data-analysis.html#polygon-data-with-terra" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section will focus on exploratory analyses with polygon data using the <code>terra</code> package.</p>
<div id="import-2" class="section level4 unnumbered hasAnchor">
<h4>Import<a href="chapter-intro-spatial-data-analysis.html#import-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that the contents of the zip files have been saved on your machine and the data files of interest have been identified, import both the wildfire smoke plume coverage data and the United States’ state boundary data with <code>terra::vect()</code>.</p>
<div class="note">
<p>See sections 2.0 Access, download, and unzip and 2.1.7 Plot (multiple) for obtaining the wildfire smoke plume coverage and United States’ state boundary data sets, respectively.</p>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="chapter-intro-spatial-data-analysis.html#cb62-1" tabindex="-1"></a>smoke_t <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&quot;/   YOUR FILE PATH   /hms_smoke20230901.shp&quot;</span>)</span>
<span id="cb62-2"><a href="chapter-intro-spatial-data-analysis.html#cb62-2" tabindex="-1"></a>states_t <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&quot;/   YOUR FILE PATH   /cb_2018_us_state_500k.shp&quot;</span>)</span></code></pre></div>
</div>
<div id="inspect-structure-2" class="section level4 unnumbered hasAnchor">
<h4>Inspect structure<a href="chapter-intro-spatial-data-analysis.html#inspect-structure-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Inspect the structures of <code>smoke_t</code> and <code>states_t</code> to see their classes, column names, column classes.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="chapter-intro-spatial-data-analysis.html#cb63-1" tabindex="-1"></a>smoke_t</span>
<span id="cb63-2"><a href="chapter-intro-spatial-data-analysis.html#cb63-2" tabindex="-1"></a>states_t</span></code></pre></div>
<p>Both <code>smoke_t</code> and <code>states_t</code> have native spatial features. These are reflected by the type of spatial data in <code>geometry:</code>, and the spatial attributes <code>extent:</code> and <code>coord. ref.:</code></p>
</div>
<div id="reclassify-2" class="section level4 unnumbered hasAnchor">
<h4>Reclassify<a href="chapter-intro-spatial-data-analysis.html#reclassify-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The main parameter of interest in this data set is <code>$Density</code>, which discretely categorizes each wildfire smoke plume as “Light”, “Medium”, or “Heavy”. Checking its class shows that <code>$Density</code> is class character.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="chapter-intro-spatial-data-analysis.html#cb64-1" tabindex="-1"></a><span class="fu">class</span>(smoke_t<span class="sc">$</span>Density)</span></code></pre></div>
<p>Nominal data, data without fixed order or rank system, can be stored as class character (ie. State names). However, it is best to store ordinal data as class factor for conducting analyses in R.</p>
<p>Converting data from class character to class factor can be done with <code>factor()</code>. The <code>levels = c()</code> argument in the function specifies both the level names and the ranked order of the levels.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="chapter-intro-spatial-data-analysis.html#cb65-1" tabindex="-1"></a>smoke_t<span class="sc">$</span>Density <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke_t<span class="sc">$</span>Density,</span>
<span id="cb65-2"><a href="chapter-intro-spatial-data-analysis.html#cb65-2" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Light&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Heavy&quot;</span>)</span>
<span id="cb65-3"><a href="chapter-intro-spatial-data-analysis.html#cb65-3" tabindex="-1"></a>)</span></code></pre></div>
<p>Check the class of <code>$Density</code> again to ensure proper reclassification.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="chapter-intro-spatial-data-analysis.html#cb66-1" tabindex="-1"></a><span class="fu">class</span>(smoke_t<span class="sc">$</span>Density)</span></code></pre></div>
<p>For the purpose of these exploratory analyses, only the coterminous (CONUS) United States will be used. Subset <code>states_t</code> to remove Alaska, Hawaii, and the United States’ territories.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="chapter-intro-spatial-data-analysis.html#cb67-1" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb67-2"><a href="chapter-intro-spatial-data-analysis.html#cb67-2" tabindex="-1"></a>  <span class="st">&quot;Alaska&quot;</span>,</span>
<span id="cb67-3"><a href="chapter-intro-spatial-data-analysis.html#cb67-3" tabindex="-1"></a>  <span class="st">&quot;Hawaii&quot;</span>,</span>
<span id="cb67-4"><a href="chapter-intro-spatial-data-analysis.html#cb67-4" tabindex="-1"></a>  <span class="st">&quot;Puerto Rico&quot;</span>,</span>
<span id="cb67-5"><a href="chapter-intro-spatial-data-analysis.html#cb67-5" tabindex="-1"></a>  <span class="st">&quot;United States Virgin Islands&quot;</span>,</span>
<span id="cb67-6"><a href="chapter-intro-spatial-data-analysis.html#cb67-6" tabindex="-1"></a>  <span class="st">&quot;Commonwealth of the Northern Mariana Islands&quot;</span>,</span>
<span id="cb67-7"><a href="chapter-intro-spatial-data-analysis.html#cb67-7" tabindex="-1"></a>  <span class="st">&quot;Guam&quot;</span>,</span>
<span id="cb67-8"><a href="chapter-intro-spatial-data-analysis.html#cb67-8" tabindex="-1"></a>  <span class="st">&quot;American Samoa&quot;</span></span>
<span id="cb67-9"><a href="chapter-intro-spatial-data-analysis.html#cb67-9" tabindex="-1"></a>)</span>
<span id="cb67-10"><a href="chapter-intro-spatial-data-analysis.html#cb67-10" tabindex="-1"></a></span>
<span id="cb67-11"><a href="chapter-intro-spatial-data-analysis.html#cb67-11" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb67-12"><a href="chapter-intro-spatial-data-analysis.html#cb67-12" tabindex="-1"></a>  states_t,</span>
<span id="cb67-13"><a href="chapter-intro-spatial-data-analysis.html#cb67-13" tabindex="-1"></a>  <span class="sc">!</span>states_t<span class="sc">$</span>NAME <span class="sc">%in%</span> remove</span>
<span id="cb67-14"><a href="chapter-intro-spatial-data-analysis.html#cb67-14" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="coordinate-reference-system-and-projection-2" class="section level4 unnumbered hasAnchor">
<h4>Coordinate reference system and projection<a href="chapter-intro-spatial-data-analysis.html#coordinate-reference-system-and-projection-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Check the coordinate reference systems of <code>SpatVector</code> objects with <code>terra::crs()</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="chapter-intro-spatial-data-analysis.html#cb68-1" tabindex="-1"></a><span class="fu">crs</span>(smoke_t,</span>
<span id="cb68-2"><a href="chapter-intro-spatial-data-analysis.html#cb68-2" tabindex="-1"></a>  <span class="at">describe =</span> <span class="cn">TRUE</span></span>
<span id="cb68-3"><a href="chapter-intro-spatial-data-analysis.html#cb68-3" tabindex="-1"></a>)</span>
<span id="cb68-4"><a href="chapter-intro-spatial-data-analysis.html#cb68-4" tabindex="-1"></a><span class="fu">crs</span>(conus_t,</span>
<span id="cb68-5"><a href="chapter-intro-spatial-data-analysis.html#cb68-5" tabindex="-1"></a>  <span class="at">describe =</span> <span class="cn">TRUE</span></span>
<span id="cb68-6"><a href="chapter-intro-spatial-data-analysis.html#cb68-6" tabindex="-1"></a>)</span></code></pre></div>
<p>Both data sets have native coordinate reference systems which were imported during the <code>terra::vect()</code> step. The two data sets, however, have different coordinate reference systems from each other. The area of interest for these exploratory analyses is the coterminous United States, so we can project <code>smoke_t</code> and <code>conus_t</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="chapter-intro-spatial-data-analysis.html#cb69-1" tabindex="-1"></a>smoke_t <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb69-2"><a href="chapter-intro-spatial-data-analysis.html#cb69-2" tabindex="-1"></a>  smoke_t,</span>
<span id="cb69-3"><a href="chapter-intro-spatial-data-analysis.html#cb69-3" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb69-4"><a href="chapter-intro-spatial-data-analysis.html#cb69-4" tabindex="-1"></a>)</span>
<span id="cb69-5"><a href="chapter-intro-spatial-data-analysis.html#cb69-5" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb69-6"><a href="chapter-intro-spatial-data-analysis.html#cb69-6" tabindex="-1"></a>  conus_t,</span>
<span id="cb69-7"><a href="chapter-intro-spatial-data-analysis.html#cb69-7" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb69-8"><a href="chapter-intro-spatial-data-analysis.html#cb69-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Although both data sets were transformed to the same projected coordinate system, it is important to ensure that all data sets have the same coordinate reference system or projected coordinate system.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="chapter-intro-spatial-data-analysis.html#cb70-1" tabindex="-1"></a><span class="fu">crs</span>(smoke_t) <span class="sc">==</span> <span class="fu">crs</span>(conus_t)</span></code></pre></div>
</div>
<div id="plot-multiple-1" class="section level4 unnumbered hasAnchor">
<h4>Plot (multiple)<a href="chapter-intro-spatial-data-analysis.html#plot-multiple-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Plot both data sets together in one plot with <code>ggplot2::ggplot()</code>.</p>
<p>Now that the parameters of interest and coordinate reference systems have been prepared, create a plot with <code>ggplot2::ggplot()</code>. Identifying the data sets to be plotted within the <code>geom_spatvector()</code> arguments informs the function that the data are <code>SpatVector</code> objects.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="chapter-intro-spatial-data-analysis.html#cb71-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb71-2"><a href="chapter-intro-spatial-data-analysis.html#cb71-2" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb71-3"><a href="chapter-intro-spatial-data-analysis.html#cb71-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_t,</span>
<span id="cb71-4"><a href="chapter-intro-spatial-data-analysis.html#cb71-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb71-5"><a href="chapter-intro-spatial-data-analysis.html#cb71-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-6"><a href="chapter-intro-spatial-data-analysis.html#cb71-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb71-7"><a href="chapter-intro-spatial-data-analysis.html#cb71-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb71-8"><a href="chapter-intro-spatial-data-analysis.html#cb71-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-9"><a href="chapter-intro-spatial-data-analysis.html#cb71-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb71-10"><a href="chapter-intro-spatial-data-analysis.html#cb71-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb71-11"><a href="chapter-intro-spatial-data-analysis.html#cb71-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb71-12"><a href="chapter-intro-spatial-data-analysis.html#cb71-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-13"><a href="chapter-intro-spatial-data-analysis.html#cb71-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (with states)&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-14"><a href="chapter-intro-spatial-data-analysis.html#cb71-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-15"><a href="chapter-intro-spatial-data-analysis.html#cb71-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb71-16"><a href="chapter-intro-spatial-data-analysis.html#cb71-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_terra_original.png" width = "75%" height = "auto" class = "centerimage"></p>
<p>The wildfire smoke plume polygons are clearly visible and colored according to their individual smoke density classification. The plot, however, is difficult to interpret because there are multiple polygons for each smoke density classification. Multiple borders and overlapping polygons with the same smoke density type can be confusing. To make the polygons more clear, individual polygons for each smoke density classification can be combined.</p>
<div class="warning">
<p>For the purposes of these exploratory analyses, the satellite travelling direction and time of collection will be ignored.</p>
</div>
</div>
<div id="aggregate" class="section level4 unnumbered hasAnchor">
<h4>Aggregate<a href="chapter-intro-spatial-data-analysis.html#aggregate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Individual polygons an be aggregated (combined) into one multi-part polygon with <code>terra::aggregate()</code>. The <code>by = "Density"</code> argument specifies that the polygons should be combined based on the value stored in <code>$Density</code>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="chapter-intro-spatial-data-analysis.html#cb72-1" tabindex="-1"></a>smoke_t_density <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(smoke_t,</span>
<span id="cb72-2"><a href="chapter-intro-spatial-data-analysis.html#cb72-2" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb72-3"><a href="chapter-intro-spatial-data-analysis.html#cb72-3" tabindex="-1"></a>  <span class="at">dissolve =</span> <span class="cn">TRUE</span></span>
<span id="cb72-4"><a href="chapter-intro-spatial-data-analysis.html#cb72-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Aggregating the polygons based on the values stored in the <code>$Density</code> column can result in the other columns containing <code>NA</code> values. To remove these columns, subset <code>smoke_t_density</code> to remove <code>$Satellite</code>, <code>$Start</code>, and <code>$End</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="chapter-intro-spatial-data-analysis.html#cb73-1" tabindex="-1"></a>smoke_t_density <span class="ot">&lt;-</span> smoke_t_density[</span>
<span id="cb73-2"><a href="chapter-intro-spatial-data-analysis.html#cb73-2" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(smoke_t_density)),</span>
<span id="cb73-3"><a href="chapter-intro-spatial-data-analysis.html#cb73-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;Density&quot;</span>, <span class="st">&quot;agg_n&quot;</span>)</span>
<span id="cb73-4"><a href="chapter-intro-spatial-data-analysis.html#cb73-4" tabindex="-1"></a>]</span></code></pre></div>
<p>The resulting data set contains three multi-polygons, a column for the smoke plume classification, and a count of the number of individual polygons that were aggregated to create the multi-polygon. This last column, <code>$agg_n</code> is automatically calculated by the <code>terra::aggregate()</code> function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="chapter-intro-spatial-data-analysis.html#cb74-1" tabindex="-1"></a>smoke_t_density</span></code></pre></div>
<p>Create a new plot with <code>smoke_t_density</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="chapter-intro-spatial-data-analysis.html#cb75-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-2"><a href="chapter-intro-spatial-data-analysis.html#cb75-2" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb75-3"><a href="chapter-intro-spatial-data-analysis.html#cb75-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_t_density,</span>
<span id="cb75-4"><a href="chapter-intro-spatial-data-analysis.html#cb75-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb75-5"><a href="chapter-intro-spatial-data-analysis.html#cb75-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb75-6"><a href="chapter-intro-spatial-data-analysis.html#cb75-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb75-7"><a href="chapter-intro-spatial-data-analysis.html#cb75-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb75-8"><a href="chapter-intro-spatial-data-analysis.html#cb75-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb75-9"><a href="chapter-intro-spatial-data-analysis.html#cb75-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb75-10"><a href="chapter-intro-spatial-data-analysis.html#cb75-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb75-11"><a href="chapter-intro-spatial-data-analysis.html#cb75-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb75-12"><a href="chapter-intro-spatial-data-analysis.html#cb75-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb75-13"><a href="chapter-intro-spatial-data-analysis.html#cb75-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (aggregated)&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-14"><a href="chapter-intro-spatial-data-analysis.html#cb75-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-15"><a href="chapter-intro-spatial-data-analysis.html#cb75-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb75-16"><a href="chapter-intro-spatial-data-analysis.html#cb75-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_terra_aggregated.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="crop-1" class="section level4 unnumbered hasAnchor">
<h4>Crop<a href="chapter-intro-spatial-data-analysis.html#crop-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>terra::crop()</code> function can be used to reduce <code>SpatVector</code> to an area determined by another <code>SpatVector</code>. In this example, we can crop the <code>smoke_t_density</code> polygons to the coterminous United States’ state boundaries.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="chapter-intro-spatial-data-analysis.html#cb76-1" tabindex="-1"></a>smoke_t_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb76-2"><a href="chapter-intro-spatial-data-analysis.html#cb76-2" tabindex="-1"></a>  smoke_t_density,</span>
<span id="cb76-3"><a href="chapter-intro-spatial-data-analysis.html#cb76-3" tabindex="-1"></a>  conus_t</span>
<span id="cb76-4"><a href="chapter-intro-spatial-data-analysis.html#cb76-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the cropped wildfire smoke plume polygons and the coterminous United States’ state boundaries.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="chapter-intro-spatial-data-analysis.html#cb77-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb77-2"><a href="chapter-intro-spatial-data-analysis.html#cb77-2" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb77-3"><a href="chapter-intro-spatial-data-analysis.html#cb77-3" tabindex="-1"></a>    <span class="at">data =</span> smoke_t_crop,</span>
<span id="cb77-4"><a href="chapter-intro-spatial-data-analysis.html#cb77-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> Density)</span>
<span id="cb77-5"><a href="chapter-intro-spatial-data-analysis.html#cb77-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-6"><a href="chapter-intro-spatial-data-analysis.html#cb77-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Smoke Density&quot;</span>,</span>
<span id="cb77-7"><a href="chapter-intro-spatial-data-analysis.html#cb77-7" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb77-8"><a href="chapter-intro-spatial-data-analysis.html#cb77-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-9"><a href="chapter-intro-spatial-data-analysis.html#cb77-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb77-10"><a href="chapter-intro-spatial-data-analysis.html#cb77-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb77-11"><a href="chapter-intro-spatial-data-analysis.html#cb77-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb77-12"><a href="chapter-intro-spatial-data-analysis.html#cb77-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-13"><a href="chapter-intro-spatial-data-analysis.html#cb77-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wildfire Smoke Plumes (cropped)&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-14"><a href="chapter-intro-spatial-data-analysis.html#cb77-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-15"><a href="chapter-intro-spatial-data-analysis.html#cb77-15" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb77-16"><a href="chapter-intro-spatial-data-analysis.html#cb77-16" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb77-17"><a href="chapter-intro-spatial-data-analysis.html#cb77-17" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-18"><a href="chapter-intro-spatial-data-analysis.html#cb77-18" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-19"><a href="chapter-intro-spatial-data-analysis.html#cb77-19" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb77-20"><a href="chapter-intro-spatial-data-analysis.html#cb77-20" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_polygons_terra_cropped.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="zonal-statistics" class="section level4 unnumbered hasAnchor">
<h4>Zonal statistics<a href="chapter-intro-spatial-data-analysis.html#zonal-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Looking closely at the previous plot, it is clear that wildfire smoke plumes cover each state differently. The <code>terra</code> package can be used to identify which states are covered by each classification of wildfire smoke plumes.</p>
<p>The <code>terra::relate()</code> function can be used to identify spatial relationships between two <code>SpatVector</code> objects. The <code>relation = "intersects"</code> argument logically identifies if any portion of each state is or is not covered by each of the three wildfire smoke plume classification multi-polygons.</p>
<p>The output of <code>terra::relate()</code> is a wide matrix. The nested <code>data.frame()</code> and <code>t()</code> wrappers convert the output from a wide matrix to a long data frame, which is required to combine the results with the <code>conus_t</code> data set.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="chapter-intro-spatial-data-analysis.html#cb78-1" tabindex="-1"></a>conus_smoke <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-2"><a href="chapter-intro-spatial-data-analysis.html#cb78-2" tabindex="-1"></a>  <span class="fu">t</span>(</span>
<span id="cb78-3"><a href="chapter-intro-spatial-data-analysis.html#cb78-3" tabindex="-1"></a>    <span class="fu">relate</span>(smoke_t_density,</span>
<span id="cb78-4"><a href="chapter-intro-spatial-data-analysis.html#cb78-4" tabindex="-1"></a>      conus_t,</span>
<span id="cb78-5"><a href="chapter-intro-spatial-data-analysis.html#cb78-5" tabindex="-1"></a>      <span class="at">relation =</span> <span class="st">&quot;intersects&quot;</span></span>
<span id="cb78-6"><a href="chapter-intro-spatial-data-analysis.html#cb78-6" tabindex="-1"></a>    )</span>
<span id="cb78-7"><a href="chapter-intro-spatial-data-analysis.html#cb78-7" tabindex="-1"></a>  )</span>
<span id="cb78-8"><a href="chapter-intro-spatial-data-analysis.html#cb78-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Set the column names of <code>conus_smoke</code> to match the smoke density classifications.</p>
<div class="note">
<p>The order of the columns in <code>conus_smoke</code> are based on the ordered factor levels in <code>smoke_t_density$Density</code> (see 2.2.3 Reclassify).</p>
</div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="chapter-intro-spatial-data-analysis.html#cb79-1" tabindex="-1"></a><span class="fu">colnames</span>(conus_smoke) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Light&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Heavy&quot;</span>)</span></code></pre></div>
<p>Combine the wildfire smoke plume indicator data frame with the the coterminous United States’ state boundaries data.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="chapter-intro-spatial-data-analysis.html#cb80-1" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb80-2"><a href="chapter-intro-spatial-data-analysis.html#cb80-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb80-3"><a href="chapter-intro-spatial-data-analysis.html#cb80-3" tabindex="-1"></a>  conus_smoke</span>
<span id="cb80-4"><a href="chapter-intro-spatial-data-analysis.html#cb80-4" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code>conus_t</code> data set now contains separate columns indicating the presence or absence of “Light”, “Medium”, and “Heavy” wildfire smoke plumes for each coterminous state.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="chapter-intro-spatial-data-analysis.html#cb81-1" tabindex="-1"></a><span class="fu">names</span>(conus_t)</span></code></pre></div>
</div>
<div id="plot-for-loop" class="section level4 unnumbered hasAnchor">
<h4>Plot (<code>for</code> Loop)<a href="chapter-intro-spatial-data-analysis.html#plot-for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A <code>for</code> loop can be used to create indicator plots for each wildfire smoke plume classification. The layout of a <code>for</code> loop can look complicated, but it simply applies the same set of functions to a given list of inputs.</p>
<p>The list of inputs must first be created. As the goal is to plot each of the wildfire smoke plume density classifications, create a character vector of the three classification names.</p>
<p>This “list of inputs” must first be created. Store the three wildfire smoke plume classifications in a vector of class character.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="chapter-intro-spatial-data-analysis.html#cb82-1" tabindex="-1"></a>dens_c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Light&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Heavy&quot;</span>)</span></code></pre></div>
<p>Create a <code>for</code> loop that creates a plot for each wildfire smoke plume density stored within <code>dens_c</code>.</p>
<p>Code line 1 tells the <code>for</code> loop to apply the following functions to each observation in <code>dens_c</code>.</p>
<p>Code lines 3 through 9 define the plotting colors based on the wildfire smoke plume classification (<code>dens_c[d]</code>). As in previous plots, “Light” smoke plumes will be colored green, “Medium” smoke plumes will be covered yellow, and “Heavy” smoke plumes will be colored red.</p>
<p>Code lines 12 through 32 create the plot based on the wildfire smoke plume classification (<code>dens_c[d]</code>), and previously defined plotting colors (<code>color_values</code>).</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="chapter-intro-spatial-data-analysis.html#cb83-1" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> <span class="fu">seq_along</span>(dens_c)) {</span>
<span id="cb83-2"><a href="chapter-intro-spatial-data-analysis.html#cb83-2" tabindex="-1"></a>  <span class="co"># define color palette based on smoke density</span></span>
<span id="cb83-3"><a href="chapter-intro-spatial-data-analysis.html#cb83-3" tabindex="-1"></a>  <span class="cf">if</span> (dens_c[d] <span class="sc">==</span> <span class="st">&quot;Light&quot;</span>) {</span>
<span id="cb83-4"><a href="chapter-intro-spatial-data-analysis.html#cb83-4" tabindex="-1"></a>    color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;lightgreen&quot;</span>)</span>
<span id="cb83-5"><a href="chapter-intro-spatial-data-analysis.html#cb83-5" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (dens_c[d] <span class="sc">==</span> <span class="st">&quot;Medium&quot;</span>) {</span>
<span id="cb83-6"><a href="chapter-intro-spatial-data-analysis.html#cb83-6" tabindex="-1"></a>    color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;lightgoldenrod&quot;</span>)</span>
<span id="cb83-7"><a href="chapter-intro-spatial-data-analysis.html#cb83-7" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (dens_c[d] <span class="sc">==</span> <span class="st">&quot;Heavy&quot;</span>) {</span>
<span id="cb83-8"><a href="chapter-intro-spatial-data-analysis.html#cb83-8" tabindex="-1"></a>    color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb83-9"><a href="chapter-intro-spatial-data-analysis.html#cb83-9" tabindex="-1"></a>  }</span>
<span id="cb83-10"><a href="chapter-intro-spatial-data-analysis.html#cb83-10" tabindex="-1"></a></span>
<span id="cb83-11"><a href="chapter-intro-spatial-data-analysis.html#cb83-11" tabindex="-1"></a>  <span class="co"># create plot</span></span>
<span id="cb83-12"><a href="chapter-intro-spatial-data-analysis.html#cb83-12" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb83-13"><a href="chapter-intro-spatial-data-analysis.html#cb83-13" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-14"><a href="chapter-intro-spatial-data-analysis.html#cb83-14" tabindex="-1"></a>      <span class="fu">geom_spatvector</span>(</span>
<span id="cb83-15"><a href="chapter-intro-spatial-data-analysis.html#cb83-15" tabindex="-1"></a>        <span class="at">data =</span> conus_t,</span>
<span id="cb83-16"><a href="chapter-intro-spatial-data-analysis.html#cb83-16" tabindex="-1"></a>        <span class="fu">aes_string</span>(<span class="at">fill =</span> dens_c[d])</span>
<span id="cb83-17"><a href="chapter-intro-spatial-data-analysis.html#cb83-17" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb83-18"><a href="chapter-intro-spatial-data-analysis.html#cb83-18" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(</span>
<span id="cb83-19"><a href="chapter-intro-spatial-data-analysis.html#cb83-19" tabindex="-1"></a>        <span class="fu">paste0</span>(</span>
<span id="cb83-20"><a href="chapter-intro-spatial-data-analysis.html#cb83-20" tabindex="-1"></a>          dens_c[d],</span>
<span id="cb83-21"><a href="chapter-intro-spatial-data-analysis.html#cb83-21" tabindex="-1"></a>          <span class="st">&quot; Smoke Plume Coverage Present&quot;</span></span>
<span id="cb83-22"><a href="chapter-intro-spatial-data-analysis.html#cb83-22" tabindex="-1"></a>        ),</span>
<span id="cb83-23"><a href="chapter-intro-spatial-data-analysis.html#cb83-23" tabindex="-1"></a>        <span class="at">values =</span> color_values</span>
<span id="cb83-24"><a href="chapter-intro-spatial-data-analysis.html#cb83-24" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb83-25"><a href="chapter-intro-spatial-data-analysis.html#cb83-25" tabindex="-1"></a>      <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-26"><a href="chapter-intro-spatial-data-analysis.html#cb83-26" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb83-27"><a href="chapter-intro-spatial-data-analysis.html#cb83-27" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb83-28"><a href="chapter-intro-spatial-data-analysis.html#cb83-28" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb83-29"><a href="chapter-intro-spatial-data-analysis.html#cb83-29" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb83-30"><a href="chapter-intro-spatial-data-analysis.html#cb83-30" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb83-31"><a href="chapter-intro-spatial-data-analysis.html#cb83-31" tabindex="-1"></a>      )</span>
<span id="cb83-32"><a href="chapter-intro-spatial-data-analysis.html#cb83-32" tabindex="-1"></a>  )</span>
<span id="cb83-33"><a href="chapter-intro-spatial-data-analysis.html#cb83-33" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="images/intro_to_spatial/smoke_zonal_light.png" width = "50%" height = "auto" class = "centerimage"></p>
<p><img src="images/intro_to_spatial/smoke_zonal_medium.png" width = "50%" height = "auto" class = "centerimage"></p>
<p><img src="images/intro_to_spatial/smoke_zonal_heavy.png" width = "50%" height = "auto" class = "centerimage"></p>
</div>
</div>
</div>
<div id="raster-data-with-terra" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Raster Data with <code>terra</code><a href="chapter-intro-spatial-data-analysis.html#raster-data-with-terra" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Air temperature data from the United States National Oceanic and Atmospheric Administration’s (NOAA) North American Regional Reanalysis (NARR) data set will be used to demonstrate using raster data with the <code>terra</code> package.</p>
<div id="access-and-download" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Access and download<a href="chapter-intro-spatial-data-analysis.html#access-and-download" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The website URL where the NOAA NARR exists is year-specific, meaning there is a unique URL for each annual data set. For the purpose of these exploratory analyses, air temperature data from the year 2021 will be used</p>
<p>Define the variable <code>year</code> according to the year of interest.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="chapter-intro-spatial-data-analysis.html#cb84-1" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="st">&quot;2021&quot;</span></span></code></pre></div>
<p>The <code>utils::download.file()</code> function downloads the file according to the defined URL and destination file.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="chapter-intro-spatial-data-analysis.html#cb85-1" tabindex="-1"></a><span class="co"># specify the URL where data is stored based on year variable of interest</span></span>
<span id="cb85-2"><a href="chapter-intro-spatial-data-analysis.html#cb85-2" tabindex="-1"></a>url_narr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb85-3"><a href="chapter-intro-spatial-data-analysis.html#cb85-3" tabindex="-1"></a>  <span class="st">&quot;https://downloads.psl.noaa.gov//Datasets/NARR/Dailies/monolevel/air.2m.&quot;</span>,</span>
<span id="cb85-4"><a href="chapter-intro-spatial-data-analysis.html#cb85-4" tabindex="-1"></a>  year,</span>
<span id="cb85-5"><a href="chapter-intro-spatial-data-analysis.html#cb85-5" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb85-6"><a href="chapter-intro-spatial-data-analysis.html#cb85-6" tabindex="-1"></a>)</span>
<span id="cb85-7"><a href="chapter-intro-spatial-data-analysis.html#cb85-7" tabindex="-1"></a></span>
<span id="cb85-8"><a href="chapter-intro-spatial-data-analysis.html#cb85-8" tabindex="-1"></a><span class="co"># specify where to save downloaded data</span></span>
<span id="cb85-9"><a href="chapter-intro-spatial-data-analysis.html#cb85-9" tabindex="-1"></a>destination_narr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb85-10"><a href="chapter-intro-spatial-data-analysis.html#cb85-10" tabindex="-1"></a>  <span class="st">&quot;/   YOUR FILE PATH   /narr_air2m_&quot;</span>,</span>
<span id="cb85-11"><a href="chapter-intro-spatial-data-analysis.html#cb85-11" tabindex="-1"></a>  year,</span>
<span id="cb85-12"><a href="chapter-intro-spatial-data-analysis.html#cb85-12" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb85-13"><a href="chapter-intro-spatial-data-analysis.html#cb85-13" tabindex="-1"></a>)</span>
<span id="cb85-14"><a href="chapter-intro-spatial-data-analysis.html#cb85-14" tabindex="-1"></a></span>
<span id="cb85-15"><a href="chapter-intro-spatial-data-analysis.html#cb85-15" tabindex="-1"></a><span class="co"># download the data</span></span>
<span id="cb85-16"><a href="chapter-intro-spatial-data-analysis.html#cb85-16" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb85-17"><a href="chapter-intro-spatial-data-analysis.html#cb85-17" tabindex="-1"></a>  url_narr,</span>
<span id="cb85-18"><a href="chapter-intro-spatial-data-analysis.html#cb85-18" tabindex="-1"></a>  destination_narr</span>
<span id="cb85-19"><a href="chapter-intro-spatial-data-analysis.html#cb85-19" tabindex="-1"></a>)</span></code></pre></div>
<p>Identify the desired data file with <code>utils::list.files()</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="chapter-intro-spatial-data-analysis.html#cb86-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;/   YOUR FILE PATH   /&quot;</span>)</span></code></pre></div>
<p>The file downloaded from NOAA’s NARR data set is an <code>.nc</code>, or netCDF, file. NetCDF files are common for raster data, and do not need to be unzipped.</p>
</div>
<div id="import-3" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Import<a href="chapter-intro-spatial-data-analysis.html#import-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the data file of interest has been downloaded and identified, import the data with <code>terra::rast()</code>.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="chapter-intro-spatial-data-analysis.html#cb87-1" tabindex="-1"></a>narr <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(</span>
<span id="cb87-2"><a href="chapter-intro-spatial-data-analysis.html#cb87-2" tabindex="-1"></a>  <span class="st">&quot;/   YOUR FILE PATH   /narr_air2m_&quot;</span>,</span>
<span id="cb87-3"><a href="chapter-intro-spatial-data-analysis.html#cb87-3" tabindex="-1"></a>  year,</span>
<span id="cb87-4"><a href="chapter-intro-spatial-data-analysis.html#cb87-4" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb87-5"><a href="chapter-intro-spatial-data-analysis.html#cb87-5" tabindex="-1"></a>))</span></code></pre></div>
</div>
<div id="inspect-structure-3" class="section level3 hasAnchor" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Inspect structure<a href="chapter-intro-spatial-data-analysis.html#inspect-structure-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inspect the structure of <code>narr</code> to see its class, dimensions, variables, and layer names.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chapter-intro-spatial-data-analysis.html#cb88-1" tabindex="-1"></a>narr</span></code></pre></div>
<p>When working with raster data, the dimensions of the raster refer to the number of rows (<code>nrow</code>) and columns (<code>ncol</code>) of grid cells that make up the raster. Similarly, the number of layers in the raster object (<code>nlyr</code>) represents the number of observations of the data. These can also be inspected individually with <code>nrow()</code>, <code>ncol()</code>, and <code>nlyr()</code>, respectively.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="chapter-intro-spatial-data-analysis.html#cb89-1" tabindex="-1"></a><span class="fu">nrow</span>(narr)</span>
<span id="cb89-2"><a href="chapter-intro-spatial-data-analysis.html#cb89-2" tabindex="-1"></a><span class="fu">ncol</span>(narr)</span>
<span id="cb89-3"><a href="chapter-intro-spatial-data-analysis.html#cb89-3" tabindex="-1"></a><span class="fu">nlyr</span>(narr)</span></code></pre></div>
</div>
<div id="rename" class="section level3 hasAnchor" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Rename<a href="chapter-intro-spatial-data-analysis.html#rename" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>narr</code> data set contains 365 layers, one for each daily observation of air temperature in 2021. When working with raster data that contains multiple layers, it is important to know and recognize the naming structure of each layer. In this case, the layer names are <code>air_</code> followed by the day of the year (ie. January 1 = <code>air_1</code>).</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="chapter-intro-spatial-data-analysis.html#cb90-1" tabindex="-1"></a><span class="fu">names</span>(narr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<p>Renaming raster layers can be useful for calculating summary statistics or when combining rasters with potentially identical layer names. Using the <code>time()</code> and <code>gsub()</code> functions, the layers can be renamed according to their date.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="chapter-intro-spatial-data-analysis.html#cb91-1" tabindex="-1"></a><span class="fu">names</span>(narr) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb91-2"><a href="chapter-intro-spatial-data-analysis.html#cb91-2" tabindex="-1"></a>  <span class="st">&quot;air_&quot;</span>,</span>
<span id="cb91-3"><a href="chapter-intro-spatial-data-analysis.html#cb91-3" tabindex="-1"></a>  <span class="fu">gsub</span>(</span>
<span id="cb91-4"><a href="chapter-intro-spatial-data-analysis.html#cb91-4" tabindex="-1"></a>    <span class="st">&quot;-&quot;</span>,</span>
<span id="cb91-5"><a href="chapter-intro-spatial-data-analysis.html#cb91-5" tabindex="-1"></a>    <span class="st">&quot;&quot;</span>,</span>
<span id="cb91-6"><a href="chapter-intro-spatial-data-analysis.html#cb91-6" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">time</span>(narr))</span>
<span id="cb91-7"><a href="chapter-intro-spatial-data-analysis.html#cb91-7" tabindex="-1"></a>  )</span>
<span id="cb91-8"><a href="chapter-intro-spatial-data-analysis.html#cb91-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Check the layer names again to ensure proper renaming.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="chapter-intro-spatial-data-analysis.html#cb92-1" tabindex="-1"></a><span class="fu">names</span>(narr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
</div>
<div id="coordinate-reference-system-and-projection-3" class="section level3 hasAnchor" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Coordinate reference system and projection<a href="chapter-intro-spatial-data-analysis.html#coordinate-reference-system-and-projection-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Check the coordinate reference system of a <code>SpatRaster</code> object with <code>terra::crs()</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="chapter-intro-spatial-data-analysis.html#cb93-1" tabindex="-1"></a><span class="fu">crs</span>(narr,</span>
<span id="cb93-2"><a href="chapter-intro-spatial-data-analysis.html#cb93-2" tabindex="-1"></a>  <span class="at">describe =</span> <span class="cn">TRUE</span></span>
<span id="cb93-3"><a href="chapter-intro-spatial-data-analysis.html#cb93-3" tabindex="-1"></a>)</span></code></pre></div>
<p><code>narr</code> has a native coordinate reference system, but it is unnamed and was not identifiable by <code>terra::rast()</code>. The area of interest for these exploratory analyses is the coterminous United States, so we can project <code>narr</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="chapter-intro-spatial-data-analysis.html#cb94-1" tabindex="-1"></a>narr <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb94-2"><a href="chapter-intro-spatial-data-analysis.html#cb94-2" tabindex="-1"></a>  narr,</span>
<span id="cb94-3"><a href="chapter-intro-spatial-data-analysis.html#cb94-3" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb94-4"><a href="chapter-intro-spatial-data-analysis.html#cb94-4" tabindex="-1"></a>)</span></code></pre></div>
<p>We want to create plots with and analyze the air temperature data as it relates to the coterminous United States’ state boundaries. Subset <code>states_t</code> to remove Alaska, Hawaii, and the United States’ territories.</p>
<div class="note">
<p>See sections 2.0 Access, download, and unzip and 2.2.1 Import for obtaining the <code>states_t</code> data set.</p>
</div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="chapter-intro-spatial-data-analysis.html#cb95-1" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb95-2"><a href="chapter-intro-spatial-data-analysis.html#cb95-2" tabindex="-1"></a>  <span class="st">&quot;Alaska&quot;</span>,</span>
<span id="cb95-3"><a href="chapter-intro-spatial-data-analysis.html#cb95-3" tabindex="-1"></a>  <span class="st">&quot;Hawaii&quot;</span>,</span>
<span id="cb95-4"><a href="chapter-intro-spatial-data-analysis.html#cb95-4" tabindex="-1"></a>  <span class="st">&quot;Puerto Rico&quot;</span>,</span>
<span id="cb95-5"><a href="chapter-intro-spatial-data-analysis.html#cb95-5" tabindex="-1"></a>  <span class="st">&quot;United States Virgin Islands&quot;</span>,</span>
<span id="cb95-6"><a href="chapter-intro-spatial-data-analysis.html#cb95-6" tabindex="-1"></a>  <span class="st">&quot;Commonwealth of the Northern Mariana Islands&quot;</span>,</span>
<span id="cb95-7"><a href="chapter-intro-spatial-data-analysis.html#cb95-7" tabindex="-1"></a>  <span class="st">&quot;Guam&quot;</span>,</span>
<span id="cb95-8"><a href="chapter-intro-spatial-data-analysis.html#cb95-8" tabindex="-1"></a>  <span class="st">&quot;American Samoa&quot;</span></span>
<span id="cb95-9"><a href="chapter-intro-spatial-data-analysis.html#cb95-9" tabindex="-1"></a>)</span>
<span id="cb95-10"><a href="chapter-intro-spatial-data-analysis.html#cb95-10" tabindex="-1"></a></span>
<span id="cb95-11"><a href="chapter-intro-spatial-data-analysis.html#cb95-11" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb95-12"><a href="chapter-intro-spatial-data-analysis.html#cb95-12" tabindex="-1"></a>  states_t,</span>
<span id="cb95-13"><a href="chapter-intro-spatial-data-analysis.html#cb95-13" tabindex="-1"></a>  <span class="sc">!</span>states_t<span class="sc">$</span>NAME <span class="sc">%in%</span> remove</span>
<span id="cb95-14"><a href="chapter-intro-spatial-data-analysis.html#cb95-14" tabindex="-1"></a>)</span></code></pre></div>
<p>Project <code>conus_t</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="chapter-intro-spatial-data-analysis.html#cb96-1" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb96-2"><a href="chapter-intro-spatial-data-analysis.html#cb96-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb96-3"><a href="chapter-intro-spatial-data-analysis.html#cb96-3" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb96-4"><a href="chapter-intro-spatial-data-analysis.html#cb96-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Ensure that both data sets have the same coordinate reference system.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="chapter-intro-spatial-data-analysis.html#cb97-1" tabindex="-1"></a><span class="fu">crs</span>(conus_t) <span class="sc">==</span> <span class="fu">crs</span>(narr)</span></code></pre></div>
</div>
<div id="plot-multiple-2" class="section level3 hasAnchor" number="1.4.6">
<h3><span class="header-section-number">1.4.6</span> Plot (multiple)<a href="chapter-intro-spatial-data-analysis.html#plot-multiple-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the data sets and coordinate reference systems have been prepared, create a plot with <code>ggplot2::gglot()</code>. Identifying the data sets to be plotted within the <code>geom_spatraster()</code> and <code>geom_spatvector()</code> argument informs the function that the <code>narr</code> and <code>conus_t</code> data sets are <code>SpatRaster</code> and <code>SpatVector</code> objects, respectively.</p>
<p>Only the first layer of the <code>narr</code> data set will be plotted.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="chapter-intro-spatial-data-analysis.html#cb98-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb98-2"><a href="chapter-intro-spatial-data-analysis.html#cb98-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr<span class="sc">$</span>air_20210101) <span class="sc">+</span></span>
<span id="cb98-3"><a href="chapter-intro-spatial-data-analysis.html#cb98-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb98-4"><a href="chapter-intro-spatial-data-analysis.html#cb98-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb98-5"><a href="chapter-intro-spatial-data-analysis.html#cb98-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb98-6"><a href="chapter-intro-spatial-data-analysis.html#cb98-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°K)&quot;</span></span>
<span id="cb98-7"><a href="chapter-intro-spatial-data-analysis.html#cb98-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-8"><a href="chapter-intro-spatial-data-analysis.html#cb98-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-9"><a href="chapter-intro-spatial-data-analysis.html#cb98-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb98-10"><a href="chapter-intro-spatial-data-analysis.html#cb98-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb98-11"><a href="chapter-intro-spatial-data-analysis.html#cb98-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb98-12"><a href="chapter-intro-spatial-data-analysis.html#cb98-12" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb98-13"><a href="chapter-intro-spatial-data-analysis.html#cb98-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-14"><a href="chapter-intro-spatial-data-analysis.html#cb98-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-15"><a href="chapter-intro-spatial-data-analysis.html#cb98-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb98-16"><a href="chapter-intro-spatial-data-analysis.html#cb98-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_original.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="crop-2" class="section level3 hasAnchor" number="1.4.7">
<h3><span class="header-section-number">1.4.7</span> Crop<a href="chapter-intro-spatial-data-analysis.html#crop-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>terra::crop()</code> function can be used to reduce a <code>SpatRaster</code> to an area determined by <code>SpatVector</code> polygons. The <code>mask = TRUE</code> argument crops to the border of the polygons, whereas <code>mask = FALSE</code> crops to the bounding box surrounding the polygons. In this example, crop the <code>narr</code> data to the coterminous United States’ state boundaries.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="chapter-intro-spatial-data-analysis.html#cb99-1" tabindex="-1"></a>narr_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(narr,</span>
<span id="cb99-2"><a href="chapter-intro-spatial-data-analysis.html#cb99-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb99-3"><a href="chapter-intro-spatial-data-analysis.html#cb99-3" tabindex="-1"></a>  <span class="at">mask =</span> <span class="cn">TRUE</span></span>
<span id="cb99-4"><a href="chapter-intro-spatial-data-analysis.html#cb99-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the cropped temperature data and the coterminous United States’ state boundaries.</p>
<p>Only the first layer of the <code>narr</code> data set will be plotted.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="chapter-intro-spatial-data-analysis.html#cb100-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb100-2"><a href="chapter-intro-spatial-data-analysis.html#cb100-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_crop<span class="sc">$</span>air_20210101) <span class="sc">+</span></span>
<span id="cb100-3"><a href="chapter-intro-spatial-data-analysis.html#cb100-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb100-4"><a href="chapter-intro-spatial-data-analysis.html#cb100-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb100-5"><a href="chapter-intro-spatial-data-analysis.html#cb100-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb100-6"><a href="chapter-intro-spatial-data-analysis.html#cb100-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°K)&quot;</span></span>
<span id="cb100-7"><a href="chapter-intro-spatial-data-analysis.html#cb100-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-8"><a href="chapter-intro-spatial-data-analysis.html#cb100-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (cropped)&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-9"><a href="chapter-intro-spatial-data-analysis.html#cb100-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb100-10"><a href="chapter-intro-spatial-data-analysis.html#cb100-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb100-11"><a href="chapter-intro-spatial-data-analysis.html#cb100-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb100-12"><a href="chapter-intro-spatial-data-analysis.html#cb100-12" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb100-13"><a href="chapter-intro-spatial-data-analysis.html#cb100-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-14"><a href="chapter-intro-spatial-data-analysis.html#cb100-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-15"><a href="chapter-intro-spatial-data-analysis.html#cb100-15" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb100-16"><a href="chapter-intro-spatial-data-analysis.html#cb100-16" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb100-17"><a href="chapter-intro-spatial-data-analysis.html#cb100-17" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-18"><a href="chapter-intro-spatial-data-analysis.html#cb100-18" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-19"><a href="chapter-intro-spatial-data-analysis.html#cb100-19" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb100-20"><a href="chapter-intro-spatial-data-analysis.html#cb100-20" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_crop.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="units" class="section level3 hasAnchor" number="1.4.8">
<h3><span class="header-section-number">1.4.8</span> Units<a href="chapter-intro-spatial-data-analysis.html#units" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The previous plot depicts the 2m air temperature data in Kelvin. To convert the units to degrees Celsius, simply subtract the values in <code>narr_crop</code> by 273.15. This subtraction will be applied to every grid cell within every layer of <code>narr_crop</code>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="chapter-intro-spatial-data-analysis.html#cb101-1" tabindex="-1"></a>narr_crop_c <span class="ot">&lt;-</span> narr_crop <span class="sc">-</span> <span class="fl">273.15</span></span></code></pre></div>
</div>
<div id="summary-statistics" class="section level3 hasAnchor" number="1.4.9">
<h3><span class="header-section-number">1.4.9</span> Summary statistics<a href="chapter-intro-spatial-data-analysis.html#summary-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to mathematical operations, calculating summary statistics is very straight forward with raster data. For this example, calculate the annual mean 2m air temperature and range of 2m air temperatures at each grid cell, and save these as a new layer in <code>narr_crop_c</code></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="chapter-intro-spatial-data-analysis.html#cb102-1" tabindex="-1"></a>narr_crop_c<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(narr_crop_c)</span>
<span id="cb102-2"><a href="chapter-intro-spatial-data-analysis.html#cb102-2" tabindex="-1"></a>narr_crop_c<span class="sc">$</span>range <span class="ot">&lt;-</span> <span class="fu">max</span>(narr_crop_c) <span class="sc">-</span> <span class="fu">min</span>(narr_crop_c)</span></code></pre></div>
<p>Inspect the results of the mean and range calculations.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="chapter-intro-spatial-data-analysis.html#cb103-1" tabindex="-1"></a><span class="fu">summary</span>(narr_crop_c<span class="sc">$</span>mean)</span>
<span id="cb103-2"><a href="chapter-intro-spatial-data-analysis.html#cb103-2" tabindex="-1"></a><span class="fu">summary</span>(narr_crop_c<span class="sc">$</span>range)</span></code></pre></div>
<p>With the summary statistic layers prepared, create a plot with <code>ggplot2::ggplot()</code>. Identifying the data sets to be plotted within the <code>geom_spatraster()</code> and <code>geom_spatvector()</code> argument informs the function that the <code>narr_crop_c</code> and <code>conus_t</code> data sets are <code>SpatRaster</code> and <code>SpatVector</code> objects, respectively. Additionally, the <code>facet_wrap(~lyr)</code> argument creates a plot for each layer specified in <code>geom_spatraster(data = narr_crop_c[[c("mean", "range")]])</code>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="chapter-intro-spatial-data-analysis.html#cb104-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-2"><a href="chapter-intro-spatial-data-analysis.html#cb104-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_crop_c[[<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;range&quot;</span>)]]) <span class="sc">+</span></span>
<span id="cb104-3"><a href="chapter-intro-spatial-data-analysis.html#cb104-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb104-4"><a href="chapter-intro-spatial-data-analysis.html#cb104-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb104-5"><a href="chapter-intro-spatial-data-analysis.html#cb104-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb104-6"><a href="chapter-intro-spatial-data-analysis.html#cb104-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°C)&quot;</span></span>
<span id="cb104-7"><a href="chapter-intro-spatial-data-analysis.html#cb104-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-8"><a href="chapter-intro-spatial-data-analysis.html#cb104-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lyr) <span class="sc">+</span></span>
<span id="cb104-9"><a href="chapter-intro-spatial-data-analysis.html#cb104-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-10"><a href="chapter-intro-spatial-data-analysis.html#cb104-10" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb104-11"><a href="chapter-intro-spatial-data-analysis.html#cb104-11" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb104-12"><a href="chapter-intro-spatial-data-analysis.html#cb104-12" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb104-13"><a href="chapter-intro-spatial-data-analysis.html#cb104-13" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb104-14"><a href="chapter-intro-spatial-data-analysis.html#cb104-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-15"><a href="chapter-intro-spatial-data-analysis.html#cb104-15" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-16"><a href="chapter-intro-spatial-data-analysis.html#cb104-16" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-17"><a href="chapter-intro-spatial-data-analysis.html#cb104-17" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb104-18"><a href="chapter-intro-spatial-data-analysis.html#cb104-18" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-19"><a href="chapter-intro-spatial-data-analysis.html#cb104-19" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-20"><a href="chapter-intro-spatial-data-analysis.html#cb104-20" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb104-21"><a href="chapter-intro-spatial-data-analysis.html#cb104-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_mean_range.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="zonal-statistics-1" class="section level3 hasAnchor" number="1.4.10">
<h3><span class="header-section-number">1.4.10</span> Zonal statistics<a href="chapter-intro-spatial-data-analysis.html#zonal-statistics-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Looking closely at the previous plot, it is clear that the annual mean and range of temperatures differ between states. The <code>terra</code> package can be used to calculate zonal statistics of a <code>SpatRaster</code> object based on <code>SpatVector</code> polygons.</p>
<p>The <code>terra::zonal()</code> function can be used to calculate the average annual temperature in each state based on the annual grid cell temperatures stored in <code>narr_crop_c$mean</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="chapter-intro-spatial-data-analysis.html#cb105-1" tabindex="-1"></a>conus_t<span class="sc">$</span>MEAN <span class="ot">&lt;-</span> <span class="fu">zonal</span>(narr_crop_c<span class="sc">$</span>mean,</span>
<span id="cb105-2"><a href="chapter-intro-spatial-data-analysis.html#cb105-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb105-3"><a href="chapter-intro-spatial-data-analysis.html#cb105-3" tabindex="-1"></a>  <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb105-4"><a href="chapter-intro-spatial-data-analysis.html#cb105-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the state-specific annual mean temperatures with <code>ggplot2::ggplot()</code>. Identifying the data set to be plotted within <code>geom_spatvector()</code> argument informs the function that the data is a <code>SpatVector</code> object.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="chapter-intro-spatial-data-analysis.html#cb106-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-2"><a href="chapter-intro-spatial-data-analysis.html#cb106-2" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb106-3"><a href="chapter-intro-spatial-data-analysis.html#cb106-3" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb106-4"><a href="chapter-intro-spatial-data-analysis.html#cb106-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> MEAN)</span>
<span id="cb106-5"><a href="chapter-intro-spatial-data-analysis.html#cb106-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-6"><a href="chapter-intro-spatial-data-analysis.html#cb106-6" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb106-7"><a href="chapter-intro-spatial-data-analysis.html#cb106-7" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb106-8"><a href="chapter-intro-spatial-data-analysis.html#cb106-8" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb106-9"><a href="chapter-intro-spatial-data-analysis.html#cb106-9" tabindex="-1"></a>    <span class="st">&quot;Temperature (°C)&quot;</span></span>
<span id="cb106-10"><a href="chapter-intro-spatial-data-analysis.html#cb106-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-11"><a href="chapter-intro-spatial-data-analysis.html#cb106-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (state mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-12"><a href="chapter-intro-spatial-data-analysis.html#cb106-12" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-13"><a href="chapter-intro-spatial-data-analysis.html#cb106-13" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb106-14"><a href="chapter-intro-spatial-data-analysis.html#cb106-14" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb106-15"><a href="chapter-intro-spatial-data-analysis.html#cb106-15" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb106-16"><a href="chapter-intro-spatial-data-analysis.html#cb106-16" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb106-17"><a href="chapter-intro-spatial-data-analysis.html#cb106-17" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb106-18"><a href="chapter-intro-spatial-data-analysis.html#cb106-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_state_mean.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="reclassify-3" class="section level3 hasAnchor" number="1.4.11">
<h3><span class="header-section-number">1.4.11</span> Reclassify<a href="chapter-intro-spatial-data-analysis.html#reclassify-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Raster data is most often continuous numeric data. Sometimes, however, it is important to classify the continuous numeric raster data into discrete classes. For this example, we will reclassify the annual mean temperature data into three discrete classes: &lt;10°C, 10°C - 20°C, &gt;20°C.</p>
<p>The first step in the reclassification process is to create a matrix storing the “from”, “to”, and “becomes” values. As the names imply, the “from” and “to” values identify the discrete ranges to be reclassified, and “becomes” is the new value that data within this range will take (ie. “from” 0 “to” 5 “becomes” 1 means that values ranging from 0 to 5 will be reclassified as 1).</p>
<p>Create the reclassification matrix.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="chapter-intro-spatial-data-analysis.html#cb107-1" tabindex="-1"></a>from <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb107-2"><a href="chapter-intro-spatial-data-analysis.html#cb107-2" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb107-3"><a href="chapter-intro-spatial-data-analysis.html#cb107-3" tabindex="-1"></a>  <span class="dv">10</span>,</span>
<span id="cb107-4"><a href="chapter-intro-spatial-data-analysis.html#cb107-4" tabindex="-1"></a>  <span class="dv">20</span></span>
<span id="cb107-5"><a href="chapter-intro-spatial-data-analysis.html#cb107-5" tabindex="-1"></a>)</span>
<span id="cb107-6"><a href="chapter-intro-spatial-data-analysis.html#cb107-6" tabindex="-1"></a>to <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb107-7"><a href="chapter-intro-spatial-data-analysis.html#cb107-7" tabindex="-1"></a>  <span class="dv">10</span>,</span>
<span id="cb107-8"><a href="chapter-intro-spatial-data-analysis.html#cb107-8" tabindex="-1"></a>  <span class="dv">20</span>,</span>
<span id="cb107-9"><a href="chapter-intro-spatial-data-analysis.html#cb107-9" tabindex="-1"></a>  <span class="cn">Inf</span></span>
<span id="cb107-10"><a href="chapter-intro-spatial-data-analysis.html#cb107-10" tabindex="-1"></a>)</span>
<span id="cb107-11"><a href="chapter-intro-spatial-data-analysis.html#cb107-11" tabindex="-1"></a>becomes <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb107-12"><a href="chapter-intro-spatial-data-analysis.html#cb107-12" tabindex="-1"></a>reclass <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb107-13"><a href="chapter-intro-spatial-data-analysis.html#cb107-13" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb107-14"><a href="chapter-intro-spatial-data-analysis.html#cb107-14" tabindex="-1"></a>    from,</span>
<span id="cb107-15"><a href="chapter-intro-spatial-data-analysis.html#cb107-15" tabindex="-1"></a>    to,</span>
<span id="cb107-16"><a href="chapter-intro-spatial-data-analysis.html#cb107-16" tabindex="-1"></a>    becomes</span>
<span id="cb107-17"><a href="chapter-intro-spatial-data-analysis.html#cb107-17" tabindex="-1"></a>  ),</span>
<span id="cb107-18"><a href="chapter-intro-spatial-data-analysis.html#cb107-18" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb107-19"><a href="chapter-intro-spatial-data-analysis.html#cb107-19" tabindex="-1"></a>)</span></code></pre></div>
<p>Now that the reclassification matrix has been prepared, reclassify the annual mean temperatures. The <code>right = TRUE</code> argument indicates that intervals are open on the left and closed on the right (ie. (0,10] becomes 1).</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="chapter-intro-spatial-data-analysis.html#cb108-1" tabindex="-1"></a>narr_reclass <span class="ot">&lt;-</span> <span class="fu">classify</span>(narr_crop_c<span class="sc">$</span>mean,</span>
<span id="cb108-2"><a href="chapter-intro-spatial-data-analysis.html#cb108-2" tabindex="-1"></a>  <span class="at">rcl =</span> reclass,</span>
<span id="cb108-3"><a href="chapter-intro-spatial-data-analysis.html#cb108-3" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb108-4"><a href="chapter-intro-spatial-data-analysis.html#cb108-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Although <code>narr_reclass</code> contains the reclassified mean air temperature data, the data is still continuously numeric. The following chunk of code converts the <code>narr_reclass$mean</code> layer from numeric to character based on the defined levels.</p>
<p><code>narr_reclass</code> contains the reclassified mean air temperature data, but the data is still numeric. The <code>terra::set.cats()</code> function assigns categories to numeric data based on values stored in a data frame.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="chapter-intro-spatial-data-analysis.html#cb109-1" tabindex="-1"></a>level_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb109-2"><a href="chapter-intro-spatial-data-analysis.html#cb109-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb109-3"><a href="chapter-intro-spatial-data-analysis.html#cb109-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)</span>
<span id="cb109-4"><a href="chapter-intro-spatial-data-analysis.html#cb109-4" tabindex="-1"></a>)</span>
<span id="cb109-5"><a href="chapter-intro-spatial-data-analysis.html#cb109-5" tabindex="-1"></a><span class="fu">colnames</span>(level_values) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean_continuous&quot;</span>, <span class="st">&quot;mean_discrete&quot;</span>)</span>
<span id="cb109-6"><a href="chapter-intro-spatial-data-analysis.html#cb109-6" tabindex="-1"></a><span class="fu">set.cats</span>(narr_reclass,</span>
<span id="cb109-7"><a href="chapter-intro-spatial-data-analysis.html#cb109-7" tabindex="-1"></a>  <span class="at">layer =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb109-8"><a href="chapter-intro-spatial-data-analysis.html#cb109-8" tabindex="-1"></a>  <span class="at">value =</span> level_values</span>
<span id="cb109-9"><a href="chapter-intro-spatial-data-analysis.html#cb109-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the discretely reclassified mean temperature data.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="chapter-intro-spatial-data-analysis.html#cb110-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb110-2"><a href="chapter-intro-spatial-data-analysis.html#cb110-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_reclass<span class="sc">$</span>mean_discrete) <span class="sc">+</span></span>
<span id="cb110-3"><a href="chapter-intro-spatial-data-analysis.html#cb110-3" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb110-4"><a href="chapter-intro-spatial-data-analysis.html#cb110-4" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb110-5"><a href="chapter-intro-spatial-data-analysis.html#cb110-5" tabindex="-1"></a>      <span class="st">&quot;≤10°&quot;</span>,</span>
<span id="cb110-6"><a href="chapter-intro-spatial-data-analysis.html#cb110-6" tabindex="-1"></a>      <span class="st">&quot;10°&lt; &amp; ≤20°&quot;</span>,</span>
<span id="cb110-7"><a href="chapter-intro-spatial-data-analysis.html#cb110-7" tabindex="-1"></a>      <span class="st">&quot;20°&lt;&quot;</span>,</span>
<span id="cb110-8"><a href="chapter-intro-spatial-data-analysis.html#cb110-8" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb110-9"><a href="chapter-intro-spatial-data-analysis.html#cb110-9" tabindex="-1"></a>    ),</span>
<span id="cb110-10"><a href="chapter-intro-spatial-data-analysis.html#cb110-10" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span></span>
<span id="cb110-11"><a href="chapter-intro-spatial-data-analysis.html#cb110-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb110-12"><a href="chapter-intro-spatial-data-analysis.html#cb110-12" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (reclassified)&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-13"><a href="chapter-intro-spatial-data-analysis.html#cb110-13" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb110-14"><a href="chapter-intro-spatial-data-analysis.html#cb110-14" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb110-15"><a href="chapter-intro-spatial-data-analysis.html#cb110-15" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb110-16"><a href="chapter-intro-spatial-data-analysis.html#cb110-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb110-17"><a href="chapter-intro-spatial-data-analysis.html#cb110-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb110-18"><a href="chapter-intro-spatial-data-analysis.html#cb110-18" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-19"><a href="chapter-intro-spatial-data-analysis.html#cb110-19" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb110-20"><a href="chapter-intro-spatial-data-analysis.html#cb110-20" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb110-21"><a href="chapter-intro-spatial-data-analysis.html#cb110-21" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb110-22"><a href="chapter-intro-spatial-data-analysis.html#cb110-22" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb110-23"><a href="chapter-intro-spatial-data-analysis.html#cb110-23" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb110-24"><a href="chapter-intro-spatial-data-analysis.html#cb110-24" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_reclass.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
</div>
<div id="additional-resources" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Additional Resources<a href="chapter-intro-spatial-data-analysis.html#additional-resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For additional resources pertaining to the packages used in this vignette, please see the following:</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/sf/sf.pdf">Package ‘sf’</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/terra/terra.pdf">Package ‘terra’</a></p></li>
<li><p><a href="https://search.r-project.org/CRAN/refmans/terra/html/terra-package.html">Description of the methods in the terra package</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/dplyr/dplyr.pdf">Package ‘dplyr’</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ggplot2/ggplot2.pdf">Package ‘ggplot2’</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ggpubr/ggpubr.pdf">Package ‘ggpubr’</a></p></li>
</ul>
</div>
<div id="references" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> References<a href="chapter-intro-spatial-data-analysis.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.</p>
<p>Hernangomez D (2023). tidyterra: tidyverse Methods and ggplot2 Helpers for terra Objects. <a href="https://doi.org/10.5281/zenodo.6572471" class="uri">https://doi.org/10.5281/zenodo.6572471</a>, <a href="https://dieghernan.github.io/tidyterra/" class="uri">https://dieghernan.github.io/tidyterra/</a></p>
<p>Hijmans R (2023). <em>terra: Spatial Data Analysis</em>. R package version 1.7-39, <a href="https://CRAN.R-project.org/package=terra" class="uri">https://CRAN.R-project.org/package=terra</a>.</p>
<p>Kassambara A (2023). <em>ggpubr: ‘ggplot2’ Based Publication Ready Plots</em>. R package version 0.6.0, <a href="https://CRAN.R-project.org/package=ggpubr" class="uri">https://CRAN.R-project.org/package=ggpubr</a>.</p>
<p>Pebesma, E., &amp; Bivand, R. (2023). Spatial Data Science: With Applications in R. Chapman and Hall/CRC. <a href="https://doi.org/10.1201/9780429459016" class="uri">https://doi.org/10.1201/9780429459016</a></p>
<p>Pebesma, E., 2018. Simple Features for R: Standardized Support for Spatial Vector Data. The R Journal 10 (1), 439-446, <a href="https://doi.org/10.32614/RJ-2018-009" class="uri">https://doi.org/10.32614/RJ-2018-009</a></p>
<p>R Core Team (2023). <em>R: A Language and Environment for Statistical Computing</em>. R Foundation for Statistical Computing, Vienna, Austria. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
<p>Wickham H, François R, Henry L, Müller K, Vaughan D (2023). <em>dplyr: A Grammar of Data Manipulation</em>. R package version 1.1.2, <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="foundations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wildfire-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
