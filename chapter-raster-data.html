<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Raster Data | CHORDS Training and Use Cases Toolkit</title>
  <meta name="description" content="The CHORDS Training and Use Cases Toolkit provides guides, tutorials, and example code to support climate change and human health research." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Raster Data | CHORDS Training and Use Cases Toolkit" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The CHORDS Training and Use Cases Toolkit provides guides, tutorials, and example code to support climate change and human health research." />
  <meta name="github-repo" content="NIEHS/PCOR_bookdown_tools" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Raster Data | CHORDS Training and Use Cases Toolkit" />
  
  <meta name="twitter:description" content="The CHORDS Training and Use Cases Toolkit provides guides, tutorials, and example code to support climate change and human health research." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-polygon-data.html"/>
<link rel="next" href="wildfire-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CHORDS Training and Use Cases Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>Introduction</strong></a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-chords"><i class="fa fa-check"></i>About CHORDS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-toolkit"><i class="fa fa-check"></i>About This Toolkit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="unit-geospatial-foundations.html"><a href="unit-geospatial-foundations.html"><i class="fa fa-check"></i><strong>Geospatial Data Foundations</strong></a></li>
<li class="chapter" data-level="1" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#introduction-1"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#concepts-and-terminology"><i class="fa fa-check"></i><b>1.2</b> Concepts and Terminology</a></li>
<li class="chapter" data-level="1.3" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#datasets"><i class="fa fa-check"></i><b>1.3</b> Datasets</a></li>
<li class="chapter" data-level="1.4" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#r-packages"><i class="fa fa-check"></i><b>1.4</b> <code>R</code> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#chapter-getting-started-spatial-resources"><i class="fa fa-check"></i><b>1.5</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-point-data.html"><a href="chapter-point-data.html"><i class="fa fa-check"></i><b>2</b> Point Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-point-data.html"><a href="chapter-point-data.html#introduction-2"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-point-data.html"><a href="chapter-point-data.html#access-download-and-unzip"><i class="fa fa-check"></i><b>2.2</b> Access, Download, and Unzip</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-point-data.html"><a href="chapter-point-data.html#data-preparation"><i class="fa fa-check"></i><b>2.3</b> Data Preparation</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-point-data.html"><a href="chapter-point-data.html#exploratory-analysis"><i class="fa fa-check"></i><b>2.4</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html"><i class="fa fa-check"></i><b>3</b> Polygon Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#introduction-3"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#chapter-polygon-access"><i class="fa fa-check"></i><b>3.2</b> Access, Download, and Unzip</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#data-preparation-with-sf"><i class="fa fa-check"></i><b>3.3</b> Data Preparation with <code>sf</code></a></li>
<li class="chapter" data-level="3.4" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#exploratory-analysis-with-sf"><i class="fa fa-check"></i><b>3.4</b> Exploratory Analysis with <code>sf</code></a></li>
<li class="chapter" data-level="3.5" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#data-preparation-with-terra"><i class="fa fa-check"></i><b>3.5</b> Data Preparation with <code>terra</code></a></li>
<li class="chapter" data-level="3.6" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#exploratory-analysis-with-terra"><i class="fa fa-check"></i><b>3.6</b> Exploratory Analysis with <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html"><i class="fa fa-check"></i><b>4</b> Raster Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#introduction-4"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#raster-access"><i class="fa fa-check"></i><b>4.2</b> Access and Download</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#data-preparation-1"><i class="fa fa-check"></i><b>4.3</b> Data Preparation</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#exploratory-analysis-1"><i class="fa fa-check"></i><b>4.4</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wildfire-data.html"><a href="wildfire-data.html"><i class="fa fa-check"></i><strong>Wildfire Data</strong></a></li>
<li class="chapter" data-level="" data-path="other-environmental-data.html"><a href="other-environmental-data.html"><i class="fa fa-check"></i><strong>Other Environmental Data</strong></a></li>
<li class="chapter" data-level="5" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html"><i class="fa fa-check"></i><b>5</b> NASA EarthData Download</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#introduction-5"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#nasa-earthdata-account"><i class="fa fa-check"></i><b>5.2</b> NASA EarthData Account</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#generate-prerequisite-files"><i class="fa fa-check"></i><b>5.3</b> Generate Prerequisite Files</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#download-data"><i class="fa fa-check"></i><b>5.4</b> Download Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="health-data-integration.html"><a href="health-data-integration.html"><i class="fa fa-check"></i><strong>Health Data Integration</strong></a></li>
<li class="chapter" data-level="6" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html"><i class="fa fa-check"></i><b>6</b> Linkage to Census Units</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#introduction-6"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#tutorial"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#concluding-remarks"><i class="fa fa-check"></i><b>6.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html"><i class="fa fa-check"></i><b>7</b> A FHIR PIT Tutorial</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#introduction-7"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#tutorial-1"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#fhir-pit-considerations"><i class="fa fa-check"></i><b>7.3</b> Considerations</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#concluding-remarks-1"><i class="fa fa-check"></i><b>7.4</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="use-cases.html"><a href="use-cases.html"><i class="fa fa-check"></i><strong>Use Cases</strong></a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><strong>Appendix</strong></a></li>
<li class="chapter" data-level="" data-path="chapter-user-profiles.html"><a href="chapter-user-profiles.html"><i class="fa fa-check"></i><strong>A</strong> User Profiles</a></li>
<li class="chapter" data-level="" data-path="chords-glossary.html"><a href="chords-glossary.html"><i class="fa fa-check"></i><strong>B</strong> Glossary</a></li>
<li class="chapter" data-level="" data-path="all-references-appendix.html"><a href="all-references-appendix.html"><i class="fa fa-check"></i><strong>C</strong> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" 
target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CHORDS Training and Use Cases Toolkit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-raster-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Raster Data<a href="chapter-raster-data.html#chapter-raster-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="chapter-user-profiles.html#profilecmp"><img src="images/user_profiles/profilecmp.svg" alt="Profile-CMP" /></a>
<a href="chapter-user-profiles.html#profilesbs"><img src="images/user_profiles/profilesbs.svg" alt="Profile-SBS" /></a>
<a href="chapter-user-profiles.html#profilestu"><img src="images/user_profiles/profilestu.svg" alt="Profile-STU" /></a></p>
<div id="raster-data-access-preparation-and-exploratory-analysis-in-r" class="section level3 unnumbered hasAnchor">
<h3>Raster Data Access, Preparation, and Exploratory Analysis in R<a href="chapter-raster-data.html#raster-data-access-preparation-and-exploratory-analysis-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Date Modified:</strong> May 6, 2024</p>
<p><strong>Authors:</strong> Mitchell Manware <a href="https://orcid.org/0009-0003-6440-6106"><img src="images/orcid.png" width="10" alt="author-mm" /></a>, Kyle P. Messier <a href="https://orcid.org/0000-0001-9508-9623"><img src="images/orcid.png" width="10" alt="author-kpm" /></a></p>
<p><strong>Key Terms:</strong> <a href="chords-glossary.html#def-geospatial-data">Geospatial Data</a>, <a href="https://tools.niehs.nih.gov/cchhglossary/?keyword=weather&amp;termOnlySearch=true&amp;exactSearch=true">Weather</a></p>
<p><strong>Programming Language:</strong> R</p>
</div>
<div id="introduction-4" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="chapter-raster-data.html#introduction-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Air temperature data from the United States National Oceanic and Atmospheric Administration’s (NOAA) North American Regional Reanalysis (NARR) data set will be used to demonstrate using raster (grid) data with the <code>terra</code> package <span class="citation">(<a href="#ref-r-terra">9</a>)</span>.</p>
<p>This tutorial will demonstrate the following steps with raster data in <code>R</code>:</p>
<ul>
<li>Downloading data from a URL</li>
<li>Importing data</li>
<li>Checking data type, structure, and class</li>
<li>Reclassifying data</li>
<li>Computing summary and zonal statistics</li>
<li>Plotting individual and multiple data sets</li>
</ul>
<div class="important">
<p>The exploratory analyses in this unit are designed for educational purposes only. The results of the following analyses are not peer-reviewed findings, nor are they based on any hypotheses.</p>
</div>
</div>
<div id="raster-access" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Access and Download<a href="chapter-raster-data.html#raster-access" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The website URL where the NOAA NARR exists is year-specific, meaning there is a unique URL for each annual data set. For the purpose of these exploratory analyses, air temperature data from the year 2021 will be used</p>
<p>Define the variable <code>year</code> according to the year of interest.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="chapter-raster-data.html#cb84-1" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="st">&quot;2021&quot;</span></span></code></pre></div>
<p>The <code>utils::download.file()</code> function downloads the file according to the defined URL and destination file.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="chapter-raster-data.html#cb85-1" tabindex="-1"></a><span class="co"># specify the URL where data is stored based on year variable of interest</span></span>
<span id="cb85-2"><a href="chapter-raster-data.html#cb85-2" tabindex="-1"></a>url_narr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb85-3"><a href="chapter-raster-data.html#cb85-3" tabindex="-1"></a>  <span class="st">&quot;https://downloads.psl.noaa.gov//Datasets/NARR/Dailies/monolevel/air.2m.&quot;</span>,</span>
<span id="cb85-4"><a href="chapter-raster-data.html#cb85-4" tabindex="-1"></a>  year,</span>
<span id="cb85-5"><a href="chapter-raster-data.html#cb85-5" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb85-6"><a href="chapter-raster-data.html#cb85-6" tabindex="-1"></a>)</span>
<span id="cb85-7"><a href="chapter-raster-data.html#cb85-7" tabindex="-1"></a></span>
<span id="cb85-8"><a href="chapter-raster-data.html#cb85-8" tabindex="-1"></a><span class="co"># specify where to save downloaded data</span></span>
<span id="cb85-9"><a href="chapter-raster-data.html#cb85-9" tabindex="-1"></a>destination_narr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb85-10"><a href="chapter-raster-data.html#cb85-10" tabindex="-1"></a>  <span class="st">&quot;/   YOUR FILE PATH   /narr_air2m_&quot;</span>,</span>
<span id="cb85-11"><a href="chapter-raster-data.html#cb85-11" tabindex="-1"></a>  year,</span>
<span id="cb85-12"><a href="chapter-raster-data.html#cb85-12" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb85-13"><a href="chapter-raster-data.html#cb85-13" tabindex="-1"></a>)</span>
<span id="cb85-14"><a href="chapter-raster-data.html#cb85-14" tabindex="-1"></a></span>
<span id="cb85-15"><a href="chapter-raster-data.html#cb85-15" tabindex="-1"></a><span class="co"># download the data</span></span>
<span id="cb85-16"><a href="chapter-raster-data.html#cb85-16" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb85-17"><a href="chapter-raster-data.html#cb85-17" tabindex="-1"></a>  url_narr,</span>
<span id="cb85-18"><a href="chapter-raster-data.html#cb85-18" tabindex="-1"></a>  destination_narr</span>
<span id="cb85-19"><a href="chapter-raster-data.html#cb85-19" tabindex="-1"></a>)</span></code></pre></div>
<p>Identify the desired data file with <code>utils::list.files()</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="chapter-raster-data.html#cb86-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;/   YOUR FILE PATH   /&quot;</span>)</span></code></pre></div>
<p>The file downloaded from NOAA’s NARR data set is an <code>.nc</code>, or netCDF, file. NetCDF files are common for raster data, and do not need to be unzipped.</p>
</div>
<div id="data-preparation-1" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Data Preparation<a href="chapter-raster-data.html#data-preparation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="import-3" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Import<a href="chapter-raster-data.html#import-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the data file of interest has been downloaded and identified, import the data with <code>terra::rast()</code>.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="chapter-raster-data.html#cb87-1" tabindex="-1"></a>narr <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(</span>
<span id="cb87-2"><a href="chapter-raster-data.html#cb87-2" tabindex="-1"></a>  <span class="st">&quot;/   YOUR FILE PATH   /narr_air2m_&quot;</span>,</span>
<span id="cb87-3"><a href="chapter-raster-data.html#cb87-3" tabindex="-1"></a>  year,</span>
<span id="cb87-4"><a href="chapter-raster-data.html#cb87-4" tabindex="-1"></a>  <span class="st">&quot;.nc&quot;</span></span>
<span id="cb87-5"><a href="chapter-raster-data.html#cb87-5" tabindex="-1"></a>))</span></code></pre></div>
</div>
<div id="inspect-structure-3" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Inspect Structure<a href="chapter-raster-data.html#inspect-structure-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inspect the structure of <code>narr</code> to see its class, dimensions, variables, and layer names.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chapter-raster-data.html#cb88-1" tabindex="-1"></a>narr</span></code></pre></div>
<p>When working with raster data, the dimensions of the raster refer to the number of rows (<code>nrow</code>) and columns (<code>ncol</code>) of grid cells that make up the raster. Similarly, the number of layers in the raster object (<code>nlyr</code>) represents the number of observations of the data. These can also be inspected individually with <code>nrow()</code>, <code>ncol()</code>, and <code>nlyr()</code>, respectively.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="chapter-raster-data.html#cb89-1" tabindex="-1"></a><span class="fu">nrow</span>(narr)</span>
<span id="cb89-2"><a href="chapter-raster-data.html#cb89-2" tabindex="-1"></a><span class="fu">ncol</span>(narr)</span>
<span id="cb89-3"><a href="chapter-raster-data.html#cb89-3" tabindex="-1"></a><span class="fu">nlyr</span>(narr)</span></code></pre></div>
</div>
<div id="rename" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Rename<a href="chapter-raster-data.html#rename" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>narr</code> data set contains 365 layers, one for each daily observation of air temperature in 2021. When working with raster data that contains multiple layers, it is important to know and recognize the naming structure of each layer. In this case, the layer names are <code>air_</code> followed by the day of the year (i.e., January 1 = <code>air_1</code>).</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="chapter-raster-data.html#cb90-1" tabindex="-1"></a><span class="fu">names</span>(narr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<p>Renaming raster layers can be useful for calculating summary statistics or when combining rasters with potentially identical layer names. Using the <code>time()</code> and <code>gsub()</code> functions, the layers can be renamed according to their date.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="chapter-raster-data.html#cb91-1" tabindex="-1"></a><span class="fu">names</span>(narr) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb91-2"><a href="chapter-raster-data.html#cb91-2" tabindex="-1"></a>  <span class="st">&quot;air_&quot;</span>,</span>
<span id="cb91-3"><a href="chapter-raster-data.html#cb91-3" tabindex="-1"></a>  <span class="fu">gsub</span>(</span>
<span id="cb91-4"><a href="chapter-raster-data.html#cb91-4" tabindex="-1"></a>    <span class="st">&quot;-&quot;</span>,</span>
<span id="cb91-5"><a href="chapter-raster-data.html#cb91-5" tabindex="-1"></a>    <span class="st">&quot;&quot;</span>,</span>
<span id="cb91-6"><a href="chapter-raster-data.html#cb91-6" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">time</span>(narr))</span>
<span id="cb91-7"><a href="chapter-raster-data.html#cb91-7" tabindex="-1"></a>  )</span>
<span id="cb91-8"><a href="chapter-raster-data.html#cb91-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Check the layer names again to ensure proper renaming.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="chapter-raster-data.html#cb92-1" tabindex="-1"></a><span class="fu">names</span>(narr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
</div>
<div id="coordinate-reference-system-and-projection-3" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Coordinate Reference System and Projection<a href="chapter-raster-data.html#coordinate-reference-system-and-projection-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Check the coordinate reference system of a <code>SpatRaster</code> object with <code>terra::crs()</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="chapter-raster-data.html#cb93-1" tabindex="-1"></a><span class="fu">crs</span>(narr,</span>
<span id="cb93-2"><a href="chapter-raster-data.html#cb93-2" tabindex="-1"></a>  <span class="at">describe =</span> <span class="cn">TRUE</span></span>
<span id="cb93-3"><a href="chapter-raster-data.html#cb93-3" tabindex="-1"></a>)</span></code></pre></div>
<p><code>narr</code> has a native coordinate reference system, but it is unnamed and was not identifiable by <code>terra::rast()</code>. The area of interest for these exploratory analyses is the conterminous United States, so we can project <code>narr</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="chapter-raster-data.html#cb94-1" tabindex="-1"></a>narr <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb94-2"><a href="chapter-raster-data.html#cb94-2" tabindex="-1"></a>  narr,</span>
<span id="cb94-3"><a href="chapter-raster-data.html#cb94-3" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb94-4"><a href="chapter-raster-data.html#cb94-4" tabindex="-1"></a>)</span></code></pre></div>
<p>We want to create plots with and analyze the air temperature data as it relates to the conterminous United States state boundaries. Subset <code>states_t</code> to remove Alaska, Hawaii, and the United States territories.</p>
<div class="note">
<p>See the <a href="chapter-polygon-data.html#chapter-polygon-data">Polygon Data</a> Chapter Section <a href="chapter-polygon-data.html#chapter-polygon-plot-multiple-sf">Plot (Multiple)</a> for the steps for obtaining the <code>states_t</code> data set.</p>
</div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="chapter-raster-data.html#cb95-1" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb95-2"><a href="chapter-raster-data.html#cb95-2" tabindex="-1"></a>  <span class="st">&quot;Alaska&quot;</span>,</span>
<span id="cb95-3"><a href="chapter-raster-data.html#cb95-3" tabindex="-1"></a>  <span class="st">&quot;Hawaii&quot;</span>,</span>
<span id="cb95-4"><a href="chapter-raster-data.html#cb95-4" tabindex="-1"></a>  <span class="st">&quot;Puerto Rico&quot;</span>,</span>
<span id="cb95-5"><a href="chapter-raster-data.html#cb95-5" tabindex="-1"></a>  <span class="st">&quot;United States Virgin Islands&quot;</span>,</span>
<span id="cb95-6"><a href="chapter-raster-data.html#cb95-6" tabindex="-1"></a>  <span class="st">&quot;Commonwealth of the Northern Mariana Islands&quot;</span>,</span>
<span id="cb95-7"><a href="chapter-raster-data.html#cb95-7" tabindex="-1"></a>  <span class="st">&quot;Guam&quot;</span>,</span>
<span id="cb95-8"><a href="chapter-raster-data.html#cb95-8" tabindex="-1"></a>  <span class="st">&quot;American Samoa&quot;</span></span>
<span id="cb95-9"><a href="chapter-raster-data.html#cb95-9" tabindex="-1"></a>)</span>
<span id="cb95-10"><a href="chapter-raster-data.html#cb95-10" tabindex="-1"></a></span>
<span id="cb95-11"><a href="chapter-raster-data.html#cb95-11" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb95-12"><a href="chapter-raster-data.html#cb95-12" tabindex="-1"></a>  states_t,</span>
<span id="cb95-13"><a href="chapter-raster-data.html#cb95-13" tabindex="-1"></a>  <span class="sc">!</span>states_t<span class="sc">$</span>NAME <span class="sc">%in%</span> remove</span>
<span id="cb95-14"><a href="chapter-raster-data.html#cb95-14" tabindex="-1"></a>)</span></code></pre></div>
<p>Project <code>conus_t</code> to the Albers Equal Area projected coordinate system (EPSG code: 5070).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="chapter-raster-data.html#cb96-1" tabindex="-1"></a>conus_t <span class="ot">&lt;-</span> <span class="fu">project</span>(</span>
<span id="cb96-2"><a href="chapter-raster-data.html#cb96-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb96-3"><a href="chapter-raster-data.html#cb96-3" tabindex="-1"></a>  <span class="st">&quot;EPSG:5070&quot;</span></span>
<span id="cb96-4"><a href="chapter-raster-data.html#cb96-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Ensure that both data sets have the same coordinate reference system.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="chapter-raster-data.html#cb97-1" tabindex="-1"></a><span class="fu">crs</span>(conus_t) <span class="sc">==</span> <span class="fu">crs</span>(narr)</span></code></pre></div>
</div>
</div>
<div id="exploratory-analysis-1" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Exploratory Analysis<a href="chapter-raster-data.html#exploratory-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="plot-multiple-1" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Plot (Multiple)<a href="chapter-raster-data.html#plot-multiple-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the data sets and coordinate reference systems have been prepared, create a plot with <code>ggplot2::gglot()</code>. Identifying the data sets to be plotted within the <code>tidyterra::geom_spatraster()</code> and <code>tidyterra::geom_spatvector()</code> argument informs the function that the <code>narr</code> and <code>conus_t</code> data sets are <code>SpatRaster</code> and <code>SpatVector</code> objects, respectively <span class="citation">(<a href="#ref-r-tidyterra">10</a>)</span>.</p>
<p>Only the first layer of the <code>narr</code> data set will be plotted.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="chapter-raster-data.html#cb98-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb98-2"><a href="chapter-raster-data.html#cb98-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr<span class="sc">$</span>air_20210101) <span class="sc">+</span></span>
<span id="cb98-3"><a href="chapter-raster-data.html#cb98-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb98-4"><a href="chapter-raster-data.html#cb98-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb98-5"><a href="chapter-raster-data.html#cb98-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb98-6"><a href="chapter-raster-data.html#cb98-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°K)&quot;</span></span>
<span id="cb98-7"><a href="chapter-raster-data.html#cb98-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-8"><a href="chapter-raster-data.html#cb98-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-9"><a href="chapter-raster-data.html#cb98-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb98-10"><a href="chapter-raster-data.html#cb98-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb98-11"><a href="chapter-raster-data.html#cb98-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb98-12"><a href="chapter-raster-data.html#cb98-12" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb98-13"><a href="chapter-raster-data.html#cb98-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-14"><a href="chapter-raster-data.html#cb98-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-15"><a href="chapter-raster-data.html#cb98-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb98-16"><a href="chapter-raster-data.html#cb98-16" tabindex="-1"></a>  <span class="fu">grids</span>()</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_original.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="crop-2" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Crop<a href="chapter-raster-data.html#crop-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>terra::crop()</code> function can be used to reduce a <code>SpatRaster</code> to an area determined by <code>SpatVector</code> polygons. The <code>mask = TRUE</code> argument crops to the border of the polygons, whereas <code>mask = FALSE</code> crops to the bounding box surrounding the polygons. In this example, crop the <code>narr</code> data to the conterminous United States state boundaries.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="chapter-raster-data.html#cb99-1" tabindex="-1"></a>narr_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(narr,</span>
<span id="cb99-2"><a href="chapter-raster-data.html#cb99-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb99-3"><a href="chapter-raster-data.html#cb99-3" tabindex="-1"></a>  <span class="at">mask =</span> <span class="cn">TRUE</span></span>
<span id="cb99-4"><a href="chapter-raster-data.html#cb99-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the cropped temperature data and the conterminous United States state boundaries.</p>
<p>Only the first layer of the <code>narr</code> data set will be plotted.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="chapter-raster-data.html#cb100-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb100-2"><a href="chapter-raster-data.html#cb100-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_crop<span class="sc">$</span>air_20210101) <span class="sc">+</span></span>
<span id="cb100-3"><a href="chapter-raster-data.html#cb100-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb100-4"><a href="chapter-raster-data.html#cb100-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb100-5"><a href="chapter-raster-data.html#cb100-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb100-6"><a href="chapter-raster-data.html#cb100-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°K)&quot;</span></span>
<span id="cb100-7"><a href="chapter-raster-data.html#cb100-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-8"><a href="chapter-raster-data.html#cb100-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (cropped)&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-9"><a href="chapter-raster-data.html#cb100-9" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb100-10"><a href="chapter-raster-data.html#cb100-10" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb100-11"><a href="chapter-raster-data.html#cb100-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb100-12"><a href="chapter-raster-data.html#cb100-12" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb100-13"><a href="chapter-raster-data.html#cb100-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-14"><a href="chapter-raster-data.html#cb100-14" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-15"><a href="chapter-raster-data.html#cb100-15" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb100-16"><a href="chapter-raster-data.html#cb100-16" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb100-17"><a href="chapter-raster-data.html#cb100-17" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-18"><a href="chapter-raster-data.html#cb100-18" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-19"><a href="chapter-raster-data.html#cb100-19" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb100-20"><a href="chapter-raster-data.html#cb100-20" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_crop.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="units" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Units<a href="chapter-raster-data.html#units" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The previous plot depicts the 2 m air temperature data in degrees Kelvin. To convert the units to degrees Celsius, simply subtract the values in <code>narr_crop</code> by 273.15. This subtraction will be applied to every grid cell within every layer of <code>narr_crop</code>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="chapter-raster-data.html#cb101-1" tabindex="-1"></a>narr_crop_c <span class="ot">&lt;-</span> narr_crop <span class="sc">-</span> <span class="fl">273.15</span></span></code></pre></div>
</div>
<div id="summary-statistics" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Summary Statistics<a href="chapter-raster-data.html#summary-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to mathematical operations, calculating summary statistics is very straight forward with raster data. For this example, calculate the annual mean 2m air temperature and range of 2m air temperatures at each grid cell, and save these as a new layer in <code>narr_crop_c</code></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="chapter-raster-data.html#cb102-1" tabindex="-1"></a>narr_crop_c<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(narr_crop_c)</span>
<span id="cb102-2"><a href="chapter-raster-data.html#cb102-2" tabindex="-1"></a>narr_crop_c<span class="sc">$</span>range <span class="ot">&lt;-</span> <span class="fu">max</span>(narr_crop_c) <span class="sc">-</span> <span class="fu">min</span>(narr_crop_c)</span></code></pre></div>
<p>Inspect the results of the mean and range calculations.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="chapter-raster-data.html#cb103-1" tabindex="-1"></a><span class="fu">summary</span>(narr_crop_c<span class="sc">$</span>mean)</span>
<span id="cb103-2"><a href="chapter-raster-data.html#cb103-2" tabindex="-1"></a><span class="fu">summary</span>(narr_crop_c<span class="sc">$</span>range)</span></code></pre></div>
<p>With the summary statistic layers prepared, create a plot with <code>ggplot2::ggplot()</code>. Identifying the data sets to be plotted within the <code>tidyterra::geom_spatraster()</code> and <code>tidyterra::geom_spatvector()</code> argument informs the function that the <code>narr_crop_c</code> and <code>conus_t</code> data sets are <code>SpatRaster</code> and <code>SpatVector</code> objects, respectively. Additionally, the <code>facet_wrap(~lyr)</code> argument creates a plot for each layer specified in <code>geom_spatraster(data = narr_crop_c[[c("mean", "range")]])</code>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="chapter-raster-data.html#cb104-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-2"><a href="chapter-raster-data.html#cb104-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_crop_c[[<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;range&quot;</span>)]]) <span class="sc">+</span></span>
<span id="cb104-3"><a href="chapter-raster-data.html#cb104-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb104-4"><a href="chapter-raster-data.html#cb104-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb104-5"><a href="chapter-raster-data.html#cb104-5" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb104-6"><a href="chapter-raster-data.html#cb104-6" tabindex="-1"></a>    <span class="st">&quot;Temperature (°C)&quot;</span></span>
<span id="cb104-7"><a href="chapter-raster-data.html#cb104-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-8"><a href="chapter-raster-data.html#cb104-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lyr) <span class="sc">+</span></span>
<span id="cb104-9"><a href="chapter-raster-data.html#cb104-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-10"><a href="chapter-raster-data.html#cb104-10" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb104-11"><a href="chapter-raster-data.html#cb104-11" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb104-12"><a href="chapter-raster-data.html#cb104-12" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb104-13"><a href="chapter-raster-data.html#cb104-13" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb104-14"><a href="chapter-raster-data.html#cb104-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-15"><a href="chapter-raster-data.html#cb104-15" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-16"><a href="chapter-raster-data.html#cb104-16" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-17"><a href="chapter-raster-data.html#cb104-17" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb104-18"><a href="chapter-raster-data.html#cb104-18" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-19"><a href="chapter-raster-data.html#cb104-19" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-20"><a href="chapter-raster-data.html#cb104-20" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb104-21"><a href="chapter-raster-data.html#cb104-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_mean_range.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="zonal-statistics-1" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Zonal Statistics<a href="chapter-raster-data.html#zonal-statistics-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Looking closely at the previous plot, it is clear that the annual mean and range of temperatures differ between states. The <code>terra</code> package can be used to calculate zonal statistics of a <code>SpatRaster</code> object based on <code>SpatVector</code> polygons.</p>
<p>The <code>terra::zonal()</code> function can be used to calculate the average annual temperature in each state based on the annual grid cell temperatures stored in <code>narr_crop_c$mean</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="chapter-raster-data.html#cb105-1" tabindex="-1"></a>conus_t<span class="sc">$</span>MEAN <span class="ot">&lt;-</span> <span class="fu">zonal</span>(narr_crop_c<span class="sc">$</span>mean,</span>
<span id="cb105-2"><a href="chapter-raster-data.html#cb105-2" tabindex="-1"></a>  conus_t,</span>
<span id="cb105-3"><a href="chapter-raster-data.html#cb105-3" tabindex="-1"></a>  <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb105-4"><a href="chapter-raster-data.html#cb105-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the state-specific annual mean temperatures with <code>ggplot2::ggplot()</code>. Identifying the data set to be plotted within <code>tidyterra::geom_spatvector()</code> argument informs the function that the data is a <code>SpatVector</code> object.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="chapter-raster-data.html#cb106-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-2"><a href="chapter-raster-data.html#cb106-2" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb106-3"><a href="chapter-raster-data.html#cb106-3" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb106-4"><a href="chapter-raster-data.html#cb106-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> MEAN)</span>
<span id="cb106-5"><a href="chapter-raster-data.html#cb106-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-6"><a href="chapter-raster-data.html#cb106-6" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(</span>
<span id="cb106-7"><a href="chapter-raster-data.html#cb106-7" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>,</span>
<span id="cb106-8"><a href="chapter-raster-data.html#cb106-8" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb106-9"><a href="chapter-raster-data.html#cb106-9" tabindex="-1"></a>    <span class="st">&quot;Temperature (°C)&quot;</span></span>
<span id="cb106-10"><a href="chapter-raster-data.html#cb106-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-11"><a href="chapter-raster-data.html#cb106-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (state mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-12"><a href="chapter-raster-data.html#cb106-12" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-13"><a href="chapter-raster-data.html#cb106-13" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb106-14"><a href="chapter-raster-data.html#cb106-14" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb106-15"><a href="chapter-raster-data.html#cb106-15" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb106-16"><a href="chapter-raster-data.html#cb106-16" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb106-17"><a href="chapter-raster-data.html#cb106-17" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb106-18"><a href="chapter-raster-data.html#cb106-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_state_mean.png" width = "75%" height = "auto" class = "centerimage"></p>
</div>
<div id="reclassify-1" class="section level3 hasAnchor" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> Reclassify<a href="chapter-raster-data.html#reclassify-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Raster data is most often continuous numeric data. Sometimes, however, it is important to classify the continuous numeric raster data into discrete classes. For this example, we will reclassify the annual mean temperature data into three discrete classes: &lt;10°C, 10°C - 20°C, &gt;20°C.</p>
<p>The first step in the reclassification process is to create a matrix storing the “from”, “to”, and “becomes” values. As the names imply, the “from” and “to” values identify the discrete ranges to be reclassified, and “becomes” is the new value that data within this range will take (i.e., “from” 0 “to” 5 “becomes” 1 means that values ranging from 0 to 5 will be reclassified as 1).</p>
<p>Create the reclassification matrix.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="chapter-raster-data.html#cb107-1" tabindex="-1"></a>from <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb107-2"><a href="chapter-raster-data.html#cb107-2" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb107-3"><a href="chapter-raster-data.html#cb107-3" tabindex="-1"></a>  <span class="dv">10</span>,</span>
<span id="cb107-4"><a href="chapter-raster-data.html#cb107-4" tabindex="-1"></a>  <span class="dv">20</span></span>
<span id="cb107-5"><a href="chapter-raster-data.html#cb107-5" tabindex="-1"></a>)</span>
<span id="cb107-6"><a href="chapter-raster-data.html#cb107-6" tabindex="-1"></a>to <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb107-7"><a href="chapter-raster-data.html#cb107-7" tabindex="-1"></a>  <span class="dv">10</span>,</span>
<span id="cb107-8"><a href="chapter-raster-data.html#cb107-8" tabindex="-1"></a>  <span class="dv">20</span>,</span>
<span id="cb107-9"><a href="chapter-raster-data.html#cb107-9" tabindex="-1"></a>  <span class="cn">Inf</span></span>
<span id="cb107-10"><a href="chapter-raster-data.html#cb107-10" tabindex="-1"></a>)</span>
<span id="cb107-11"><a href="chapter-raster-data.html#cb107-11" tabindex="-1"></a>becomes <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb107-12"><a href="chapter-raster-data.html#cb107-12" tabindex="-1"></a>reclass <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb107-13"><a href="chapter-raster-data.html#cb107-13" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb107-14"><a href="chapter-raster-data.html#cb107-14" tabindex="-1"></a>    from,</span>
<span id="cb107-15"><a href="chapter-raster-data.html#cb107-15" tabindex="-1"></a>    to,</span>
<span id="cb107-16"><a href="chapter-raster-data.html#cb107-16" tabindex="-1"></a>    becomes</span>
<span id="cb107-17"><a href="chapter-raster-data.html#cb107-17" tabindex="-1"></a>  ),</span>
<span id="cb107-18"><a href="chapter-raster-data.html#cb107-18" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb107-19"><a href="chapter-raster-data.html#cb107-19" tabindex="-1"></a>)</span></code></pre></div>
<p>Now that the reclassification matrix has been prepared, reclassify the annual mean temperatures. The <code>right = TRUE</code> argument indicates that intervals are open on the left and closed on the right (i.e., (0,10] becomes 1).</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="chapter-raster-data.html#cb108-1" tabindex="-1"></a>narr_reclass <span class="ot">&lt;-</span> <span class="fu">classify</span>(narr_crop_c<span class="sc">$</span>mean,</span>
<span id="cb108-2"><a href="chapter-raster-data.html#cb108-2" tabindex="-1"></a>  <span class="at">rcl =</span> reclass,</span>
<span id="cb108-3"><a href="chapter-raster-data.html#cb108-3" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb108-4"><a href="chapter-raster-data.html#cb108-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Although <code>narr_reclass</code> contains the reclassified mean air temperature data, the data is still continuously numeric. The following chunk of code converts the <code>narr_reclass$mean</code> layer from numeric to character based on the defined levels.</p>
<p><code>narr_reclass</code> contains the reclassified mean air temperature data, but the data is still numeric. The <code>terra::set.cats()</code> function assigns categories to numeric data based on values stored in a data frame.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="chapter-raster-data.html#cb109-1" tabindex="-1"></a>level_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb109-2"><a href="chapter-raster-data.html#cb109-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb109-3"><a href="chapter-raster-data.html#cb109-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)</span>
<span id="cb109-4"><a href="chapter-raster-data.html#cb109-4" tabindex="-1"></a>)</span>
<span id="cb109-5"><a href="chapter-raster-data.html#cb109-5" tabindex="-1"></a><span class="fu">colnames</span>(level_values) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean_continuous&quot;</span>, <span class="st">&quot;mean_discrete&quot;</span>)</span>
<span id="cb109-6"><a href="chapter-raster-data.html#cb109-6" tabindex="-1"></a><span class="fu">set.cats</span>(narr_reclass,</span>
<span id="cb109-7"><a href="chapter-raster-data.html#cb109-7" tabindex="-1"></a>  <span class="at">layer =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb109-8"><a href="chapter-raster-data.html#cb109-8" tabindex="-1"></a>  <span class="at">value =</span> level_values</span>
<span id="cb109-9"><a href="chapter-raster-data.html#cb109-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot the discretely reclassified mean temperature data.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="chapter-raster-data.html#cb110-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb110-2"><a href="chapter-raster-data.html#cb110-2" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> narr_reclass<span class="sc">$</span>mean_discrete) <span class="sc">+</span></span>
<span id="cb110-3"><a href="chapter-raster-data.html#cb110-3" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb110-4"><a href="chapter-raster-data.html#cb110-4" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb110-5"><a href="chapter-raster-data.html#cb110-5" tabindex="-1"></a>      <span class="st">&quot;≤10°&quot;</span>,</span>
<span id="cb110-6"><a href="chapter-raster-data.html#cb110-6" tabindex="-1"></a>      <span class="st">&quot;10°&lt; &amp; ≤20°&quot;</span>,</span>
<span id="cb110-7"><a href="chapter-raster-data.html#cb110-7" tabindex="-1"></a>      <span class="st">&quot;20°&lt;&quot;</span>,</span>
<span id="cb110-8"><a href="chapter-raster-data.html#cb110-8" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb110-9"><a href="chapter-raster-data.html#cb110-9" tabindex="-1"></a>    ),</span>
<span id="cb110-10"><a href="chapter-raster-data.html#cb110-10" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span></span>
<span id="cb110-11"><a href="chapter-raster-data.html#cb110-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb110-12"><a href="chapter-raster-data.html#cb110-12" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Temperature (reclassified)&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-13"><a href="chapter-raster-data.html#cb110-13" tabindex="-1"></a>  <span class="fu">geom_spatvector</span>(</span>
<span id="cb110-14"><a href="chapter-raster-data.html#cb110-14" tabindex="-1"></a>    <span class="at">data =</span> conus_t,</span>
<span id="cb110-15"><a href="chapter-raster-data.html#cb110-15" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb110-16"><a href="chapter-raster-data.html#cb110-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb110-17"><a href="chapter-raster-data.html#cb110-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb110-18"><a href="chapter-raster-data.html#cb110-18" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-19"><a href="chapter-raster-data.html#cb110-19" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb110-20"><a href="chapter-raster-data.html#cb110-20" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb110-21"><a href="chapter-raster-data.html#cb110-21" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb110-22"><a href="chapter-raster-data.html#cb110-22" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb110-23"><a href="chapter-raster-data.html#cb110-23" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb110-24"><a href="chapter-raster-data.html#cb110-24" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/intro_to_spatial/temp_raster_reclass.png" width = "75%" height = "auto" class = "centerimage"></p>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-r-terra" class="csl-entry">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Hijmans, Robert J. 2024. <em><span class="nocase">terra</span>: Spatial Data Analysis</em>. R Package Version 1.7-71. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a></div>
</div>
<div id="ref-r-tidyterra" class="csl-entry">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Hernangómez, Diego. 2023. <span>“Using the <span class="nocase">tidyverse</span> with <span class="nocase">terra</span> Objects: The <span class="nocase">tidyterra</span> Package.”</span> <em>Journal of Open Source Software</em> 8 (91): 5751. <a href="https://doi.org/10.21105/joss.05751">https://doi.org/10.21105/joss.05751</a></div>
</div>
</div>
<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js" defer></script>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-polygon-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wildfire-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
