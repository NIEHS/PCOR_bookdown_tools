<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 A FHIR PIT Tutorial | The CHORDS Toolkit for Health and Geospatial Exposures Research</title>
  <meta name="description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="7 A FHIR PIT Tutorial | The CHORDS Toolkit for Health and Geospatial Exposures Research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  <meta name="github-repo" content="NIEHS/PCOR_bookdown_tools" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 A FHIR PIT Tutorial | The CHORDS Toolkit for Health and Geospatial Exposures Research" />
  
  <meta name="twitter:description" content="The CHORDS Toolkit provides guides, tools, and example code to support climate change and human health research." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-link-to-census.html"/>
<link rel="next" href="case-studies.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CHORDS Toolkit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><strong>Introduction</strong></a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#about-chords"><i class="fa fa-check"></i>About CHORDS</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#about-this-toolkit"><i class="fa fa-check"></i>About This Toolkit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="unit-geospatial-foundations.html"><a href="unit-geospatial-foundations.html"><i class="fa fa-check"></i><strong>Geospatial Data Foundations</strong></a></li>
<li class="chapter" data-level="1" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#introduction-1"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#concepts-and-terminology"><i class="fa fa-check"></i><b>1.2</b> Concepts and Terminology</a></li>
<li class="chapter" data-level="1.3" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#datasets"><i class="fa fa-check"></i><b>1.3</b> Datasets</a></li>
<li class="chapter" data-level="1.4" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#r-packages"><i class="fa fa-check"></i><b>1.4</b> <code>R</code> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="chapter-getting-started-spatial.html"><a href="chapter-getting-started-spatial.html#chapter-getting-started-spatial-resources"><i class="fa fa-check"></i><b>1.5</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-point-data.html"><a href="chapter-point-data.html"><i class="fa fa-check"></i><b>2</b> Point Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-point-data.html"><a href="chapter-point-data.html#introduction-2"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-point-data.html"><a href="chapter-point-data.html#access-download-and-unzip"><i class="fa fa-check"></i><b>2.2</b> Access, Download, and Unzip</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-point-data.html"><a href="chapter-point-data.html#data-preparation"><i class="fa fa-check"></i><b>2.3</b> Data Preparation</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-point-data.html"><a href="chapter-point-data.html#exploratory-analysis"><i class="fa fa-check"></i><b>2.4</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html"><i class="fa fa-check"></i><b>3</b> Polygon Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#introduction-3"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#chapter-polygon-access"><i class="fa fa-check"></i><b>3.2</b> Access, Download, and Unzip</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#data-preparation-with-sf"><i class="fa fa-check"></i><b>3.3</b> Data Preparation with <code>sf</code></a></li>
<li class="chapter" data-level="3.4" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#exploratory-analysis-with-sf"><i class="fa fa-check"></i><b>3.4</b> Exploratory Analysis with <code>sf</code></a></li>
<li class="chapter" data-level="3.5" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#data-preparation-with-terra"><i class="fa fa-check"></i><b>3.5</b> Data Preparation with <code>terra</code></a></li>
<li class="chapter" data-level="3.6" data-path="chapter-polygon-data.html"><a href="chapter-polygon-data.html#exploratory-analysis-with-terra"><i class="fa fa-check"></i><b>3.6</b> Exploratory Analysis with <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html"><i class="fa fa-check"></i><b>4</b> Raster Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#introduction-4"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#raster-access"><i class="fa fa-check"></i><b>4.2</b> Access and Download</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#data-preparation-1"><i class="fa fa-check"></i><b>4.3</b> Data Preparation</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-raster-data.html"><a href="chapter-raster-data.html#exploratory-analysis-1"><i class="fa fa-check"></i><b>4.4</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="wildfire-data.html"><a href="wildfire-data.html"><i class="fa fa-check"></i><strong>Wildfire Data</strong></a></li>
<li class="chapter" data-level="" data-path="other-environmental-data.html"><a href="other-environmental-data.html"><i class="fa fa-check"></i><strong>Other Environmental Data</strong></a></li>
<li class="chapter" data-level="5" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html"><i class="fa fa-check"></i><b>5</b> NASA EarthData Download</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#introduction-5"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#nasa-earthdata-account"><i class="fa fa-check"></i><b>5.2</b> NASA EarthData Account</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#generate-prerequisite-files"><i class="fa fa-check"></i><b>5.3</b> Generate Prerequisite Files</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-nasa-earthdata.html"><a href="chapter-nasa-earthdata.html#download-data"><i class="fa fa-check"></i><b>5.4</b> Download Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="health-data-integration.html"><a href="health-data-integration.html"><i class="fa fa-check"></i><strong>Health Data Integration</strong></a></li>
<li class="chapter" data-level="6" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html"><i class="fa fa-check"></i><b>6</b> Linkage to Census Units</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#introduction-6"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#tutorial"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-link-to-census.html"><a href="chapter-link-to-census.html#concluding-remarks"><i class="fa fa-check"></i><b>6.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html"><i class="fa fa-check"></i><b>7</b> A FHIR PIT Tutorial</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#introduction-7"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#tutorial-1"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#fhir-pit-considerations"><i class="fa fa-check"></i><b>7.3</b> Considerations</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-fhir-pit.html"><a href="chapter-fhir-pit.html#concluding-remarks-1"><i class="fa fa-check"></i><b>7.4</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><strong>Case Studies</strong></a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><strong>Appendix</strong></a></li>
<li class="chapter" data-level="" data-path="chapter-user-profiles.html"><a href="chapter-user-profiles.html"><i class="fa fa-check"></i><strong>A</strong> User Profiles</a></li>
<li class="chapter" data-level="" data-path="chords-glossary.html"><a href="chords-glossary.html"><i class="fa fa-check"></i><strong>B</strong> CHORDS Glossary</a></li>
<li class="chapter" data-level="" data-path="all-references-appendix.html"><a href="all-references-appendix.html"><i class="fa fa-check"></i><strong>C</strong> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" 
target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The CHORDS Toolkit for Health and Geospatial Exposures Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-fhir-pit" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> A FHIR PIT Tutorial<a href="chapter-fhir-pit.html#chapter-fhir-pit" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="chapter-user-profiles.html#profilecmp"><img src="images/user_profiles/profilecmp.svg" alt="Profile-CMP" /></a> <a href="chapter-user-profiles.html#profilecre"><img src="images/user_profiles/profilecre.svg" alt="Profile-CRE" /></a> <a href="chapter-user-profiles.html#profilecdm"><img src="images/user_profiles/profilecdm.svg" alt="Profile-CDM" /></a> <a href="chapter-user-profiles.html#profilegeo"><img src="images/user_profiles/profilegeo.svg" alt="Profile-GEO" /></a> <a href="chapter-user-profiles.html#profilesbs"><img src="images/user_profiles/profilesbs.svg" alt="Profile-SBS" /></a></p>
<div id="fhir-pit-hl7-fast-healthcare-interoperability-resources-patient-data-integration-tool-a-tutorial" class="section level3 unnumbered hasAnchor">
<h3>FHIR PIT: HL7 Fast Healthcare Interoperability Resources Patient data Integration Tool: A Tutorial<a href="chapter-fhir-pit.html#fhir-pit-hl7-fast-healthcare-interoperability-resources-patient-data-integration-tool-a-tutorial" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Date Modified</strong>: July 8, 2024</p>
<p><strong>Authors</strong>: Juan Garcia <a href="https://orcid.org/0009-0003-6503-2986"><img src="images/orcid.png" width="10" alt="author-jc" /></a>, Kara Fecho <a href="https://orcid.org/0000-0002-6704-9306"><img src="images/orcid.png" width="10" alt="author-kf" /></a>, Hong Yi <a href="https://orcid.org/0000-0002-5699-1259"><img src="images/orcid.png" width="10" alt="author-hy" /></a></p>
<p><strong>Key Terms</strong>: <a href="https://tools.niehs.nih.gov/cchhglossary/?keyword=data+integration&amp;termOnlySearch=true&amp;exactSearch=true">Data Integration</a>, <a href="chords-glossary.html#def-ehr">Electronic Health Record</a>, <a href="https://tools.niehs.nih.gov/cchhglossary/?keyword=exposure&amp;termOnlySearch=true&amp;exactSearch=true">Exposure</a>, <a href="chords-glossary.html#def-fhir">FHIR</a>, <a href="chords-glossary.html#def-geocoded-address">Geocoded Address</a></p>
<p><strong>Programming Languages</strong>: R, Bash</p>
</div>
<div id="introduction-7" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction<a href="chapter-fhir-pit.html#introduction-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This tutorial provides example code in <code>R</code>:</p>
<ol style="list-style-type: decimal">
<li><p>To set up FHIR PIT.</p></li>
<li><p>To analyze the results from the FHIR PIT output.</p></li>
</ol>
<div id="disclaimer" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Disclaimer<a href="chapter-fhir-pit.html#disclaimer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The patient dataset used in this tutorial is synthetic. When using actual patient or participant datasets containing Protected Health Information (PHI), one must run FHIR PIT within a secure enclave and abide by all federal and institutional regulations.</p>
</div>
<div id="motivation-3" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Motivation<a href="chapter-fhir-pit.html#motivation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Environmental exposures are increasingly recognized as important to consider when conducting human subjects research. Unfortunately, associating environmental exposures data with subject-level data is challenging due to the complexity of the data and the varied spatiotemporal resolutions. FHIR PIT is an open-source tool to link electronic health record (EHR) data in FHIR format with environmental exposures data derived from public sources. See Section <a href="chapter-fhir-pit.html#fhir-pit-considerations">Considerations</a> for tools to support other common data models (CDMs).</p>
</div>
<div id="background" class="section level3 hasAnchor" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Background<a href="chapter-fhir-pit.html#background" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>FHIR PIT (HL7 Fast Healthcare Interoperability Resources Patient data Integration Tool) is an open-source data integration pipeline to support subject-level research on social and environmental determinants of health and disease <span class="citation">(<a href="#ref-fhirpit-repo">26</a>)</span>.</p>
<p>In essence, the pipeline is a sequence of transformations configured from a YAML file <span class="citation">(<a href="#ref-fhirpit-docs">27</a>)</span>. The transformation steps join FHIR patient records with environmental exposures estimates using patient geocodes (e.g., primary residence) and date(s) of healthcare visits as the spatiotemporal links. At the end of each linkage step, FHIR PIT saves the linked tables to an intermediate folder to support rapid re-execution, should any given step fail to complete (e.g., lack of disk space). To support multiple healthcare visits, FHIR PIT vectorizes the FHIR patient records by grouping FHIR domains (e.g., Condition, Laboratory, Medication, Procedure) and counting events within a domain on a per-day basis. The features associated with the patient are then grouped by user-defined study periods (e.g., year) and aggregated with user-defined statistics (e.g., counts, mean, median, first measurement, last measurement).</p>
<p>FHIR PIT was developed to support ICEES (Integrated Clinical and Environmental Exposures Service) <span class="citation">(<a href="#ref-xu2020fhir">28</a>,<a href="#ref-fecho2019novel">29</a>)</span>. However, the tool is not specific to ICEES, but rather can be used to integrate any source of patient FHIR files with any source of environmental exposures data. In this tutorial, we use synthetic FHIR files and randomly sampled environmental exposures data derived from several public sources:</p>
<ul>
<li><a href="https://www.epa.gov/cmaq">US Environmental Protection Agency (EPA) airborne pollutant exposures data</a> - The US EPA maintains collections of model-derived estimates of airborne pollutant exposure data such as PM<sub>2.5</sub> and ozone at varying spatial and temporal resolutions. FHIR PIT uses the data to calculate, for example, average daily PM<sub>2.5</sub> exposure and maximum daily ozone exposure over a defined study period.</li>
<li><a href="https://www.fhwa.dot.gov/policyinformation/hpms.cfm">US Department of Transportation (DOT), Federal Highway Administration (FHA), Highway Performance Monitoring System (HPMS) major roadway/highway exposures data</a> - The US DOT maintains a variety of metrics on roadway data. FHIR PIT uses the data to calculate point estimates of primary residential distance from the nearest major roadway or highway.</li>
<li><a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">US Census Bureau TIGER/line roadway data</a> - The US Census Bureau also maintains metrics on roadway data. FHIR PIT uses the data to supplement the US DOT data.</li>
<li><a href="https://www.census.gov/programs-surveys/acs/data.html">US Census Bureau American Community Survey (ACS) socio-economic exposures data</a> - The US Census Bureau’s ACS is a 5-year survey sample from the decennial nationwide US census. FHIR PIT uses a subset of the available ACS survey estimates of socio-economic exposures, including survey estimates on residential density, household median income, and household access to health insurance.</li>
<li><a href="https://deq.nc.gov/cafo-map">NC Department of Environmental Quality (DEQ) concentrated animal feeding operations (CAFO) exposures data</a> - North Carolina’s DEQ maintains data on the location of all registered CAFOs across the state. FHIR PIT uses the data to calculate point estimates of primary residential distance from the nearest CAFO.</li>
<li><a href="https://www.nconemap.gov/datasets/ncdenr::active-permitted-landfills/about">NC Department of Environmental Quality (DEQ) landfill exposures data</a> - North Carolina’s DEQ maintains data on the location of all registered active and inactive landfills across the state. FHIR PIT uses the data to calculate point estimates of primary residential distance from the nearest landfill.</li>
</ul>
</div>
<div id="outline-1" class="section level3 hasAnchor" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Outline<a href="chapter-fhir-pit.html#outline-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This tutorial includes the following steps:</p>
<ol style="list-style-type: decimal">
<li><p><a href="chapter-fhir-pit.html#fhir-pit-step-0">Setup</a></p></li>
<li><p><a href="chapter-fhir-pit.html#fhir-pit-step-1">Run FHIR PIT</a></p></li>
<li><p><a href="chapter-fhir-pit.html#fhir-pit-step-2">Analyze results</a></p></li>
</ol>
</div>
</div>
<div id="tutorial-1" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Tutorial<a href="chapter-fhir-pit.html#tutorial-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="chapter-fhir-pit.html#cb149-1" tabindex="-1"></a><span class="co"># Loading library</span></span>
<span id="cb149-2"><a href="chapter-fhir-pit.html#cb149-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="fhir-pit-step-0" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Setup<a href="chapter-fhir-pit.html#fhir-pit-step-0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Install Docker. Follow instructions in <a href="https://docs.docker.com/engine/install/">Docker installation documentation</a> for your operating system.</p>
<p>Assign WORK_DIR the directory you would like to save FHIR PIT and its outputs to.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="chapter-fhir-pit.html#cb150-1" tabindex="-1"></a>work_dir <span class="ot">&lt;-</span> <span class="st">&quot;/ADD/YOUR/FILEPATH/HERE&quot;</span></span>
<span id="cb150-2"><a href="chapter-fhir-pit.html#cb150-2" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">WORK_DIR =</span> work_dir)</span></code></pre></div>
<p>Clone FHIR PIT into the WORK_DIR directory.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb151-1"><a href="chapter-fhir-pit.html#cb151-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$WORK_DIR</span></span>
<span id="cb151-2"><a href="chapter-fhir-pit.html#cb151-2" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recursive</span> https://github.com/ExposuresProvider/FHIR-PIT.git <span class="va">$WORK_DIR</span></span></code></pre></div>
</div>
<div id="fhir-pit-step-1" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Execute FHIR-PIT<a href="chapter-fhir-pit.html#fhir-pit-step-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb152"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb152-1"><a href="chapter-fhir-pit.html#cb152-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/data/output&quot;</span></span></code></pre></div>
<p>Run FHIR PIT in a docker container with -v. This will allow the output data to persist and be easily accessible by users on the host.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb153-1"><a href="chapter-fhir-pit.html#cb153-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-m</span><span class="op">=</span>4g <span class="at">-v</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/data/output&quot;</span>:<span class="st">&quot;/FHIR-PIT/data/output&quot;</span> renci/fhir-pit:1.0</span></code></pre></div>
</div>
<div id="fhir-pit-step-2" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Access and Analyze Results<a href="chapter-fhir-pit.html#fhir-pit-step-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The main outputs to consider are in ICEES, ICEES2 and ICEES2_dei directories (named in reference to ICEES, but not specific to ICEES). Each directory contains one or more CSV files with information at different granularities.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="chapter-fhir-pit.html#cb154-1" tabindex="-1"></a>year_ <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb154-2"><a href="chapter-fhir-pit.html#cb154-2" tabindex="-1"></a>basepath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(work_dir, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;output&quot;</span>)</span>
<span id="cb154-3"><a href="chapter-fhir-pit.html#cb154-3" tabindex="-1"></a>icees2dei_patient_url <span class="ot">&lt;-</span> <span class="fu">file.path</span>(basepath, <span class="st">&quot;icees2_dei&quot;</span>,</span>
<span id="cb154-4"><a href="chapter-fhir-pit.html#cb154-4" tabindex="-1"></a>                                   <span class="fu">sprintf</span>(<span class="st">&quot;%spatient_deidentified&quot;</span>, year_))</span></code></pre></div>
<p>The ICEES directory contains one CSV file per subject. Each CSV file consists of the subject’s visits, concatenated with the corresponding environmental exposure estimates for that day and that subject’s location. If a subject has multiple visits per day, then the transformation “PreprocPerPatSeriesToVector” step aggregates multiple daily visits by counting how many times a drug or diagnosis occurred. The directory for each subject is indexed by the “patient_num” column. The ICEES2 directory contains a single CSV file with the aggregation of all subjects grouped by (subject, study period). Lastly, the ICEES2DEI directory contains the same aggregated CSV file, but the data have been stripped of all PHI per HIPAA Safe Harbor method <span class="citation">(<a href="#ref-hhs2023hipaa">30</a>)</span>. The fully deidentified file then abides by all federal regulations surrounding privacy and security, although institutional regulations may remain. For exposition purposes, we focus on the deidentified ICEES2DEI CSV file and reorder its columns.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="chapter-fhir-pit.html#cb155-1" tabindex="-1"></a>icees2dei_colorder <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;icees2dei_patient_column_order.txt&quot;</span>,</span>
<span id="cb155-2"><a href="chapter-fhir-pit.html#cb155-2" tabindex="-1"></a>                           <span class="at">what =</span> <span class="st">&quot;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb155-3"><a href="chapter-fhir-pit.html#cb155-3" tabindex="-1"></a>icees2dei <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(icees2dei_patient_url,</span>
<span id="cb155-4"><a href="chapter-fhir-pit.html#cb155-4" tabindex="-1"></a>                      <span class="at">header =</span> <span class="cn">TRUE</span>)[, icees2dei_colorder]</span>
<span id="cb155-5"><a href="chapter-fhir-pit.html#cb155-5" tabindex="-1"></a>icees2dei</span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="chapter-fhir-pit.html#cb156-1" tabindex="-1"></a><span class="co">#   index year AvgDailyPM2.5Exposure AvgDailyPM2.5Exposure_StudyAvg</span></span>
<span id="cb156-2"><a href="chapter-fhir-pit.html#cb156-2" tabindex="-1"></a><span class="co"># 1     0 2010              7.949999                       8.645932</span></span>
<span id="cb156-3"><a href="chapter-fhir-pit.html#cb156-3" tabindex="-1"></a><span class="co"># 2     1 2010             10.520382                       8.645932</span></span>
<span id="cb156-4"><a href="chapter-fhir-pit.html#cb156-4" tabindex="-1"></a><span class="co"># 3     2 2010             22.711028                      12.472791</span></span>
<span id="cb156-5"><a href="chapter-fhir-pit.html#cb156-5" tabindex="-1"></a><span class="co"># 4     3 2010             22.134923                      10.000803</span></span>
<span id="cb156-6"><a href="chapter-fhir-pit.html#cb156-6" tabindex="-1"></a><span class="co">#   AvgDailyPM2.5Exposure_StudyMax MaxDailyPM2.5Exposure</span></span>
<span id="cb156-7"><a href="chapter-fhir-pit.html#cb156-7" tabindex="-1"></a><span class="co"># 1                       38.89938              20.42399</span></span>
<span id="cb156-8"><a href="chapter-fhir-pit.html#cb156-8" tabindex="-1"></a><span class="co"># 2                       38.89938              16.50489</span></span>
<span id="cb156-9"><a href="chapter-fhir-pit.html#cb156-9" tabindex="-1"></a><span class="co"># 3                       49.20912              35.83996</span></span>
<span id="cb156-10"><a href="chapter-fhir-pit.html#cb156-10" tabindex="-1"></a><span class="co"># 4                       50.76701              37.09866</span></span>
<span id="cb156-11"><a href="chapter-fhir-pit.html#cb156-11" tabindex="-1"></a><span class="co">#   MaxDailyPM2.5Exposure_StudyAvg MaxDailyPM2.5Exposure_StudyMax</span></span>
<span id="cb156-12"><a href="chapter-fhir-pit.html#cb156-12" tabindex="-1"></a><span class="co"># 1                       14.07015                       54.65602</span></span>
<span id="cb156-13"><a href="chapter-fhir-pit.html#cb156-13" tabindex="-1"></a><span class="co"># 2                       14.07015                       54.65602</span></span>
<span id="cb156-14"><a href="chapter-fhir-pit.html#cb156-14" tabindex="-1"></a><span class="co"># 3                       20.50664                       71.36617</span></span>
<span id="cb156-15"><a href="chapter-fhir-pit.html#cb156-15" tabindex="-1"></a><span class="co"># 4                       16.74545                       67.37352</span></span>
<span id="cb156-16"><a href="chapter-fhir-pit.html#cb156-16" tabindex="-1"></a><span class="co">#   AvgDailyOzoneExposure AvgDailyOzoneExposure_StudyAvg</span></span>
<span id="cb156-17"><a href="chapter-fhir-pit.html#cb156-17" tabindex="-1"></a><span class="co"># 1              36.97466                       46.99595</span></span>
<span id="cb156-18"><a href="chapter-fhir-pit.html#cb156-18" tabindex="-1"></a><span class="co"># 2              18.62635                       46.99595</span></span>
<span id="cb156-19"><a href="chapter-fhir-pit.html#cb156-19" tabindex="-1"></a><span class="co"># 3              55.75696                       38.58856</span></span>
<span id="cb156-20"><a href="chapter-fhir-pit.html#cb156-20" tabindex="-1"></a><span class="co"># 4              38.33320                       40.13805</span></span>
<span id="cb156-21"><a href="chapter-fhir-pit.html#cb156-21" tabindex="-1"></a><span class="co">#   AvgDailyOzoneExposure_StudyMax MaxDailyOzoneExposure</span></span>
<span id="cb156-22"><a href="chapter-fhir-pit.html#cb156-22" tabindex="-1"></a><span class="co"># 1                      128.36066              42.67887</span></span>
<span id="cb156-23"><a href="chapter-fhir-pit.html#cb156-23" tabindex="-1"></a><span class="co"># 2                      128.36066              28.94073</span></span>
<span id="cb156-24"><a href="chapter-fhir-pit.html#cb156-24" tabindex="-1"></a><span class="co"># 3                       69.68106              94.79951</span></span>
<span id="cb156-25"><a href="chapter-fhir-pit.html#cb156-25" tabindex="-1"></a><span class="co"># 4                       76.71777              67.85281</span></span>
<span id="cb156-26"><a href="chapter-fhir-pit.html#cb156-26" tabindex="-1"></a><span class="co">#   MaxDailyOzoneExposure_StudyAvg MaxDailyOzoneExposure_StudyMax</span></span>
<span id="cb156-27"><a href="chapter-fhir-pit.html#cb156-27" tabindex="-1"></a><span class="co"># 1                       61.60031                       198.8417</span></span>
<span id="cb156-28"><a href="chapter-fhir-pit.html#cb156-28" tabindex="-1"></a><span class="co"># 2                       61.60031                       198.8417</span></span>
<span id="cb156-29"><a href="chapter-fhir-pit.html#cb156-29" tabindex="-1"></a><span class="co"># 3                       55.08151                       103.9576</span></span>
<span id="cb156-30"><a href="chapter-fhir-pit.html#cb156-30" tabindex="-1"></a><span class="co"># 4                       55.48645                       115.6936</span></span>
<span id="cb156-31"><a href="chapter-fhir-pit.html#cb156-31" tabindex="-1"></a><span class="co">#   AvgDailyPM2.5Exposure_2 MaxDailyOzoneExposure_2 AvgDailyCOExposure_2</span></span>
<span id="cb156-32"><a href="chapter-fhir-pit.html#cb156-32" tabindex="-1"></a><span class="co"># 1                9.274049                36.54099             213.2262</span></span>
<span id="cb156-33"><a href="chapter-fhir-pit.html#cb156-33" tabindex="-1"></a><span class="co"># 2                9.498967                35.70597             358.0131</span></span>
<span id="cb156-34"><a href="chapter-fhir-pit.html#cb156-34" tabindex="-1"></a><span class="co"># 3                8.238118                39.11024             212.4620</span></span>
<span id="cb156-35"><a href="chapter-fhir-pit.html#cb156-35" tabindex="-1"></a><span class="co"># 4                8.300655                38.53758             193.7690</span></span>
<span id="cb156-36"><a href="chapter-fhir-pit.html#cb156-36" tabindex="-1"></a><span class="co">#   AvgDailyNOExposure_2 AvgDailyNO2Exposure_2 AvgDailyNOxExposure_2</span></span>
<span id="cb156-37"><a href="chapter-fhir-pit.html#cb156-37" tabindex="-1"></a><span class="co"># 1             3.048349             11.539853              14.58820</span></span>
<span id="cb156-38"><a href="chapter-fhir-pit.html#cb156-38" tabindex="-1"></a><span class="co"># 2            14.655994             22.662306              37.31830</span></span>
<span id="cb156-39"><a href="chapter-fhir-pit.html#cb156-39" tabindex="-1"></a><span class="co"># 3             2.493993             10.630901              13.12489</span></span>
<span id="cb156-40"><a href="chapter-fhir-pit.html#cb156-40" tabindex="-1"></a><span class="co"># 4             1.840359              8.475516              10.31587</span></span>
<span id="cb156-41"><a href="chapter-fhir-pit.html#cb156-41" tabindex="-1"></a><span class="co">#   AvgDailySO2Exposure_2 AvgDailyAcetaldehydeExposure_2</span></span>
<span id="cb156-42"><a href="chapter-fhir-pit.html#cb156-42" tabindex="-1"></a><span class="co"># 1              1.956961                      0.6987113</span></span>
<span id="cb156-43"><a href="chapter-fhir-pit.html#cb156-43" tabindex="-1"></a><span class="co"># 2              3.789237                      0.9583015</span></span>
<span id="cb156-44"><a href="chapter-fhir-pit.html#cb156-44" tabindex="-1"></a><span class="co"># 3              1.613538                      0.8120486</span></span>
<span id="cb156-45"><a href="chapter-fhir-pit.html#cb156-45" tabindex="-1"></a><span class="co"># 4              1.097606                      0.7321192</span></span>
<span id="cb156-46"><a href="chapter-fhir-pit.html#cb156-46" tabindex="-1"></a><span class="co">#   AvgDailyFormaldehydeExposure_2 AvgDailyBenzeneExposure_2 ObesityBMI</span></span>
<span id="cb156-47"><a href="chapter-fhir-pit.html#cb156-47" tabindex="-1"></a><span class="co"># 1                      0.9163324                        NA          0</span></span>
<span id="cb156-48"><a href="chapter-fhir-pit.html#cb156-48" tabindex="-1"></a><span class="co"># 2                      1.3879702                        NA          0</span></span>
<span id="cb156-49"><a href="chapter-fhir-pit.html#cb156-49" tabindex="-1"></a><span class="co"># 3                      1.0863108                        NA          0</span></span>
<span id="cb156-50"><a href="chapter-fhir-pit.html#cb156-50" tabindex="-1"></a><span class="co"># 4                      0.9295859                        NA          0</span></span>
<span id="cb156-51"><a href="chapter-fhir-pit.html#cb156-51" tabindex="-1"></a><span class="co">#   TotalEDVisits TotalInpatientVisits TotalEDInpatientVisits Sex2  Sex</span></span>
<span id="cb156-52"><a href="chapter-fhir-pit.html#cb156-52" tabindex="-1"></a><span class="co"># 1             0                    0                      0 Male Male</span></span>
<span id="cb156-53"><a href="chapter-fhir-pit.html#cb156-53" tabindex="-1"></a><span class="co"># 2             0                    0                      0 Male Male</span></span>
<span id="cb156-54"><a href="chapter-fhir-pit.html#cb156-54" tabindex="-1"></a><span class="co"># 3             0                    0                      0 Male Male</span></span>
<span id="cb156-55"><a href="chapter-fhir-pit.html#cb156-55" tabindex="-1"></a><span class="co"># 4             0                    0                      0 Male Male</span></span>
<span id="cb156-56"><a href="chapter-fhir-pit.html#cb156-56" tabindex="-1"></a><span class="co">#      Race Ethnicity MajorRoadwayHighwayExposure RoadwayDistanceExposure</span></span>
<span id="cb156-57"><a href="chapter-fhir-pit.html#cb156-57" tabindex="-1"></a><span class="co"># 1 Unknown   Unknown                    227.9604                12.42057</span></span>
<span id="cb156-58"><a href="chapter-fhir-pit.html#cb156-58" tabindex="-1"></a><span class="co"># 2 Unknown   Unknown                   2098.2448               301.82455</span></span>
<span id="cb156-59"><a href="chapter-fhir-pit.html#cb156-59" tabindex="-1"></a><span class="co"># 3 Unknown   Unknown                    336.5802               252.79614</span></span>
<span id="cb156-60"><a href="chapter-fhir-pit.html#cb156-60" tabindex="-1"></a><span class="co"># 4 Unknown   Unknown                    460.0862               462.22059</span></span>
<span id="cb156-61"><a href="chapter-fhir-pit.html#cb156-61" tabindex="-1"></a><span class="co">#   RoadwayType RoadwayAADT RoadwaySpeedLimit RoadwayLanes CAFO_Exposure</span></span>
<span id="cb156-62"><a href="chapter-fhir-pit.html#cb156-62" tabindex="-1"></a><span class="co"># 1          NA          NA                NA           NA      574089.1</span></span>
<span id="cb156-63"><a href="chapter-fhir-pit.html#cb156-63" tabindex="-1"></a><span class="co"># 2          NA          NA                NA           NA      567777.9</span></span>
<span id="cb156-64"><a href="chapter-fhir-pit.html#cb156-64" tabindex="-1"></a><span class="co"># 3          NA          NA                NA           NA      472817.7</span></span>
<span id="cb156-65"><a href="chapter-fhir-pit.html#cb156-65" tabindex="-1"></a><span class="co"># 4          NA          NA                NA           NA      572968.6</span></span>
<span id="cb156-66"><a href="chapter-fhir-pit.html#cb156-66" tabindex="-1"></a><span class="co">#   Landfill_Exposure EstResidentialDensity</span></span>
<span id="cb156-67"><a href="chapter-fhir-pit.html#cb156-67" tabindex="-1"></a><span class="co"># 1          819888.5                    NA</span></span>
<span id="cb156-68"><a href="chapter-fhir-pit.html#cb156-68" tabindex="-1"></a><span class="co"># 2          813577.6                    NA</span></span>
<span id="cb156-69"><a href="chapter-fhir-pit.html#cb156-69" tabindex="-1"></a><span class="co"># 3          732120.1                    NA</span></span>
<span id="cb156-70"><a href="chapter-fhir-pit.html#cb156-70" tabindex="-1"></a><span class="co"># 4          826018.3                    NA</span></span>
<span id="cb156-71"><a href="chapter-fhir-pit.html#cb156-71" tabindex="-1"></a><span class="co">#   EstProbabilityHighSchoolMaxEducation EstProbabilityNoHealthIns</span></span>
<span id="cb156-72"><a href="chapter-fhir-pit.html#cb156-72" tabindex="-1"></a><span class="co"># 1                                   NA                        NA</span></span>
<span id="cb156-73"><a href="chapter-fhir-pit.html#cb156-73" tabindex="-1"></a><span class="co"># 2                                   NA                        NA</span></span>
<span id="cb156-74"><a href="chapter-fhir-pit.html#cb156-74" tabindex="-1"></a><span class="co"># 3                                   NA                        NA</span></span>
<span id="cb156-75"><a href="chapter-fhir-pit.html#cb156-75" tabindex="-1"></a><span class="co"># 4                                   NA                        NA</span></span>
<span id="cb156-76"><a href="chapter-fhir-pit.html#cb156-76" tabindex="-1"></a><span class="co">#   EstProbabilityHouseholdNonHispWhite EstProbabilityESL</span></span>
<span id="cb156-77"><a href="chapter-fhir-pit.html#cb156-77" tabindex="-1"></a><span class="co"># 1                                  NA                NA</span></span>
<span id="cb156-78"><a href="chapter-fhir-pit.html#cb156-78" tabindex="-1"></a><span class="co"># 2                                  NA                NA</span></span>
<span id="cb156-79"><a href="chapter-fhir-pit.html#cb156-79" tabindex="-1"></a><span class="co"># 3                                  NA                NA</span></span>
<span id="cb156-80"><a href="chapter-fhir-pit.html#cb156-80" tabindex="-1"></a><span class="co"># 4                                  NA                NA</span></span>
<span id="cb156-81"><a href="chapter-fhir-pit.html#cb156-81" tabindex="-1"></a><span class="co">#   EstProbabilityNonHispWhite EstHouseholdIncome EstResidentialDensity25Plus</span></span>
<span id="cb156-82"><a href="chapter-fhir-pit.html#cb156-82" tabindex="-1"></a><span class="co"># 1                         NA                 NA                          NA</span></span>
<span id="cb156-83"><a href="chapter-fhir-pit.html#cb156-83" tabindex="-1"></a><span class="co"># 2                         NA                 NA                          NA</span></span>
<span id="cb156-84"><a href="chapter-fhir-pit.html#cb156-84" tabindex="-1"></a><span class="co"># 3                         NA                 NA                          NA</span></span>
<span id="cb156-85"><a href="chapter-fhir-pit.html#cb156-85" tabindex="-1"></a><span class="co"># 4                         NA                 NA                          NA</span></span>
<span id="cb156-86"><a href="chapter-fhir-pit.html#cb156-86" tabindex="-1"></a><span class="co">#   EstProbabilityNoAuto ur Estradiol TesticularDysfunctionDx ProstateCancerDx</span></span>
<span id="cb156-87"><a href="chapter-fhir-pit.html#cb156-87" tabindex="-1"></a><span class="co"># 1                   NA NA         0                       0                0</span></span>
<span id="cb156-88"><a href="chapter-fhir-pit.html#cb156-88" tabindex="-1"></a><span class="co"># 2                   NA NA         0                       0                0</span></span>
<span id="cb156-89"><a href="chapter-fhir-pit.html#cb156-89" tabindex="-1"></a><span class="co"># 3                   NA NA         0                       0                0</span></span>
<span id="cb156-90"><a href="chapter-fhir-pit.html#cb156-90" tabindex="-1"></a><span class="co"># 4                   NA NA         0                       0                0</span></span>
<span id="cb156-91"><a href="chapter-fhir-pit.html#cb156-91" tabindex="-1"></a><span class="co">#   AnxietyDx Formoterol FibromyalgiaDx Metaproterenol Indacaterol</span></span>
<span id="cb156-92"><a href="chapter-fhir-pit.html#cb156-92" tabindex="-1"></a><span class="co"># 1         0          0              0              0           0</span></span>
<span id="cb156-93"><a href="chapter-fhir-pit.html#cb156-93" tabindex="-1"></a><span class="co"># 2         0          0              0              0           0</span></span>
<span id="cb156-94"><a href="chapter-fhir-pit.html#cb156-94" tabindex="-1"></a><span class="co"># 3         0          0              0              0           0</span></span>
<span id="cb156-95"><a href="chapter-fhir-pit.html#cb156-95" tabindex="-1"></a><span class="co"># 4         0          0              0              0           0</span></span>
<span id="cb156-96"><a href="chapter-fhir-pit.html#cb156-96" tabindex="-1"></a><span class="co">#   OvarianDysfunctionDx Fluoxetine PneumoniaDx Triptorelin Omalizumab</span></span>
<span id="cb156-97"><a href="chapter-fhir-pit.html#cb156-97" tabindex="-1"></a><span class="co"># 1                    0          0           0           0          0</span></span>
<span id="cb156-98"><a href="chapter-fhir-pit.html#cb156-98" tabindex="-1"></a><span class="co"># 2                    0          0           0           0          0</span></span>
<span id="cb156-99"><a href="chapter-fhir-pit.html#cb156-99" tabindex="-1"></a><span class="co"># 3                    0          0           0           0          0</span></span>
<span id="cb156-100"><a href="chapter-fhir-pit.html#cb156-100" tabindex="-1"></a><span class="co"># 4                    0          0           0           0          0</span></span>
<span id="cb156-101"><a href="chapter-fhir-pit.html#cb156-101" tabindex="-1"></a><span class="co">#   Mepolizumab Fluticasone Sertraline Budesonide AlcoholDependenceDx</span></span>
<span id="cb156-102"><a href="chapter-fhir-pit.html#cb156-102" tabindex="-1"></a><span class="co"># 1           0           0          0          0                   0</span></span>
<span id="cb156-103"><a href="chapter-fhir-pit.html#cb156-103" tabindex="-1"></a><span class="co"># 2           0           0          0          0                   0</span></span>
<span id="cb156-104"><a href="chapter-fhir-pit.html#cb156-104" tabindex="-1"></a><span class="co"># 3           0           0          0          0                   0</span></span>
<span id="cb156-105"><a href="chapter-fhir-pit.html#cb156-105" tabindex="-1"></a><span class="co"># 4           0           0          0          0                   0</span></span>
<span id="cb156-106"><a href="chapter-fhir-pit.html#cb156-106" tabindex="-1"></a><span class="co">#   Flunisolide Nandrolone Venlafaxine Androstenedione Arformoterol</span></span>
<span id="cb156-107"><a href="chapter-fhir-pit.html#cb156-107" tabindex="-1"></a><span class="co"># 1           0          0           0               0            0</span></span>
<span id="cb156-108"><a href="chapter-fhir-pit.html#cb156-108" tabindex="-1"></a><span class="co"># 2           0          0           0               0            0</span></span>
<span id="cb156-109"><a href="chapter-fhir-pit.html#cb156-109" tabindex="-1"></a><span class="co"># 3           0          0           0               0            0</span></span>
<span id="cb156-110"><a href="chapter-fhir-pit.html#cb156-110" tabindex="-1"></a><span class="co"># 4           0          0           0               0            0</span></span>
<span id="cb156-111"><a href="chapter-fhir-pit.html#cb156-111" tabindex="-1"></a><span class="co">#   MenopauseDx Diphenhydramine Paroxetine DrugDependenceDx DepressionDx</span></span>
<span id="cb156-112"><a href="chapter-fhir-pit.html#cb156-112" tabindex="-1"></a><span class="co"># 1           0               0          0                0            0</span></span>
<span id="cb156-113"><a href="chapter-fhir-pit.html#cb156-113" tabindex="-1"></a><span class="co"># 2           0               0          0                0            0</span></span>
<span id="cb156-114"><a href="chapter-fhir-pit.html#cb156-114" tabindex="-1"></a><span class="co"># 3           0               0          0                0            0</span></span>
<span id="cb156-115"><a href="chapter-fhir-pit.html#cb156-115" tabindex="-1"></a><span class="co"># 4           0               0          0                0            0</span></span>
<span id="cb156-116"><a href="chapter-fhir-pit.html#cb156-116" tabindex="-1"></a><span class="co">#   Mometasone AutismDx Progesterone Prednisone Escitalopram CroupDx Goserelin</span></span>
<span id="cb156-117"><a href="chapter-fhir-pit.html#cb156-117" tabindex="-1"></a><span class="co"># 1          0        0            0          0            0       0         0</span></span>
<span id="cb156-118"><a href="chapter-fhir-pit.html#cb156-118" tabindex="-1"></a><span class="co"># 2          0        0            0          0            0       0         0</span></span>
<span id="cb156-119"><a href="chapter-fhir-pit.html#cb156-119" tabindex="-1"></a><span class="co"># 3          0        0            0          0            0       0         0</span></span>
<span id="cb156-120"><a href="chapter-fhir-pit.html#cb156-120" tabindex="-1"></a><span class="co"># 4          0        0            0          0            0       0         0</span></span>
<span id="cb156-121"><a href="chapter-fhir-pit.html#cb156-121" tabindex="-1"></a><span class="co">#   Cetirizine Citalopram CoughDx EndometriosisDx TesticularCancerDx</span></span>
<span id="cb156-122"><a href="chapter-fhir-pit.html#cb156-122" tabindex="-1"></a><span class="co"># 1          0          0       0               0                  0</span></span>
<span id="cb156-123"><a href="chapter-fhir-pit.html#cb156-123" tabindex="-1"></a><span class="co"># 2          0          0       0               0                  0</span></span>
<span id="cb156-124"><a href="chapter-fhir-pit.html#cb156-124" tabindex="-1"></a><span class="co"># 3          0          0       0               0                  0</span></span>
<span id="cb156-125"><a href="chapter-fhir-pit.html#cb156-125" tabindex="-1"></a><span class="co"># 4          0          0       0               0                  0</span></span>
<span id="cb156-126"><a href="chapter-fhir-pit.html#cb156-126" tabindex="-1"></a><span class="co">#   UterineCancerDx Fexofenadine Salmeterol Prasterone Duloxetine Estrogen</span></span>
<span id="cb156-127"><a href="chapter-fhir-pit.html#cb156-127" tabindex="-1"></a><span class="co"># 1               0            0          0          0          0        0</span></span>
<span id="cb156-128"><a href="chapter-fhir-pit.html#cb156-128" tabindex="-1"></a><span class="co"># 2               0            0          0          0          0        0</span></span>
<span id="cb156-129"><a href="chapter-fhir-pit.html#cb156-129" tabindex="-1"></a><span class="co"># 3               0            0          0          0          0        0</span></span>
<span id="cb156-130"><a href="chapter-fhir-pit.html#cb156-130" tabindex="-1"></a><span class="co"># 4               0            0          0          0          0        0</span></span>
<span id="cb156-131"><a href="chapter-fhir-pit.html#cb156-131" tabindex="-1"></a><span class="co">#   PregnancyDx Ciclesonide ObesityDx Testosterone Beclomethasone</span></span>
<span id="cb156-132"><a href="chapter-fhir-pit.html#cb156-132" tabindex="-1"></a><span class="co"># 1           0           0         0            0              0</span></span>
<span id="cb156-133"><a href="chapter-fhir-pit.html#cb156-133" tabindex="-1"></a><span class="co"># 2           0           0         0            0              0</span></span>
<span id="cb156-134"><a href="chapter-fhir-pit.html#cb156-134" tabindex="-1"></a><span class="co"># 3           0           0         0            0              0</span></span>
<span id="cb156-135"><a href="chapter-fhir-pit.html#cb156-135" tabindex="-1"></a><span class="co"># 4           0           0         0            0              0</span></span>
<span id="cb156-136"><a href="chapter-fhir-pit.html#cb156-136" tabindex="-1"></a><span class="co">#   OvarianCancerDx ReactiveAirwayDx Medroxyprogresterone DiabetesDx</span></span>
<span id="cb156-137"><a href="chapter-fhir-pit.html#cb156-137" tabindex="-1"></a><span class="co"># 1               0                0                    0          0</span></span>
<span id="cb156-138"><a href="chapter-fhir-pit.html#cb156-138" tabindex="-1"></a><span class="co"># 2               0                0                    0          0</span></span>
<span id="cb156-139"><a href="chapter-fhir-pit.html#cb156-139" tabindex="-1"></a><span class="co"># 3               0                0                    0          0</span></span>
<span id="cb156-140"><a href="chapter-fhir-pit.html#cb156-140" tabindex="-1"></a><span class="co"># 4               0                0                    0          0</span></span>
<span id="cb156-141"><a href="chapter-fhir-pit.html#cb156-141" tabindex="-1"></a><span class="co">#   Hydroxyzine AlopeciaDx Propranolol Theophylline KidneyCancerDx AsthmaDx</span></span>
<span id="cb156-142"><a href="chapter-fhir-pit.html#cb156-142" tabindex="-1"></a><span class="co"># 1           0          0           0            0              0        0</span></span>
<span id="cb156-143"><a href="chapter-fhir-pit.html#cb156-143" tabindex="-1"></a><span class="co"># 2           0          0           0            0              0        0</span></span>
<span id="cb156-144"><a href="chapter-fhir-pit.html#cb156-144" tabindex="-1"></a><span class="co"># 3           0          0           0            0              0        0</span></span>
<span id="cb156-145"><a href="chapter-fhir-pit.html#cb156-145" tabindex="-1"></a><span class="co"># 4           0          0           0            0              0        0</span></span>
<span id="cb156-146"><a href="chapter-fhir-pit.html#cb156-146" tabindex="-1"></a><span class="co">#   Metformin Albuterol Tamoxifen Estropipate Leuprolide CervicalCancerDx</span></span>
<span id="cb156-147"><a href="chapter-fhir-pit.html#cb156-147" tabindex="-1"></a><span class="co"># 1         0         0         0           0          0                0</span></span>
<span id="cb156-148"><a href="chapter-fhir-pit.html#cb156-148" tabindex="-1"></a><span class="co"># 2         0         0         0           0          0                0</span></span>
<span id="cb156-149"><a href="chapter-fhir-pit.html#cb156-149" tabindex="-1"></a><span class="co"># 3         0         0         0           0          0                0</span></span>
<span id="cb156-150"><a href="chapter-fhir-pit.html#cb156-150" tabindex="-1"></a><span class="co"># 4         0         0         0           0          0                0</span></span>
<span id="cb156-151"><a href="chapter-fhir-pit.html#cb156-151" tabindex="-1"></a><span class="co">#   Histrelin Ipratropium Trazodone AgeStudyStart Active_In_Year</span></span>
<span id="cb156-152"><a href="chapter-fhir-pit.html#cb156-152" tabindex="-1"></a><span class="co"># 1         0           0         0            14              1</span></span>
<span id="cb156-153"><a href="chapter-fhir-pit.html#cb156-153" tabindex="-1"></a><span class="co"># 2         0           0         0            17              1</span></span>
<span id="cb156-154"><a href="chapter-fhir-pit.html#cb156-154" tabindex="-1"></a><span class="co"># 3         0           0         0            20              1</span></span>
<span id="cb156-155"><a href="chapter-fhir-pit.html#cb156-155" tabindex="-1"></a><span class="co"># 4         0           0         0            17              1</span></span></code></pre></div>
<p>The deidentified ICEES2DEI CSV file may be used for further analysis. For instance, below we plot <code>AvgDailyPM2.5Exposure</code> vs <code>MaxDailyOzoneExposure</code> to examine the relationship between maximum daily ozone exposure and average daily PM<sub>2.5</sub> exposure, noting a strong correlation is not expected for this tutorial, as we randomly sampled the exposures data.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="chapter-fhir-pit.html#cb157-1" tabindex="-1"></a><span class="fu">ggplot</span>(icees2dei, <span class="fu">aes</span>(<span class="at">y =</span> AvgDailyPM2<span class="fl">.5</span>Exposure, <span class="at">x =</span> MaxDailyOzoneExposure)) <span class="sc">+</span></span>
<span id="cb157-2"><a href="chapter-fhir-pit.html#cb157-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-3"><a href="chapter-fhir-pit.html#cb157-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="images/fhir_pit/plot_daily_pm_vs_o3.png" class="centerimage" width="75%" height="auto"/></p>
</div>
</div>
<div id="fhir-pit-considerations" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Considerations<a href="chapter-fhir-pit.html#fhir-pit-considerations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>FHIR PIT must be run within a secure enclave when working with real patient datasets, and all federal and institutional regulations surrounding patient privacy and data security must be met.</p>
<p>FHIR PIT performs linkages between patient datasets and environmental exposures datasets using geocodes (i.e., patient primary residence), study period, and healthcare visit dates. FHIR PIT currently assumes a patient or subject resides in a single geolocation across a defined study period. We plan to adapt FHIR PIT to address mobility by, for example, assessing school-aged children’s home versus public school exposures.</p>
<p>Note that the FHIR PIT application may be memory-intensive, depending on the size of the input datasets. For the sample input data, this tutorial requires approximately 4 GB RAM to run successfully, but the memory requirements may be greater with large input datasets.</p>
<p>Finally, FHIR PIT, by name and function, ingests FHIR files as the preferred CDM. For users who are working with the PCORnet CDM, we offer two tools to map PCORnet to FHIR: pcornet-to-fhir (<a href="https://github.com/RENCI/tx-pcornet-to-fhir" class="uri">https://github.com/RENCI/tx-pcornet-to-fhir</a>) and CAMP FHIR (<a href="https://github.com/NCTraCSIDSci/camp-fhir" class="uri">https://github.com/NCTraCSIDSci/camp-fhir</a>). CAMP FHIR additionally maps i2b2 and OMOP to FHIR. Both tools are openly available.</p>
</div>
<div id="concluding-remarks-1" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Concluding Remarks<a href="chapter-fhir-pit.html#concluding-remarks-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This tutorial demonstrates how to execute FHIR PIT and analyze its output. The patient dataset used in this tutorial is synthetic and intended for demonstration purposes only. The environmental datasets used in this tutorial are randomly sampled from much larger datasets derived from public sources. Users may substitute the synthetic patient dataset and sample exposures datasets with their own datasets. To add your own data, please update the ‘data/input’ directory. For assistance with FHIR PIT or access to our environmental exposure datasets, please contact <a href="mailto:fhir-pit@renci.org" class="email">fhir-pit@renci.org</a>.</p>

</div>
</div>



<h3>References</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-fhirpit-repo" class="csl-entry">
<div class="csl-left-margin">26. </div><div class="csl-right-inline">Garcia, Juan Jose, Karamarie Fecho, Hong Yi, and Hao Xu. 2024. <em><span>FHIR-PIT</span>: <span class="nocase">FHIR Patient data Integration Tool</span></em>. Software. <a href="https://github.com/ExposuresProvider/FHIR-PIT">https://github.com/ExposuresProvider/FHIR-PIT</a></div>
</div>
<div id="ref-fhirpit-docs" class="csl-entry">
<div class="csl-left-margin">27. </div><div class="csl-right-inline">Garcia, Juan Jose. 2022. <em><span>FHIR-PIT</span>: Transformations Documentation</em>. <a href="https://github.com/ExposuresProvider/FHIR-PIT/blob/contained_demo/spark/FHIR-PIT-Transformations-Documentation.pdf">https://github.com/ExposuresProvider/FHIR-PIT/blob/contained_demo/spark/FHIR-PIT-Transformations-Documentation.pdf</a></div>
</div>
<div id="ref-xu2020fhir" class="csl-entry">
<div class="csl-left-margin">28. </div><div class="csl-right-inline">Xu, Hao, Steven Cox, Lisa Stillwell, Emily Pfaff, James Champion, Stanley C. Ahalt, et al. 2020. <span>“<span>FHIR PIT</span>: An Open Software Application for Spatiotemporal Integration of Clinical Data and Environmental Exposures Eata.”</span> <em>BMC Medical Informatics and Decision Making</em> 20: 1–8. <a href="https://doi.org/10.1186/s12911-020-1056-9">https://doi.org/10.1186/s12911-020-1056-9</a></div>
</div>
<div id="ref-fecho2019novel" class="csl-entry">
<div class="csl-left-margin">29. </div><div class="csl-right-inline">Fecho, Karamarie, Emily Pfaff, Hao Xu, James Champion, Steve Cox, Lisa Stillwell, et al. 2019. <span>“A Novel Approach for Exposing and Sharing Clinical Data: The Translator Integrated Clinical and Environmental Exposures Service.”</span> <em>Journal of the American Medical Informatics Association</em> 26 (10): 1064–73. <a href="https://doi.org/10.1093/jamia/ocz042">https://doi.org/10.1093/jamia/ocz042</a></div>
</div>
<div id="ref-hhs2023hipaa" class="csl-entry">
<div class="csl-left-margin">30. </div><div class="csl-right-inline">US Department of Health and Human Services Office for Civil Rights. 2024. <em>Guidance Regarding Methods for de-Identification of Protected Health Information in Accordance with the Health Insurance Portability and Accountability Act (<span>HIPAA</span>) Privacy Rule</em>. Website. <a href="https://www.hhs.gov/hipaa/for-professionals/privacy/special-topics/de-identification/index.html">https://www.hhs.gov/hipaa/for-professionals/privacy/special-topics/de-identification/index.html</a></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-link-to-census.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-studies.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
